!function t(e,n,r){function i(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){var r=t("q"),i={fieldDBtype:"CORS",debugMode:!1,debug:function(t,e,n){this.debugMode&&console.log(t,e,n)},warn:function(t){this.warnMessage&&this.warnMessage.indexOf("message")>-1||(this.warnMessage=this.warnMessage+t,console.warn("CORS-WARN: "+t))},bug:function(t){console.warn("CORS-BUG: "+t)},render:function(){this.debug("Render requested but this object has no render defined.")}};i.supportCORSandIE=function(t,e){var n;try{n=new XMLHttpRequest}catch(r){this.warn("XMLHttpRequest is not defined, nothing will happen.",r),n={}}return"withCredentials"in n?n.open(t,e,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(t,e)):n=null,n},i.makeCORSRequest=function(t){var e,n=this,o=r.defer();if(t.method||(t.method=t.type||"GET"),t.url||this.bug("There was an error. Please report this."),t.data||(t.data=""),"GET"===t.method&&t.data&&(t.dataToSend=JSON.stringify(t.data).replace(/,/g,"&").replace(/:/g,"=").replace(/"/g,"").replace(/[}{]/g,""),t.url=t.url+"?"+t.dataToSend),e=this.supportCORSandIE(t.method,t.url),!e)return this.bug("CORS not supported, your browser is unable to contact the database."),r.nextTick(function(){o.reject({status:400,userFriendlyErrors:["CORS not supported, your browser is unable to contact the database."]})}),o.promise;if(e.setRequestHeader("Content-type","application/json"),t.withCredentials!==!1&&(e.withCredentials=!0),t&&t.data&&t.data.files){console.log("converting to formdata ",t.data);var a=new FormData;for(var s in t.data)t.data.hasOwnProperty(s)&&a.append(s,t.data[s]);t.data=a,e.setRequestHeader("Content-Type","multipart/form-data")}else t.data&&(t.data=JSON.stringify(t.data));var u=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;console.log("percentComplete",e)}};e.addEventListener("progress",u,!1),e.onload=function(r,a,s){var u=e.responseJSON||e.responseText||e.response;if(n.debug("Response from CORS request to "+t.url+": "+u),e.status>=400){n.warn("The request to "+t.url+" was unsuccesful "+e.statusText);try{u=JSON.parse(u)}catch(r){r&&"Unexpected token o"===r.message?n.debug("response was json",r):(u={userFriendlyErrors:e.statusText,error:u},e.status>=500&&(n.bug("There was a serious error on the server. It replied in plain text.",u),u.userFriendlyErrors=["There was a problem contacting the server, please report this 2382"]),u.status=e.status)}return u.status=u.status||e.status,u.reason&&!u.userFriendlyErrors&&(u.userFriendlyErrors=[u.reason]),u.userFriendlyErrors=u.userFriendlyErrors||[" Unknown error  please report this 2312"],401===e.status&&i.application&&i.application.authentication&&i.application.authentication.dispatchEvent&&i.application.authentication.dispatchEvent("unauthorized"),"no_db_file"===u.userFriendlyErrors[0]&&(u.userFriendlyErrors=["That db doesn't exist. Are you sure this is the db you wanted to open: "+t.url]),void o.reject(u)}if(u){try{u=JSON.parse(u)}catch(r){n.debug("Response was already json.",r)}o.resolve(u)}else n.bug("There was no content in the server's response text. Please report this."),n.warn(r,a,s),r.userFriendlyErrors=u.userFriendlyErrors||[" Unknown error  please report this 2312"],o.reject(r)},e.onerror=function(e,r,i){n.debug(e,r,i),n.bug("There was an error making the CORS request to "+t.url+" from "+window.location.href+" the app will not function normally. Please report this.");var a={userFriendlyErrors:"There was an error making the CORS request to "+t.url+" from "+window.location.href+" the app will not function normally. Please report this.",status:null,error:e};e&&e.userFriendlyErrors&&(a.userFriendlyErrors=e.userFriendlyErrors),e&&e.status&&(a.status=e.status),e&&e.srcElement&&void 0!==e.srcElement.status&&(a.status=e.srcElement.status),0===a.status&&(a.userFriendlyErrors=["Unable to contact the server, are you sure you're not offline?"]),o.reject(a)};try{t.data?(n.debug("sending ",t.data),e.send(t.data)):e.send()}catch(c){n.warn("Caught an exception when calling send on xhr",c),o.reject(c)}return o.promise},n.CORS=i},{q:10}],2:[function(t,e,n){(function(e){var r,i=t("diacritic"),o=t("q");try{r=t("./../package.json")}catch(a){console.log("failed to load package.json",a),r={version:"2.2.0"}}var s=function(t){if(t&&(t instanceof this.constructor||t.constructor.toString()===this.constructor.toString()))return t.warn("This was already the right type, not converting it."),t;t&&t.id&&(this.useIdNotUnderscore=!0),this.verbose("In parent an json",t),t&&t.confidential&&this.INTERNAL_MODELS.confidential&&(this.confidential=new this.INTERNAL_MODELS.confidential(t.confidential)),this.INTERNAL_MODELS&&this.debug("parsing with ",this.INTERNAL_MODELS);var e=[];for(var n in t)if(t.hasOwnProperty(n)){this.debug("JSON: "+n),!(t[n]&&this.INTERNAL_MODELS&&this.INTERNAL_MODELS[n]&&"function"==typeof this.INTERNAL_MODELS[n])||t[n]instanceof this.INTERNAL_MODELS[n]||this.INTERNAL_MODELS[n].compatibleWithSimpleStrings&&"string"==typeof t[n]?e.push(n):t[n]=new this.INTERNAL_MODELS[n](t[n]);try{this[n]=t[n]}catch(r){console.log(r.stack)}}e.length>0&&this.debug("simpleModels",e.join(", ")),Object.apply(this,arguments),this.id||this._dateCreated||(this.dateCreated=Date.now())};s.internalAttributesToNotJSONify=["$$hashKey","application","bugMessage","confirmMessage","contextualizer","corpus","currentDoc","currentSession","datalist","database","db","debugMessages","decryptedMode","fetching","fieldsInColumns","fossil","loaded","loading","newDatum","parent","perObjectAlwaysConfirmOkay","perObjectDebugMode","promptMessage","saved","saving","selected","temp","unsaved","useIdNotUnderscore","warnMessage","whenReady"],s.internalAttributesToAutoMerge=s.internalAttributesToNotJSONify.concat(["appVersionWhenCreated","authServerVersionWhenCreated","created_at","dateCreated","dateModified","fieldDBtype","modifiedByUser","rev","roles","updated_at","version"]),s.ignore=function(t,e){if(!e)throw new Error("missing the list of ignores");return e.indexOf(t)>-1||e.indexOf(t.replace(/^_/,""))>-1?!0:void 0},s.software={},s.hardware={},s.DEFAULT_STRING="",s.DEFAULT_OBJECT={},s.DEFAULT_ARRAY=[],s.DEFAULT_COLLECTION=[],s.DEFAULT_VERSION="v"+r.version,s.DEFAULT_DATE=0,s.render=function(t){this.debug("Rendering, but the render was not injected for this "+this.fieldDBtype,t)},s.verbose=function(t,e,n,r){try{if(navigator&&"Microsoft Internet Explorer"===navigator.appName)return}catch(i){}if(this.verboseMode){var o=this.fieldDBtype||this._id||"UNKNOWNTYPE";console.log(o.toUpperCase()+" VERBOSE: "+t),e&&console.log(e),n&&console.log(n),r&&console.log(r)}},s.debugMode=!1,s.debug=function(t,e,n,r){try{if(navigator&&"Microsoft Internet Explorer"===navigator.appName)return}catch(i){}if(this.debugMode){var o=this.fieldDBtype||this._id||"UNKNOWNTYPE";console.log(o.toUpperCase()+" DEBUG: "+t),e&&console.log(e),n&&console.log(n),r&&console.log(r)}},s.todo=function(t,e,n,r){var i=this.fieldDBtype||this._id||"UNKNOWNTYPE";console.warn(i.toUpperCase()+" TODO: "+t),e&&console.warn(e),n&&console.warn(n),r&&console.warn(r)},s.bug=function(t){try{alert(t)}catch(e){this.warn(" Couldn't tell user about a bug: "+t)}var n=this.fieldDBtype||this._id||"UNKNOWNTYPE";console.error(n.toUpperCase()+" BUG: "+t)},s.warn=function(t,e,n,r){var i=this.fieldDBtype||this._id||"UNKNOWNTYPE";console.warn(i.toUpperCase()+" WARN: "+t),e&&console.warn(e),n&&console.warn(n),r&&console.warn(r)},s.prompt=function(t,e){var n=o.defer(),r=this;return o.nextTick(function(){var i;if(r.alwaysReplyToPrompt)console.warn(r.fieldDBtype.toUpperCase()+" NOT ASKING USER: "+t+" \nThe code decided that they would probably reply "+r.alwaysReplyToPrompt+" and it wasnt worth asking."),i=r.alwaysReplyToPrompt;else try{i=prompt(t)}catch(o){console.warn(r.fieldDBtype.toUpperCase()+" UNABLE TO ASK USER: "+t+" pretending they said "+r.alwaysReplyToPrompt),i=r.alwaysReplyToPrompt}null!==i&&void 0!==i&&"function"==typeof i.trim&&(i=i.trim()),i?n.resolve({message:t,optionalLocale:e,response:i}):n.reject({message:t,optionalLocale:e,response:i})}),n.promise},s.confirm=function(t,e){var n=o.defer(),r=this;return o.nextTick(function(){var i;if(r.alwaysConfirmOkay)console.warn(r.fieldDBtype.toUpperCase()+" NOT ASKING USER: "+t+" \nThe code decided that they would probably yes and it wasnt worth asking."),i=r.alwaysConfirmOkay;else try{i=confirm(t)}catch(o){console.warn(r.fieldDBtype.toUpperCase()+" UNABLE TO ASK USER: "+t+" pretending they said "+r.alwaysConfirmOkay),i=r.alwaysConfirmOkay}i?n.resolve({message:t,optionalLocale:e,response:i}):n.reject({message:t,optionalLocale:e,response:i})}),n.promise},s.uuidGenerator=function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return Date.now()+(t()+t()+t()+t()+t()+t()+t()+t())},s.getHumanReadableTimestamp=function(){var t=new Date,e=t.getFullYear(),n=t.getMonth()+1,r=t.getDate(),i=t.getHours(),o=t.getMinutes();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),e+"-"+n+"-"+r+"_"+i+"."+o},s.guessType=function(t){if(!t||JSON.stringify(t)==={})return"FieldDBObject";s.debug("Guessing type "+t._id);var e=t.previousFieldDBtype||t.jsonType||t.collection||"FieldDBObject";return t.api&&t.api.length>0&&(s.debug("using api"+t.api),e=t.api[0].toUpperCase()+t.api.substring(1,t.api.length)),e=e.replace(/s$/,""),e=e[0].toUpperCase()+e.substring(1,e.length),"Datalist"===e&&(e="DataList"),"FieldDBObject"===e&&(t.session?e="Datum":t.datumFields&&t.sessionFields?e="Corpus":"sessions"===t.collection&&t.sessionFields?e="Session":t.text&&t.username&&t.timestamp&&t.gravatar?e="Comment":t.symbol&&void 0!==t.tipa&&(e="UnicodeSymbol")),s.debug("Guessed type "+t._id+" is a "+e),e},s.convertDocIntoItsType=function(t,e){var n,r=Object.prototype.toString.call(t);if(e){var i;if("function"==typeof t.clone)i=t.clone(),t=new t.constructor(i);else{if("[object Boolean]"===r)return!!t;if("[object String]"===r)return t+"";if("[object Number]"===r)return t+0;if("[object Date]"===r)return new Date(t);if("[object Array]"===r)return t.concat([]);e=t.toJSON?t.toJSON():t,t=new t.constructor(e)}}else{if("[object Boolean]"===r)return t;if("[object String]"===r)return t;if("[object Number]"===r)return t;if("[object Date]"===r)return t;if("[object Array]"===r)return t}if("function"==typeof t.debug&&t.constructor!==s)return t;try{if(n=t.fieldDBtype,n&&"FieldDBObject"!==n||(s.debug(" requesting guess type "),n=s.guessType(t),s.debug("request complete")),s.debug("Converting doc into type "+n),FieldDB&&FieldDB[n]){if(t instanceof FieldDB[n])return t;t=new FieldDB[n](t)}else t=new s(t),s.debug("This doc does not have a type than is known to the FieldDB system. It might display oddly ",t)}catch(o){s.debug("Couldn't convert this doc to its type "+n+", it will be a base FieldDBObject: "+JSON.stringify(t)),s.debug(" error: ",o);var a=t.previousFieldDBtype?t.previousFieldDBtype.replace(/s$/,""):"";"FieldDBObject"!==n&&n!==a&&(t.previousFieldDBtype=t.previousFieldDBtype||"",t.previousFieldDBtype=t.previousFieldDBtype+n),t=new s(t)}return t},s.prototype=Object.create(Object.prototype,{constructor:{value:s},fieldDBtype:{configurable:!0,get:function(){return this._fieldDBtype||"FieldDBObject"},set:function(t){t!==this.fieldDBtype&&this.debug("Using type "+this.fieldDBtype+" when the incoming object was "+t)}},debugMode:{get:function(){return void 0===this.perObjectDebugMode?!1:this.perObjectDebugMode},set:function(t){return t!==this.perObjectDebugMode?null===t||void 0===t?void delete this.perObjectDebugMode:void(this.perObjectDebugMode=t):void 0}},debug:{value:function(){this.debugMode&&s.debug.apply(this,arguments)}},verboseMode:{get:function(){return void 0===this.perObjectVerboseMode?!1:this.perObjectVerboseMode},set:function(t){return t!==this.perObjectVerboseMode?null===t||void 0===t?void delete this.perObjectVerboseMode:void(this.perObjectVerboseMode=t):void 0}},verbose:{value:function(){this.verboseMode&&s.verbose.apply(this,arguments)}},bug:{value:function(t){if(this.bugMessage){if(this.bugMessage.indexOf(t)>-1)return void this.warn("Not repeating bug message: "+t);this.bugMessage+=";;; "}else this.bugMessage="";this.bugMessage=this.bugMessage+t,s.bug.apply(this,arguments)}},alwaysConfirmOkay:{get:function(){return void 0===this.perObjectAlwaysConfirmOkay?!1:this.perObjectAlwaysConfirmOkay},set:function(t){return t!==this.perObjectAlwaysConfirmOkay?null===t||void 0===t?void delete this.perObjectAlwaysConfirmOkay:void(this.perObjectAlwaysConfirmOkay=t):void 0}},prompt:{value:function(t){return this.promptMessage?this.promptMessage+="\n":this.promptMessage="",this.promptMessage=this.promptMessage+t,s.prompt.apply(this,arguments)}},confirm:{value:function(t){return this.confirmMessage?this.confirmMessage+="\n":this.confirmMessage="",this.confirmMessage=this.confirmMessage+t,s.confirm.apply(this,arguments)}},warn:{value:function(t){this.warnMessage?this.warnMessage+=";;; ":this.warnMessage="",this.warnMessage=this.warnMessage+t,s.warn.apply(this,arguments)}},todo:{value:function(){s.todo.apply(this,arguments)}},decryptedMode:{get:function(){return this.application?this.application.decryptedMode:this._decryptedMode},set:function(t){this.application?this.application.decryptedMode=t:this._decryptedMode=t}},render:{configurable:!0,writable:!0,value:function(t){this.debug("Calling render with options",t),s.render.apply(this,arguments)}},ensureSetViaAppropriateType:{value:function(t,e,n){if(!t)throw console.error("Invalid call to ensureSetViaAppropriateType",e),new Error("Invalid call to ensureSetViaAppropriateType");return n=n||"_"+t,e===this[n]?this[n]:e?(!this.INTERNAL_MODELS||!this.INTERNAL_MODELS[t]||"function"!=typeof this.INTERNAL_MODELS[t]||e instanceof this.INTERNAL_MODELS[t]||this.INTERNAL_MODELS[t].compatibleWithSimpleStrings&&"string"==typeof e||(this.debug("Converting this into its type.",e.constructor.toString()),e=new this.INTERNAL_MODELS[t](e)),"function"==typeof e.trim&&(e=e.trim()),this[n]=e,this[n]):void delete this[n]}},unsaved:{get:function(){return this._unsaved},set:function(t){this._unsaved=!!t}},calculateUnsaved:{value:function(){if(!this.fossil)return void(this._unsaved=!0);var t=new this.constructor(this.fossil),e=new this.constructor(this.toJSON());return e.debugMode=this.debugMode,t.equals(e)?(this.warn("The "+this.id+" didnt actually change. Not marking as edited"),this._unsaved=!1):this._unsaved=!0,this._unsaved}},createSaveSnapshot:{value:function(n,r){var i=this;n=this,this.debug("    Running snapshot..."),n.version=s.DEFAULT_VERSION;try{s.software=s.software||{},s.software.appCodeName=navigator.appCodeName,s.software.appName=navigator.appName,s.software.appVersion=navigator.appVersion,s.software.cookieEnabled=navigator.cookieEnabled,s.software.doNotTrack=navigator.doNotTrack,s.software.hardwareConcurrency=navigator.hardwareConcurrency,s.software.language=navigator.language,s.software.languages=navigator.languages,s.software.maxTouchPoints=navigator.maxTouchPoints,s.software.onLine=navigator.onLine,s.software.platform=navigator.platform,s.software.product=navigator.product,s.software.productSub=navigator.productSub,s.software.userAgent=navigator.userAgent,s.software.vendor=navigator.vendor,s.software.vendorSub=navigator.vendorSub,navigator&&navigator.geolocation&&"function"==typeof navigator.geolocation.getCurrentPosition&&navigator.geolocation.getCurrentPosition(function(t){i.debug("recieved position information"),s.software.location=t.coords})}catch(o){this.debug("Error loading software ",o),s.software=s.software||{},s.software.version=e.version,s.software.appVersion="PhantomJS unknown";try{var a=t,u=a("os");s.hardware=s.hardware||{},s.hardware.endianness=u.endianness(),s.hardware.platform=u.platform(),s.hardware.hostname=u.hostname(),s.hardware.type=u.type(),s.hardware.arch=u.arch(),s.hardware.release=u.release(),s.hardware.totalmem=u.totalmem(),s.hardware.cpus=u.cpus().length}catch(o){this.debug(" hardware is unknown.",o),s.hardware=s.hardware||{},s.software.appVersion="Device unknown"}}if(!r){r={name:"",username:"unknown"};try{this.corpus&&this.corpus.connectionInfo&&this.corpus.connectionInfo.userCtx?r.username=this.corpus.connectionInfo.userCtx.name:s.application&&s.application.user&&s.application.user.username&&(r.username=r.username||s.application.user.username,r.gravatar=r.gravatar||s.application.user.gravatar)}catch(o){this.warn("Can't get the corpus connection info to guess who saved this.",o)}}if("function"==typeof r.toJSON){var c=r.toJSON();c.name=r.name,r=c}else r.name=r.name;this.debug("    Calculating userWhoSaved...");var l={username:r.username,name:r.name,lastname:r.lastname,firstname:r.firstname,gravatar:r.gravatar};if(n._rev){n._dateModified=Date.now();var f=n.modifiedByUser||{};n.fields&&n.fields.modifiedbyuser?f=n.fields.modifiedbyuser:n.modifiedByUser||(n.modifiedByUser=f),n.modifiedByUsers&&(f={json:{users:n.modifiedByUsers}},delete n.modifiedByUsers),f.value=f.value?f.value+", ":"",f.value+=l.name||l.username,f.json=f.json||{},f.users&&(f.json.users=f.users,delete f.users),f.json.users=f.json.users||[],l.software=s.software,l.hardware=s.hardware,f.json.users.push(l)}else{n._dateCreated=Date.now();var h=n.enteredByUser||{};n.fields&&n.fields.enteredbyuser?h=n.fields.enteredbyuser:n.enteredByUser||(n.enteredByUser=h),h.value=l.name||l.username,h.json=h.json||{},h.json.user=l,h.json.software=s.software;try{h.json.hardware=Android?Android.deviceDetails:s.hardware}catch(o){this.debug("Cannot detect the hardware used for selfOrSnapshot save.",o),h.json.hardware=s.hardware}}if(s.software&&s.software.location){var d;n.location?d=n.location:n.fields&&n.fields.location&&(d=n.fields.location),d&&(d.json=d.json||{},d.json.previousLocations=d.json.previousLocations||[],d.json&&d.json.location&&d.json.location.latitude&&d.json.previousLocations.push(d.json.location),this.debug("overwriting location ",d),d.json.location=s.software.location,d.value=d.json.location.latitude+","+d.json.location.longitude)}return this.debug("    Serializing to send object to selfOrSnapshotbase..."),n.toJSON()}},save:{value:function(t,e,n){var r=o.defer(),i=this;if(this.fetching)return i.warn("Fetching is in process, can't save right now..."),o.nextTick(function(){r.reject("Fetching is in process, can't save right now...")}),r.promise;if(this.saving)return i.warn("Save was already in process..."),o.nextTick(function(){r.reject("Fetching is in process, can't save right now...")}),r.promise;if(e)this.debug("Not calculating if this object has changed, assuming it needs to be saved anyway.");else if(i.debug("    Checking to see if item needs to be saved.",e,this.unsaved),!this.unsaved&&!this.calculateUnsaved())return i.warn("Item hasn't really changed, no need to save..."),o.nextTick(function(){return r.resolve(i),i}),r.promise;if(!this.corpus||"function"!=typeof this.corpus.set)return i.warn("The corpus for this doc isnt acessible, this is probably a bug.",this),o.nextTick(function(){i.saving=!1,r.reject({status:406,userFriendlyErrors:["This application has errored. Please notify its developers: Cannot save data, database is not currently opened."]})}),r.promise;if(this.corpus.dbname!==this.dbname)return this.warn("This item belongs in the "+this.dbname+"database, not in the "+this.corpus.dbname+" database."),o.nextTick(function(){i.saving=!1,r.reject({status:406,userFriendlyErrors:["This item belongs in the "+i.dbname+"database, not in the "+i.corpus.dbname+" database."]})}),r.promise;n&&this.todo("Url for save was specified, but it is not being used. optionalUrl",n);var a=this.createSaveSnapshot();return a?(i.debug("    Requesting corpus to run save..."),this.saving=!0,this.whenReady=r.promise,this.corpus.set(a).then(function(t){return i.saving=!1,i.debug("    Save completed..."),i.debug("saved ",t),t?t.id?(i.unsaved=!1,i.id=t.id,i.rev=t.rev,i.debug("    Updating fossil..."),i.fossil=i.toJSON(),i.debug("    Resolving promise...",i),r.resolve(i),i):(i.debug("    Rejecting promise, the id was not set by the database .."),r.reject({status:500,userFriendlyErrors:["This application has errored. Please notify its developers: Save operation returned abnormal results."],details:t}),i):(r.reject({status:400,userFriendlyErrors:["This application has errored. Please notify its developers: Cannot save data."]}),"self")},function(t){return i.debug(t),i.saving=!1,r.reject(t),i}).fail(function(t){console.error(t.stack,i),r.reject(t)}),r.promise):(this.warn(" Can't save "+this.id+" right now. The JSON isnt ready."),o.nextTick(function(){i.saving=!1,r.reject({status:406,userFriendlyErrors:["Can't save "+this.id+" right now. Please wait."]})}),r.promise)}},"delete":{value:function(t){return this.trash(t)}},trash:{value:function(t){return this.trashed="deleted",t?this.trashedReason=t:this.todo("consider using a confirm to ask for a reason for deleting the item"),this.save(null,"forcesavesinceweneedtopersistthischange")}},undelete:{value:function(t){return this.trashed="restored",t?this.untrashedReason=t:this.todo("consider using a confirm to ask for a reason for undeleting the item"),this.save(null,"forcesavesinceweneedtopersistthischange")}},saveToGit:{value:function(t,e){var n=o.defer(),r=this;return o.nextTick(function(){r.todo("If in nodejs, write to file and do a git commit with optional user's email who modified the file and push ot a branch with that user's username",e),r.debug("Commit to be used: ",t),n.resolve(r)}),n.promise}},equals:{value:function(t){for(var e in this)if(this.hasOwnProperty(e)&&"function"!=typeof this[e]&&!s.ignore(e,s.internalAttributesToAutoMerge)){if(!t)return!1;if(this[e]&&"function"==typeof this[e].equals){if(!this[e].equals(t[e]))return this.debug("  "+e+": ",this[e]," not equalivalent to ",t[e]),this.debugMode&&console.error("objects are not equal stactrace"),!1}else if(this[e]===t[e])this.debug(e+": "+this[e]+" equals "+t[e]);else if(JSON.stringify(this[e])===JSON.stringify(t[e]))this.debug(e+": "+this[e]+" equals "+t[e]);else{if(void 0===t[e]&&"_dateCreated"!==e&&"perObjectDebugMode"!==e)return this.debug(e+" is missing "+this[e]+" on anotherObject "+t[e]),this.debugMode&&console.error("objects are not equal stactrace"),!1;if("_dateCreated"!==e&&"perObjectDebugMode"!==e)return this.debug(e+": ",this[e]," not equal ",t[e]),this.debugMode&&console.error("objects are not equal stactrace"),!1}}else this.debug("skipping equality of "+e);return"function"!=typeof t.equals||void 0!==this.dontRecurse||(this.dontRecurse=!0,t.dontRecurse=!0,t.equals(this))?(delete this.dontRecurse,delete t.dontRecurse,!0):(this.debugMode&&console.error("objects are not equal stactrace"),!1)}},merge:{value:function(t,e,n){var r,i,o,a,u,c,l,f={};if(0===arguments.length)return this.warn("Invalid call to merge, there was no object provided to merge"),null;if(e||n)if("self"===t)this.debug("Merging properties into myself. "),r=this,i=r;else{if(!t||!e)return this.warn("Invalid call to merge, invalid arguments were provided to merge",arguments),null;r=s.convertDocIntoItsType(t),e=s.convertDocIntoItsType(e),i=this}else i=r=this,e=s.convertDocIntoItsType(t);if(n||(n=""),r.id&&e.id&&r.id!==e.id)return this.warn("Refusing to merge these objects, they have different ids: "+r.id+"  and "+e.id),this.debug("Refusing to merge"+r.id+"  and "+e.id,r,e),null;if(r.dbname&&e.dbname&&r.dbname!==e.dbname)if(n.indexOf("keepDBname")>-1)this.warn("Permitting a merge of objects from different databases: "+r.dbname+"  and "+e.dbname),this.debug("Merging ",r,e);else if(-1===n.indexOf("changeDBname"))return this.warn("Refusing to merge these objects, they come from different databases: "+r.dbname+"  and "+e.dbname),this.debug("Refusing to merge"+r.dbname+"  and "+e.dbname,r,e),null;for(o in r)r.hasOwnProperty(o)&&"function"!=typeof r[o]&&!s.ignore(o,s.internalAttributesToNotJSONify)&&(f[o]=!0);for(o in e)e.hasOwnProperty(o)&&"function"!=typeof e[o]&&!s.ignore(o,s.internalAttributesToNotJSONify)&&(f[o]=!0);this.debug(" Merging properties: ",f);var h=function(t,o){t.confirm("I found a conflict for "+o+", Do you want to overwrite it from "+JSON.stringify(r[o])+" -> "+JSON.stringify(e[o])).then(function(){"_dbname"===o&&n.indexOf("keepDBname")>-1?t.warn(" Keeping _dbname of "+i.dbname):(t.warn("Async Overwriting contents of "+o+" (this may cause disconnection in listeners)"),t.debug("Async Overwriting  ",r[o]," ->",e[o]),i[o]=e[o])},function(){i[o]=r[o]}).fail(function(e){console.error(e.stack,t)})};for(o in f)if("function"!=typeof r[o]&&"function"!=typeof e[o])if(this.debugMode&&this.debug("  Merging ---"+o+"--- \n   :::"+JSON.stringify(i[o])+":::\n   :::"+JSON.stringify(r[o])+":::\n   :::"+JSON.stringify(e[o])+":::"),(void 0===i[o]||null===i[o])&&(void 0!==r[o]&&null!==r[o]?"string"!=typeof r[o]&&"function"==typeof r[o].constructor?(l=r[o].toJSON?r[o].toJSON():r[o],i[o]=new r[o].constructor(l),this.debug(" "+o+" resultObject will have anObject's Cloned contents because it was empty")):(i[o]!=r[o]&&(i[o]=r[o]),this.debug(" "+o+" resultObject will have anObject's contents because it was empty")):void 0!==e[o]&&null!==e[o]&&(this.debug("Using a constructor"),this.todo(" use clone only if not merging self."),i[o]="self"===t?s.convertDocIntoItsType(e[o]):s.convertDocIntoItsType(e[o],"clone"))),this.debugMode&&this.debug("  Merging ---"+o+"--- \n   :::"+JSON.stringify(i[o])+":::\n   :::"+JSON.stringify(r[o])+":::\n   :::"+JSON.stringify(e[o])+":::"),r[o]!=e[o])if(void 0!==e[o]&&null!==e[o]||i[o]==r[o])if(!e[o]||void 0!==r[o]&&null!==r[o]&&r[o]!==[]&&0!==r[o].length&&r[o]!=={})if(void 0===r[o]&&null===r[o]||void 0!==e[o]&&null!==e[o]&&e[o]!==[]&&0!==e[o].length&&e[o]!=={})if("[object Array]"!==Object.prototype.toString.call(r[o])||"[object Array]"!==Object.prototype.toString.call(e[o]))if(i[o]&&"function"==typeof i[o].merge){c="self"===t?t:r[o],this.debug("Requesting recursive merge of internal property "+o+" using method: "+c);try{var d=i[o].merge(c,e[o],n);this.debug("after internal merge ",d),this.debug("after internal merge ",i[o])}catch(p){console.warn("problem merging this "+o,p)}}else u=n,this.debug("Found conflict for "+o+" Requested with "+n+" "+n.indexOf("overwrite")),-1!==n.indexOf("overwrite")||s.ignore(o,s.internalAttributesToAutoMerge)||h(this,o),u||s.ignore(o,s.internalAttributesToAutoMerge)?"_dbname"===o&&n.indexOf("keepDBname")>-1?this.warn(" Keeping _dbname of "+i.dbname):(s.ignore(o,s.internalAttributesToAutoMerge)||this.warn("Overwriting contents of "+o+" (this may cause disconnection in listeners)"),this.debug("Overwriting  ",r[o]," ->",e[o]),i[o]=e[o]):i[o]!=r[o]&&(i[o]=r[o]);else{this.debug(o+" was an array, concatinating with the new value",r[o]," ->",e[o]),i[o]=r[o].concat([]);try{e[o].map(function(t){-1===i[o].indexOf(t)&&i[o].push(t)})}catch(p){console.warn("problem merging this array "+o,p)}this.debug("  added members of anotherObject "+o+" to anObject ",i[o])}else a=!0,this.debug(o+" target is empty, taking the old value"),i[o]!=r[o]&&(i[o]=r[o]);else a=!0,this.debug(o+" was previously empty, taking the new value"),i[o]=e[o];else this.debug(o+" was missing in new object, using the original"),i[o]!=r[o]&&(i[o]=r[o]);else this.debug(o+" were equal or had no conflict."),i[o]!=r[o]&&(i[o]=r[o]);else this.debug("  Ignoring ---"+o+"----");return i}},fetchRevisions:{value:function(t){var e=o.defer(),n=this;return this._id?this.corpus&&"function"==typeof this.corpus.fetchRevisions?(n.corpus.fetchRevisions(this.id,t).then(function(t){n._revisions?t.map(function(t){-1===n._revisions.indexOf(t)&&n._revisions.push(t)}):n._revisions=t,n.debug("This "+n.id+" has "+n._revisions.length+" previous revisions"),e.resolve(n._revisions)},function(t){return n.warn("Unable to update list of revisions currently."),n.debug(t),e.reject(t),n}).fail(function(t){console.error(t.stack,n),e.reject(t)}),e.promise):(o.nextTick(function(){e.reject({status:406,userFriendlyErrors:["This application has errored. Please notify its developers: Cannot fetch data if the database is not currently opened."]})}),e.promise):(o.nextTick(function(){n.warn("This hasn't been saved before, so there are no previous revisisons to show you."),e.resolve(n._revisions)}),e.promise)}},fetch:{value:function(t){var e=o.defer(),n=this;if(this.fetching&&this.whenReady)return n.warn("Fetching is in process, don't need to fetch right now..."),this.whenReady;if(!this.corpus||"function"!=typeof this.corpus.get||!this._id)return o.nextTick(function(){n.fetching=n.loading=!1,e.reject({status:406,userFriendlyErrors:["This application has errored. Please notify its developers: Cannot fetch data which has no id, or the if database is not currently opened."]})}),e.promise;this.todo("Should probably call save before fetch to create a snapshot of the item regardless of whether the save is completeable, ");var r=this.rev;return this.fetching=this.loading=!0,this.whenReady=e.promise,n.corpus.get(n.id,t).then(function(t){return n.fetching=n.loading=!1,t?(n.loaded=!0,r||!t._rev&&!t.rev?(n.warn("Cant tell if this was a placeholder, calling merge and asking user if there are merge conflicts.",t),n.merge("self",t),n.debug("After merge ",n.modifiedByUser)):(n.warn(n.id+" was probabbly a placeholder (didnt have .rev before fetch, but now it does) which is now filled in, calling merge with overwrite from server."),n.merge("self",s.convertDocIntoItsType(t),"overwrite"),n.fossil=n.toJSON(),n.unsaved=!1),e.resolve(n),n):(e.reject({status:400,userFriendlyErrors:["This application has errored. Please notify its developers: Cannot fetch data url."]}),n)},function(t){return n.fetching=n.loading=!1,n.loaded=!1,n.debug(t),e.reject(t),n}).fail(function(t){console.error(t.stack,n),e.reject(t)}),e.promise}},INTERNAL_MODELS:{value:{_id:s.DEFAULT_STRING,_rev:s.DEFAULT_STRING,dbname:s.DEFAULT_STRING,version:s.DEFAULT_STRING,dateCreated:s.DEFAULT_DATE,dateModified:s.DEFAULT_DATE,comments:s.DEFAULT_COLLECTION}},application:{get:function(){return s.application},set:function(){}},corpus:{get:function(){var t=null;if(this.resumeAuthenticationSession&&"function"==typeof this.resumeAuthenticationSession)t=this,this.debug("this "+this._id+" has the functions of a corpus, using it.",t);else if(this._corpus)t=this._corpus,this.debug("this "+this._id+" has a _corpus hard coded inside it, using it.",t);else if(s.application&&s.application._corpus)t=s.application._corpus,this.debug("this "+this._id+" is running in the context where FieldDBObject.application._corpus is defined, using it.",t);else try{FieldDB&&FieldDB.Database&&(t=FieldDB.Database.prototype,this.warn("  using the Database.prototype to run db calls for "+this._id+", this could be problematic "+this._id+" ."),this.debug(" the database",t))}catch(e){var n=e?e.message:" unknown error in getting the corpus";"FieldDB is not defined"!==n&&(this.warn(this._id+"Cant get the corpus, cant find the Database class.",e),e&&this.warn("  stack trace"+e.stack))}return t||this.warn("Operations that need a database wont work for the "+this._id+" object"),t},set:function(t){return t&&t.dbname&&this.dbname&&t.dbname!==this.dbname?void this.warn("The corpus "+t.db+" cant be set on this item, its db is different"+this.dbname):void(this._corpus=t)}},id:{get:function(){return this._id||s.DEFAULT_STRING},set:function(t){if(t!==this._id){if(!t)return void delete this._id;t.trim&&(t=t.trim()),this._id=t}}},rev:{get:function(){return this._rev||s.DEFAULT_STRING},set:function(t){if(t!==this._rev){if(!t)return void delete this._rev;t.trim&&(t=t.trim()),this._rev=t}}},dbname:{get:function(){return this._dbname||s.DEFAULT_STRING},set:function(t){if(t!==this._dbname){if(this._dbname&&"default"!==this._dbname&&this.rev)throw new Error("This is the "+this._dbname+". You cannot change the dbname of an object in this corpus to "+t+", you must create a clone of the object first.");

if(!t)return void delete this._dbname;t.trim&&(t=t.trim()),this._dbname=t}}},pouchname:{get:function(){return this.debug("Pouchname is deprecated, use dbname instead."),this.dbname},set:function(t){this.debug("Pouchname is deprecated, please use dbname instead."),this.dbname=t}},couchConnection:{get:function(){return console.error("CouchConnection is deprecated, use connection instead "+this.id),this.connection},set:function(t){this.connection=t}},version:{get:function(){return this._version||s.DEFAULT_VERSION},set:function(t){t!==this._version&&(t||(t=s.DEFAULT_VERSION),t.trim&&(t=t.trim()),this._version=t)}},timestamp:{get:function(){return this._timestamp||this._dateCreated},set:function(t){if(t!==this._timestamp&&t){if(t.replace)try{t=t.replace(/["\\]/g,""),t=new Date(t),t=t.getTime()}catch(e){this.warn("Upgraded timestamp"+t)}this._timestamp=t,(!this._dateCreated||this._dateCreated>t)&&(this._dateCreated=t)}}},dateCreated:{get:function(){return this.created_at&&(this.dateCreated=this.created_at),this._dateCreated||s.DEFAULT_DATE},set:function(t){if(t!==this._dateCreated&&t){if(t.replace)try{t=t.replace(/["\\]/g,""),t=new Date(t),t=t.getTime()}catch(e){this.warn("Upgraded dateCreated"+t)}this._dateCreated=t}}},dateModified:{get:function(){return!this._dateModified&&this.updated_at&&(this.dateModified=this.updated_at),this._dateModified||s.DEFAULT_DATE},set:function(t){if(t!==this._dateModified){if(!t)return void delete this._dateModified;if(t.replace)try{t=t.replace(/["\\]/g,""),t=new Date(t),t=t.getTime()}catch(e){this.warn("Upgraded dateModified"+t)}this._dateModified=t}}},showDiffs:{value:function(t,e){this.todo("We haven't implemented the 'diff' tool yet (ie, showing the changes, letting you undo changes etc). We will do it eventually, when it becomes a priority. <a target='blank'  href='https://github.com/OpenSourceFieldlinguistics/FieldDB/issues/124'>You can vote for it in our issue tracker</a>.  We use the <a target='blank' href='"+this.url+"/"+t+"?rev="+e+"'>Futon User Interface</a> directly to track revisions in the data, you can too (if your a power user type).","alert","Track Changes:")}},comments:{get:function(){return this._comments||s.DEFAULT_COLLECTION},set:function(t){if(t!==this._comments){if(!t)return void delete this._comments;"function"==typeof this.INTERNAL_MODELS.comments&&"[object Array]"===Object.prototype.toString.call(t)&&(t=new this.INTERNAL_MODELS.comments(t)),this._comments=t}}},isEmpty:{value:function(t){var e=!this[t]||this[t]===s.DEFAULT_COLLECTION||this[t]===s.DEFAULT_ARRAY||this[t]===s.DEFAULT_OBJECT||this[t]===s.DEFAULT_STRING||this[t]===s.DEFAULT_DATE||void 0!==this[t].length&&0===this[t].length||this[t]==={};return e}},toJSON:{value:function(t,e,n){try{var r,i,o={fieldDBtype:this.fieldDBtype};this.fetching&&(this.warn("Cannot get json while "+this.id+" is fetching itself"),this.debug(" this is the object",this)),this.version=this.version,this.useIdNotUnderscore?o.id=this.id:o._id=this.id,n||(n=[]),n=n.concat(s.internalAttributesToNotJSONify);for(r in this)this.hasOwnProperty(r)&&"function"!=typeof this[r]&&!s.ignore(r,n)&&(i=r.replace(/^_/,""),("id"===i||"rev"===i)&&(i="_"+i),(!e||e&&!this.isEmpty(r))&&(o[i]=this[r]&&"function"==typeof this[r].toJSON?this[r].toJSON(t,e):this[r]));if(t)for(r in this.INTERNAL_MODELS)!o[r]&&this.INTERNAL_MODELS&&(o[r]=this.INTERNAL_MODELS[r]&&"function"==typeof this.INTERNAL_MODELS[r]&&"function"==typeof(new this.INTERNAL_MODELS[r]).toJSON?(new this.INTERNAL_MODELS[r]).toJSON(t,e,n):this.INTERNAL_MODELS[r]);o._id||delete o._id,this.useIdNotUnderscore&&delete o._id,o._rev||delete o._rev,o.dbname&&(o.pouchname=o.dbname,this.debug("Serializing Pouchname for backward compatability until prototype can handle dbname"));for(var a in s.internalAttributesToNotJSONify)s.internalAttributesToNotJSONify.hasOwnProperty(a)&&(delete o[s.internalAttributesToNotJSONify[a]],delete o[s.internalAttributesToNotJSONify[a].replace(/^_/,"")]);return"private_corpora"!==this.collection||"private_corpora"!==this.api?(delete o.confidential,delete o.confidentialEncrypter):this.warn("serializing confidential in this object "+this._collection),this.api&&(o.api=this.api),o.fieldDBtype=this.fieldDBtype,o.previousFieldDBtype&&o.fieldDBtype&&o.previousFieldDBtype===o.fieldDBtype&&delete o.previousFieldDBtype,n.indexOf("fieldDBtype")>-1&&delete o.fieldDBtype,o}catch(u){return console.warn(u),console.error(u.stack),this.bug("Unable to serialze "+this.id+". Please report this."),null}}},addRelatedData:{value:function(t){var e;this.datumFields&&this.datumFields.relatedData?e=this.datumFields.relatedData.json.relatedData||[]:this.relatedData?e=this.relatedData:this.relatedData=e=[],t.relation="associated file",e.push(t)}},clone:{value:function(t){var e,n,r={};try{r=JSON.parse(JSON.stringify(this.toJSON(t)))}catch(i){i&&(console.warn(i),console.warn(i.stack),console.warn(i.message),console.warn(this))}for(e in r)n=e.replace(/^_/,""),this[e]&&"function"==typeof this[e].clone&&(r[n]=JSON.parse(JSON.stringify(this[e].clone(t))));var o=this.id;if(this.id&&this.rev){var a;r.datumFields&&r.datumFields.relatedData?a=r.datumFields.relatedData.json.relatedData||[]:r.relatedData?a=r.relatedData:r.relatedData=a=[],this.rev?o=o+"?rev="+this.rev:this.parent&&this.parent._rev&&(o="parent"+this.parent._id+"?rev="+this.parent._rev),a.push({relation:"clonedFrom",URI:o})}return delete r._id,delete r._rev,delete r.parent,delete r.dbname,delete r.pouchname,r}},contextualizer:{get:function(){return this.application&&this.application.contextualizer?this.application.contextualizer:void 0},set:function(){}},sanitizeStringForFileSystem:{value:function(t,e){return this.debug("sanitizeStringForPrimaryKey "+t),t?((void 0===e||"-"===e)&&(e="_"),t.trim?(t=i.clean(t),this.debug("sanitizeStringForPrimaryKey "+t),t=t.trim().replace(/[^-a-zA-Z0-9]+/g,e).replace(/^_/,"").replace(/_$/,""),this.debug("sanitizeStringForPrimaryKey "+t),t):"number"==typeof t?parseInt(t,10):null):null}},sanitizeStringForPrimaryKey:{value:function(t,e){return this.debug("sanitizeStringForPrimaryKey "+t),t?(t.replace&&(t=t.replace(/-/g,"_")),t=this.sanitizeStringForFileSystem(t,e),t&&"number"!=typeof t?this.camelCased(t):void 0):null}},camelCased:{value:function(t){return t?(t.replace&&(t=t.replace(/_([a-zA-Z])/g,function(t){return t[1].toUpperCase()}),t=t[0].toLowerCase()+t.substring(1,t.length)),t):null}}}),n.FieldDBObject=s,n.Document=s}).call(this,t("_process"))},{"./../package.json":11,_process:22,diacritic:9,q:10}],3:[function(t,e,n){var r=t("./../FieldDBObject").FieldDBObject,i=t("./Crypto_AES").CryptoJS,o=i.enc.Utf8;try{window.atob||console.log("ATOB is not defined, loading from npm")}catch(a){console.log(a),window={},window.atob=t("atob"),window.btoa=t("btoa")}var s=function(t){this._fieldDBtype||(this._fieldDBtype="Confidential"),this.debug("Constructing Confidential: ",t),t&&t.filledWithDefaults&&(this.fillWithDefaults(),delete t.filledWithDefaults),r.apply(this,arguments)};s.secretKeyGenerator=r.uuidGenerator,s.prototype=Object.create(r.prototype,{constructor:{value:s},encrypt:{value:function(t){if(!t)return t;if("object"==typeof t&&(t=JSON.stringify(t),this.debug("Converted object to string before encryption")),"number"==typeof t&&(t+="",this.debug("Converted object to string before encryption")),!this.secretkey)throw new Error("This confidential wasnt set up properly, cant encrypt.");this.debug("encrypting "+t);var e=i.AES.encrypt(t,this.secretkey.toString("base64"));return this.verbose(this.secretkey,e.toString(),window.btoa(e.toString())),"confidential:"+window.btoa(e.toString())}},decrypt:{value:function(t){var e=t;t=t.replace("confidential:",""),t=window.atob(t),this.verbose("Decrypting "+t,this.secretkey.toString("base64")),e=i.AES.decrypt(t,this.secretkey.toString("base64")).toString(o);try{("{"===e[0]&&"}"===e[e.length-1]||"["===e[0]&&"]"===e[e.length-1])&&(e=JSON.parse(e),this.debug("Decrypting an object"))}catch(n){this.verbose("Decrypting a non-object")}return e}},secretkey:{get:function(){return this._secretkey||(this._secretkey=""),this._secretkey},set:function(t){if(t!==this._secretkey){if(this._secretkey&&this._secretkey.length>2)throw new Error("Confidential key cant be changed once it was created. Please create another Confidential encrypter if you wish to change the key.");t||(t=""),this._secretkey=t.trim()}}},fillWithDefaults:{value:function(){return this.secretkey||(this.secretkey=s.secretKeyGenerator()),this}}}),n.Confidential=s},{"./../FieldDBObject":2,"./Crypto_AES":4,atob:7,btoa:8}],4:[function(t,e,n){var r=r||function(t,e){var n={},r=n.lib={},i=r.Base=function(){function t(){}return{extend:function(e){t.prototype=this;var n=new t;return e&&n.mixIn(e),n.$super=this,n},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.$super.extend(this)}}}(),o=r.WordArray=i.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||s).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,t=t.sigBytes;if(this.clamp(),r%4)for(var i=0;t>i;i++)e[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;t>i;i+=4)e[r+i>>>2]=n[i>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-8*(n%4),e.length=t.ceil(n/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],r=0;e>r;r+=4)n.push(4294967296*t.random()|0);return o.create(n,e)}}),a=n.enc={},s=a.Hex={stringify:function(t){for(var e=t.words,t=t.sigBytes,n=[],r=0;t>r;r++){var i=e[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;e>r;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-4*(r%8);return o.create(n,e/2)}},u=a.Latin1={stringify:function(t){for(var e=t.words,t=t.sigBytes,n=[],r=0;t>r;r++)n.push(String.fromCharCode(e[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;e>r;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-8*(r%4);return o.create(n,e)}},c=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=o.create(),this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a),s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0),e=s*a,i=t.min(4*e,i);if(e){for(var u=0;e>u;u+=a)this._doProcessBlock(r,u);u=r.splice(0,e),n.sigBytes-=i}return o.create(u,i)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});r.Hasher=l.extend({init:function(){this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize(),this._hash},clone:function(){var t=l.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:16,_createHelper:function(t){return function(e,n){return t.create(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return f.HMAC.create(t,n).finalize(e)}}});var f=n.algo={};return n}(Math);!function(){var t=r,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp();for(var t=[],i=0;n>i;i+=3)for(var o=(e[i>>>2]>>>24-8*(i%4)&255)<<16|(e[i+1>>>2]>>>24-8*((i+1)%4)&255)<<8|e[i+2>>>2]>>>24-8*((i+2)%4)&255,a=0;4>a&&n>i+.75*a;a++)t.push(r.charAt(o>>>6*(3-a)&63));if(e=r.charAt(64))for(;t.length%4;)t.push(e);return t.join("")},parse:function(t){var n=t.length,r=this._map,i=r.charAt(64);i&&(i=t.indexOf(i),-1!=i&&(n=i));for(var i=[],o=0,a=0;n>a;a++)if(a%4){var s=r.indexOf(t.charAt(a-1))<<2*(a%4),u=r.indexOf(t.charAt(a))>>>6-2*(a%4);i[o>>>2]|=(s|u)<<24-8*(o%4),o++}return e.create(i,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){function e(t,e,n,r,i,o,a){return t=t+(e&n|~e&r)+i+a,(t<<o|t>>>32-o)+e}function n(t,e,n,r,i,o,a){return t=t+(e&r|n&~r)+i+a,(t<<o|t>>>32-o)+e}function i(t,e,n,r,i,o,a){return t=t+(e^n^r)+i+a,(t<<o|t>>>32-o)+e}function o(t,e,n,r,i,o,a){return t=t+(n^(e|~r))+i+a,(t<<o|t>>>32-o)+e}var a=r,s=a.lib,u=s.WordArray,s=s.Hasher,c=a.algo,l=[];!function(){for(var e=0;64>e;e++)l[e]=4294967296*t.abs(t.sin(e+1))|0}(),c=c.MD5=s.extend({_doReset:function(){this._hash=u.create([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,r){for(var a=0;16>a;a++){var s=r+a,u=t[s];t[s]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}for(var s=this._hash.words,u=s[0],c=s[1],f=s[2],h=s[3],a=0;64>a;a+=4)16>a?(u=e(u,c,f,h,t[r+a],7,l[a]),h=e(h,u,c,f,t[r+a+1],12,l[a+1]),f=e(f,h,u,c,t[r+a+2],17,l[a+2]),c=e(c,f,h,u,t[r+a+3],22,l[a+3])):32>a?(u=n(u,c,f,h,t[r+(a+1)%16],5,l[a]),h=n(h,u,c,f,t[r+(a+6)%16],9,l[a+1]),f=n(f,h,u,c,t[r+(a+11)%16],14,l[a+2]),c=n(c,f,h,u,t[r+a%16],20,l[a+3])):48>a?(u=i(u,c,f,h,t[r+(3*a+5)%16],4,l[a]),h=i(h,u,c,f,t[r+(3*a+8)%16],11,l[a+1]),f=i(f,h,u,c,t[r+(3*a+11)%16],16,l[a+2]),c=i(c,f,h,u,t[r+(3*a+14)%16],23,l[a+3])):(u=o(u,c,f,h,t[r+3*a%16],6,l[a]),h=o(h,u,c,f,t[r+(3*a+7)%16],10,l[a+1]),f=o(f,h,u,c,t[r+(3*a+14)%16],15,l[a+2]),c=o(c,f,h,u,t[r+(3*a+5)%16],21,l[a+3]));s[0]=s[0]+u|0,s[1]=s[1]+c|0,s[2]=s[2]+f|0,s[3]=s[3]+h|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;for(e[r>>>5]|=128<<24-r%32,e[(r+64>>>9<<4)+14]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(e.length+1),this._process(),t=this._hash.words,e=0;4>e;e++)n=t[e],t[e]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}}),a.MD5=s._createHelper(c),a.HmacMD5=s._createHmacHelper(c)}(Math),function(){var t=r,e=t.lib,n=e.Base,i=e.WordArray,e=t.algo,o=e.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,r=n.hasher.create(),o=i.create(),a=o.words,s=n.keySize,n=n.iterations;a.length<s;){u&&r.update(u);var u=r.update(t).finalize(e);r.reset();for(var c=1;n>c;c++)u=r.finalize(u),r.reset();o.concat(u)}return o.sigBytes=4*s,o}});t.EvpKDF=function(t,e,n){return o.create(n).compute(t,e)}}(),r.lib.Cipher||function(t){var e=r,n=e.lib,i=n.Base,o=n.WordArray,a=n.BufferedBlockAlgorithm,s=e.enc.Base64,u=e.algo.EvpKDF,c=n.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,n){this.cfg=this.cfg.extend(n),this._xformMode=t,this._key=e,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){return function(t){return{encrypt:function(e,n,r){return("string"==typeof n?g:p).encrypt(t,e,n,r)},decrypt:function(e,n,r){return("string"==typeof n?g:p).decrypt(t,e,n,r)}}}}()});n.StreamCipher=c.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var l=e.mode={},f=n.BlockCipherMode=i.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),l=l.CBC=function(){function e(e,n,r){var i=this._iv;i?this._iv=t:i=this._prevBlock;for(var o=0;r>o;o++)e[n+o]^=i[o]}var n=f.extend();return n.Encryptor=n.extend({processBlock:function(t,n){var r=this._cipher,i=r.blockSize;e.call(this,t,n,i),r.encryptBlock(t,n),this._prevBlock=t.slice(n,n+i)}}),n.Decryptor=n.extend({processBlock:function(t,n){var r=this._cipher,i=r.blockSize,o=t.slice(n,n+i);r.decryptBlock(t,n),e.call(this,t,n,i),this._prevBlock=o}}),n}(),h=(e.pad={}).Pkcs7={pad:function(t,e){for(var n=4*e,n=n-t.sigBytes%n,r=n<<24|n<<16|n<<8|n,i=[],a=0;n>a;a+=4)i.push(r);n=o.create(i,n),t.concat(n)},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}};n.BlockCipher=c.extend({cfg:c.cfg.extend({mode:l,padding:h}),reset:function(){c.reset.call(this);var t=this.cfg,e=t.iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else e=this._process(!0),t.unpad(e);return e},blockSize:4});var d=n.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),l=(e.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,t=t.salt;return(t?o.create([1398893684,1701076831]).concat(t).concat(e):e).toString(s)},parse:function(t){var t=s.parse(t),e=t.words;if(1398893684==e[0]&&1701076831==e[1]){var n=o.create(e.slice(2,4));e.splice(0,4),t.sigBytes-=16}return d.create({ciphertext:t,salt:n})}},p=n.SerializableCipher=i.extend({cfg:i.extend({format:l}),encrypt:function(t,e,n,r){var r=this.cfg.extend(r),i=t.createEncryptor(n,r),e=i.finalize(e),i=i.cfg;return d.create({ciphertext:e,key:n,iv:i.iv,algorithm:t,mode:i.mode,padding:i.padding,blockSize:t.blockSize,formatter:r.format})},decrypt:function(t,e,n,r){return r=this.cfg.extend(r),e=this._parse(e,r.format),t.createDecryptor(n,r).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),e=(e.kdf={}).OpenSSL={execute:function(t,e,n,r){return r||(r=o.random(8)),t=u.create({keySize:e+n}).compute(t,r),n=o.create(t.words.slice(e),4*n),t.sigBytes=4*e,d.create({key:t,iv:n,salt:r})}},g=n.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:e}),encrypt:function(t,e,n,r){return r=this.cfg.extend(r),n=r.kdf.execute(n,t.keySize,t.ivSize),r.iv=n.iv,t=p.encrypt.call(this,t,e,n.key,r),t.mixIn(n),t},decrypt:function(t,e,n,r){return r=this.cfg.extend(r),e=this._parse(e,r.format),n=r.kdf.execute(n,t.keySize,t.ivSize,e.salt),r.iv=n.iv,p.decrypt.call(this,t,e,n.key,r)}})}(),function(){var t=r,e=t.lib.BlockCipher,n=t.algo,i=[],o=[],a=[],s=[],u=[],c=[],l=[],f=[],h=[],d=[];!function(){for(var t=[],e=0;256>e;e++)t[e]=128>e?e<<1:e<<1^283;for(var n=0,r=0,e=0;256>e;e++){var p=r^r<<1^r<<2^r<<3^r<<4,p=p>>>8^255&p^99;i[n]=p,o[p]=n;var g=t[n],m=t[g],y=t[m],v=257*t[p]^16843008*p;a[n]=v<<24|v>>>8,s[n]=v<<16|v>>>16,u[n]=v<<8|v>>>24,c[n]=v,v=16843009*y^65537*m^257*g^16843008*n,l[p]=v<<24|v>>>8,f[p]=v<<16|v>>>16,h[p]=v<<8|v>>>24,d[p]=v,n?(n=g^t[t[t[y^g]]],r^=t[t[r]]):n=r=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=e.extend({_doReset:function(){for(var t=this._key,e=t.words,n=t.sigBytes/4,t=4*((this._nRounds=n+6)+1),r=this._keySchedule=[],o=0;t>o;o++)if(n>o)r[o]=e[o];else{var a=r[o-1];o%n?n>6&&4==o%n&&(a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a]):(a=a<<8|a>>>24,a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a],a^=p[o/n|0]<<24),r[o]=r[o-n]^a}for(e=this._invKeySchedule=[],n=0;t>n;n++)o=t-n,a=n%4?r[o]:r[o-4],e[n]=4>n||4>=o?a:l[i[a>>>24]]^f[i[a>>>16&255]]^h[i[a>>>8&255]]^d[i[255&a]]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,a,s,u,c,i)},decryptBlock:function(t,e){var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n,this._doCryptBlock(t,e,this._invKeySchedule,l,f,h,d,o),n=t[e+1],t[e+1]=t[e+3],t[e+3]=n},_doCryptBlock:function(t,e,n,r,i,o,a,s){for(var u=this._nRounds,c=t[e]^n[0],l=t[e+1]^n[1],f=t[e+2]^n[2],h=t[e+3]^n[3],d=4,p=1;u>p;p++)var g=r[c>>>24]^i[l>>>16&255]^o[f>>>8&255]^a[255&h]^n[d++],m=r[l>>>24]^i[f>>>16&255]^o[h>>>8&255]^a[255&c]^n[d++],y=r[f>>>24]^i[h>>>16&255]^o[c>>>8&255]^a[255&l]^n[d++],h=r[h>>>24]^i[c>>>16&255]^o[l>>>8&255]^a[255&f]^n[d++],c=g,l=m,f=y;g=(s[c>>>24]<<24|s[l>>>16&255]<<16|s[f>>>8&255]<<8|s[255&h])^n[d++],m=(s[l>>>24]<<24|s[f>>>16&255]<<16|s[h>>>8&255]<<8|s[255&c])^n[d++],y=(s[f>>>24]<<24|s[h>>>16&255]<<16|s[c>>>8&255]<<8|s[255&l])^n[d++],h=(s[h>>>24]<<24|s[c>>>16&255]<<16|s[l>>>8&255]<<8|s[255&f])^n[d++],t[e]=g,t[e+1]=m,t[e+2]=y,t[e+3]=h},keySize:8});t.AES=e._createHelper(n)}(),n.CryptoJS=r},{}],5:[function(t,e,n){(function(e){var r=t("./../FieldDBObject").FieldDBObject,i=t("diacritic"),o=function(t){if(this._fieldDBtype||(this._fieldDBtype="Connection"),this.debug("Constructing Connection ",t),t){var e=["dbname","pouchname","title","titleAsUrl"];e.map(function(e){"default"===t[e]&&(t[e]="")})}r.apply(this,arguments)};o.DEFAULT_LOCALHOST_CONNECTION=function(t){return{corpusid:"TBA",dbname:t.dbname,protocol:"https://",domain:"localhost",port:"3183",path:"",userFriendlyServerName:"Localhost",authUrls:["https://localhost:3182"],clientUrls:[{userFriendlyClientName:"Spreadsheet",url:"chrome-extension://pcflbgejbbgijjbmaodhhbibegdfecjc/index.html"},{userFriendlyClientName:"Prototype Online",url:"https://localhost:6984/"+t.dbname+"/_design/pages/corpus.html"},{userFriendlyClientName:"Localhost Chrome App",url:"chrome-extension://kaaemcdklbfiiaihlnkmknkgbnkamcbh/user.html#corpus/"+t.dbname},{userFriendlyClientName:"Public Url",url:"https://localhost:3182/"+t.username+"/"+t.corpusidentifier+"/"+t.dbname},{userFriendlyClientName:"Activity Feed",url:"https://localhost:6984/"+t.dbname+"-activity_feed/_design/activity/activity_feed.html"}],corpusUrls:["https://localhost:6984/"+t.dbname],lexiconUrls:["https://localhost:3185/train/lexicon/"+t.dbname],searchUrls:["https://localhost:3195/search/"+t.dbname],audioUrls:["https://localhost:3184/"+t.dbname+"/utterances"],activityUrls:["https://localhost:6984/"+t.dbname+"-activity_feed"]}},o.prototype=Object.create(r.prototype,{constructor:{value:o},INTERNAL_MODELS:{value:{corpusid:r.DEFAULT_STRING,titleAsUrl:r.DEFAULT_STRING,dbname:r.DEFAULT_STRING,pouchname:r.DEFAULT_STRING,protocol:r.DEFAULT_STRING,domain:r.DEFAULT_STRING,port:r.DEFAULT_STRING,path:r.DEFAULT_STRING,userFriendlyServerName:r.DEFAULT_STRING,authUrls:r.DEFAULT_ARRAY,clientUrls:r.DEFAULT_ARRAY,corpusUrls:r.DEFAULT_ARRAY,lexiconUrls:r.DEFAULT_ARRAY,searchUrls:r.DEFAULT_ARRAY,audioUrls:r.DEFAULT_ARRAY,websiteUrls:r.DEFAULT_ARRAY,activityUrls:r.DEFAULT_ARRAY}},guessDbType:{value:function(t){if(t){var e;return e=t.indexOf("activity_feed")>-1?t.split("-").length>=3?"corpus_activity_feed":"user_activity_feed":"corpus"}}},dbname:{get:function(){return this.parent&&this.parent.dbname?this.parent.dbname:this._dbname},set:function(t){if(t!==this._dbname){if(!t)return void delete this._dbname;if("function"==typeof t.trim){if(t=t.trim(),"default"!==t){var e=t.split("-"),n=e.shift(),r=e.join("-");n=o.validateUsername(n),r=o.validateIdentifier(r),n.changes&&n.changes.length>0&&this.warn(n.changes.join("; "),n.originalIdentifier),r.changes&&r.changes.length>0&&this.warn(r.changes.join("; "),r.originalIdentifier),t=n.identifier+"-"+r.identifier}this._dbname=t}}}},owner:{get:function(){if(this.dbname){var t=this.dbname.split("-"),e=t[0];return e}}},gravatar:{get:function(){return this.parent&&this.parent.team&&(this._gravatar=this.parent.team.gravatar?this.parent.team.gravatar:this.parent.team.buildGravatar(this.dbname)),this._gravatar},set:function(t){if(t!==this._gravatar){if(!t)return void delete this._gravatar;"function"==typeof t.trim&&(t=t.trim()),this._gravatar=t}}},corpusid:{get:function(){return!this._corpusid&&this.parent&&this.parent.id&&this.parent.rev&&"function"==typeof this.parent.normalizeFieldWithExistingCorpusFields&&(this._corpusid=this.parent.id),this._corpusid},set:function(t){if(t!==this._corpusid){if(!t)return void delete this._corpusid;"function"==typeof t.trim&&(t=t.trim()),this._corpusid=t}}},title:{get:function(){return this.parent&&(this._title=this.parent.title),!this._title&&this.dbname&&(this._title=this.dbname),this._title},set:function(t){if(t!==this._title){if(!t)return void delete this._title;"function"==typeof t.trim&&(t=t.trim()),this._title=t,this._titleAsUrl=""}}},titleAsUrl:{get:function(){return this.parent&&this.parent.titleAsUrl&&(this._titleAsUrl=this.parent.titleAsUrl),this._titleAsUrl||this.title&&(this._titleAsUrl=this.sanitizeStringForFileSystem(this.title,"_").toLowerCase()),this._titleAsUrl},set:function(t){if(t!==this._titleAsUrl){if(!t)return void delete this._titleAsUrl;"function"==typeof t.trim&&(t=t.trim()),this._titleAsUrl=t}}},authUrl:{get:function(){return this.authUrls&&this.authUrls[0]?this.authUrls[0]:""},set:function(t){if((!this.authUrls||t!==this.authUrls[0])&&t)if("function"==typeof t.trim&&(t=t.trim()),t=t.replace(/[^.\/]*.fieldlinguist.com:3183/g,"auth.lingsync.org"),this.authUrls)if(0===this.authUrls.length)this.authUrls.unshift(t);else{var e=this.authUrls.indexOf(t);e>-1&&this.authUrls.splice(e,1),this.authUrls.unshift(t)}else this.authUrls=[t]}},domain:{get:function(){return this._domain||""},set:function(t){if(t!==this._domain){if(!t)return void delete this._domain;"function"==typeof t.trim&&(t=t.trim(),t=t.replace(/ifielddevs.iriscouch.com/g,"corpus.lingsync.org")),this._domain=t}}},corpusUrl:{get:function(){if(this.corpusUrls&&this.corpusUrls[0])return this.corpusUrls[0];if(!this.domain||!this.dbname)return"";var t=this.protocol+this.domain;this.port&&"443"!==this.port&&"80"!==this.port&&(t=t+":"+this.port);var e=this.path||"";return e&&(e="/"+e),t+=e,t=t+"/"+this.dbname,t=t.replace("http://localhost:5984","https://localhost:6984"),this.corpusUrls=[t],t},set:function(t){if((!this.corpusUrls||t!==this.corpusUrls[0])&&t)if("function"==typeof t.trim&&(t=t.trim(),t=t.replace("http://localhost:5984","https://localhost:6984")),this.corpusUrls)if(0===this.corpusUrls.length)this.corpusUrls.unshift(t);else{var e=this.corpusUrls.indexOf(t);e>-1&&this.corpusUrls.splice(e,1),this.corpusUrls.unshift(t)}else this.corpusUrls=[t]}},websiteUrl:{get:function(){return this.websiteUrls&&this.websiteUrls[0]?this.websiteUrls[0]:void 0},set:function(t){if((!this.websiteUrls||t!==this.websiteUrls[0])&&t)if("function"==typeof t.trim&&(t=t.trim()),this.websiteUrls)if(0===this.websiteUrls.length)this.websiteUrls.unshift(t);else{var e=this.websiteUrls.indexOf(t);e>-1&&this.websiteUrls.splice(e,1),this.websiteUrls.unshift(t)}else this.websiteUrls=[t]}},website:{get:function(){return this.websiteUrl},set:function(t){this.websiteUrl=t}},brand:{get:function(){return this.userFriendlyServerName},set:function(t){this.userFriendlyServerName=t}},brandLowerCase:{get:function(){return this._brandLowerCase||this.serverLabel},set:function(t){this._brandLowerCase=t}},replicatedCorpusUrls:{get:function(){return this._replicatedCorpusUrls||r.DEFAULT_COLLECTION},set:function(t){return t!==this._replicatedCorpusUrls?t?void(this._replicatedCorpusUrls=t):void delete this._replicatedCorpusUrls:void 0}},olacExportConnections:{get:function(){return this._olacExportConnections||r.DEFAULT_COLLECTION},set:function(t){return t!==this._olacExportConnections?t?void(this._olacExportConnections=t):void delete this._olacExportConnections:void 0}},toJSON:{value:function(t,e){this.debug("Customizing toJSON ",t,e),t=!0,this.debug(" forcing corpusUrls to be defined ",this.corpusUrl);var n=r.prototype.toJSON.apply(this,arguments);return delete n.dateCreated,delete n.dateModified,delete n.database,n.pouchname=n.dbname=this.dbname||"",n.title=this.title||n.dbname,n.titleAsUrl=this.titleAsUrl||n.dbname,n.fieldDBtype=this.fieldDBtype,delete n._type,this.debug(n),n}}}),o.knownConnections={localhost:{protocol:"https://",domain:"localhost",port:"6984",dbname:"default",path:"",serverLabel:"localhost",authUrls:["https://localhost:3183"],websiteUrls:["https://localhost:3182"],userFriendlyServerName:"Localhost"},beta:{protocol:"https://",domain:"corpusdev.lingsync.org",port:"443",dbname:"default",path:"",serverLabel:"beta",brandLowerCase:"lingsync_beta",authUrls:["https://authdev.lingsync.org"],websiteUrls:["http://lingsync.org"],userFriendlyServerName:"LingSync Beta"},lingsync:{protocol:"https://",domain:"corpus.lingsync.org",port:"443",dbname:"default",path:"",serverLabel:"production",brandLowerCase:"lingsync",authUrls:["https://auth.lingsync.org"],websiteUrls:["http://lingsync.org"],userFriendlyServerName:"LingSync.org"},mcgill:{protocol:"https://",domain:"corpus.lingsync.org",port:"443",dbname:"default",path:"",serverLabel:"mcgill",authUrls:["https://auth.lingsync.org"],websiteUrls:["http://lingsync.org"],userFriendlyServerName:"McGill ProsodyLab"},concordia:{protocol:"https://",domain:"corpus.lingsync.org",port:"443",dbname:"default",path:"",serverLabel:"concordia",authUrls:["https://auth.lingsync.org"],websiteUrls:["http://lingsync.org"],userFriendlyServerName:"Concordia Linguistics"}},o.knownConnections.production=o.knownConnections.lingsync,o.defaultConnection=function(t,n){var r,i="production";try{i=e.env.NODE_DEPLOY_TARGET||"localhost"}catch(a){}if(o.knownConnections||(o.knownConnections={}),o.knownConnections.localhost||(o.knownConnections.localhost={protocol:"https://",domain:"localhost",port:"6984",dbname:"default",path:"",serverLabel:"localhost",brandLowerCase:"localhost",authUrls:["https://localhost:3183"],userFriendlyServerName:"Localhost"}),!t)try{window&&window.location?t=window.location.href:(r=o.knownConnections[i],t=r.authUrls[0])}catch(a){r=o.knownConnections[i],t=r.authUrls[0]}if(o.knownConnections[t]?r=o.knownConnections[t]:t.indexOf("_design/pages")>-1?t.indexOf("corpusdev.lingsync.org")>=0?r=o.knownConnections.beta:t.indexOf("lingsync.org")>=0?r=o.knownConnections.production:t.indexOf("prosody.linguistics.mcgill")>=0?r=o.knownConnections.mcgill:t.indexOf("localhost")>=0&&(r=o.knownConnections.localhost):t.indexOf("jlbnogfhkigoniojfngfcglhphldldgi")>=0?r=o.knownConnections.mcgill:t.indexOf("eeipnabdeimobhlkfaiohienhibfcfpa")>=0?r=o.knownConnections.beta:t.indexOf("ocmdknddgpmjngkhcbcofoogkommjfoj")>=0?r=o.knownConnections.production:t.indexOf("dev.lingsync.org")>=0?r=o.knownConnections.beta:t.indexOf("lingsync.org")>=0?r=o.knownConnections.production:t.indexOf("prosody.linguistics.mcgill")>=0?r=o.knownConnections.mcgill:t.indexOf("linguistics.concordia")>=0?r=o.knownConnections.concordia:t.indexOf("lingsync")>=0?r=o.knownConnections.production:t.indexOf("localhost")>=0&&(r=o.knownConnections[i]),!r){console.warn("The user is trying to use a server which is unknown to the system. Attempting to construct its connection. ",t);var s;try{o.URLParser||(o.URLParser=URL)}catch(a){console.log("Cant figure out what the URL parser is"),o.URLParser={parse:function(t){return console.warn("Not parsing this url",t),{}}}}try{s=new o.URLParser(t)}catch(a){console.warn("Cant use new Connection.URLParser() in this environment.",a),s=o.URLParser.parse(t)}if(s&&s.hostname){for(var u=s.hostname.split(".");u.length>2;)u.shift();u=u.join("."),r={protocol:s.protocol+"//",domain:s.hostname,port:s.port,dbname:"default",path:s.pathname.replace("/",""),serverLabel:u.substring(0,u.lastIndexOf(".")),brandLowerCase:u.substring(0,u.lastIndexOf(".")),authUrls:[t],userFriendlyServerName:u},o.knownConnections[r.serverLabel]=r}else console.warn("There was no way to deduce the HREF, probably we are in Node. Using "+i+" instead. ",t),r=o.knownConnections[i]}return n||(r=new o(r).clone()),r},o.validateIdentifier=function(t,e){if(!t)return{changes:["Identifier was empty"]};var n=t.toString(),r=[];return n.toLowerCase()!==n&&(r.push("The identifier has to be lowercase so that it can be used in your CouchDB database names."),n=n.toLowerCase()),n.split("-").length>1&&e&&(n=n.replace(/-/g,""),r.push("We are using - as a reserved symbol in database URIs (Uniform Resource Identifiers), so you can't use it in your username.")),i.clean(n)!==n&&(r.push("You have to use ascii characters in your identifiers because your identifier is used in your in web urls, so its better if you can use something more web friendly."),
n=i.clean(n)),n.replace(/[^a-z0-9_-]/g,"_")!==n&&(r.push("You have some characters which web servers wouldn't trust in your identifier."),n=e?n.replace(/[^a-z0-9_-]/g,""):n.replace(/[^a-z0-9_-]/g,"_")),n.length<2&&r.push("Your identifier is really too short."),r.length>0&&r.unshift("You asked to use "+t+" but we would reccomend using this instead: "+n+" the following are a list of reason's why."),{identifier:n,original:t,changes:r}},o.validateUsername=function(t){return o.validateIdentifier(t,"username")},o.baseSchema={id:"Connection",properties:{corpusid:{type:"string"},dbname:{type:"string"},pouchname:{type:"string"},protocol:{type:"string"},domain:{type:"string"},port:{type:"string"},path:{type:"string"},authUrl:{items:{$ref:"string"},type:"Array"},clientUrls:{items:{$ref:"ClientApp"},type:"Array"},corpusUrls:{items:{$ref:"string"},type:"Array"},lexiconUrls:{items:{$ref:"string"},type:"Array"},searchUrls:{items:{$ref:"string"},type:"Array"},audioUrls:{items:{$ref:"string"},type:"Array"}}},n.Connection=o}).call(this,t("_process"))},{"./../FieldDBObject":2,_process:22,diacritic:9}],6:[function(t,e,n){var r=t("q"),i=t("../CORS").CORS,o=t("../FieldDBObject").FieldDBObject,a=t("./../confidentiality_encryption/Confidential").Confidential,s=t("./Connection").Connection,u=function p(t){p.URLParser&&!s.URLParser&&(s.URLParser=p.URLParser),this._fieldDBtype||(this._fieldDBtype="Database"),this.debug("In Database ",t),o.apply(this,arguments)},c="_design/pages/_view/COLLECTION?descending=true&limit=LIMIT",l="https://localhost:3183",f="https://localhost:6984";u.defaultConnection=s.defaultConnection,u.DEFAULT_DOCUMENT_LIMIT=1e3,u.prototype=Object.create(o.prototype,{constructor:{value:u},fieldDBtype:{get:function(){return this._fieldDBtype||"Database"},set:function(t){t!==this.fieldDBtype&&this.debug("Using type "+this.fieldDBtype+" when the incoming object was "+t)}},INTERNAL_MODELS:{value:{connection:s}},DEFAULT_COLLECTION_MAPREDUCE:{value:c},BASE_AUTH_URL:{get:function(){return l},set:function(t){l=t}},BASE_DB_URL:{get:function(){return f},set:function(t){f=t}},connection:{get:function(){return this.debug("getting connection"),this._connection&&this._connection.parent!==this&&(this._connection.parent=this),this._connection},set:function(t){t&&(t.parent=this),this.ensureSetViaAppropriateType("connection",t),this._connection&&this._connection.dbname&&"default"!==this._connection.dbname&&!this.dbname&&(this.dbname=this._connection.dbname)}},url:{get:function(){return this.connection&&this.connection.corpusUrl?this.connection.corpusUrl:this.dbname?this.BASE_DB_URL+"/"+this.dbname:(this.warn("Using an unlikely url, as if this app was running in a website where the databse is."),"")},set:function(t){this.debug("Setting url  ",t),this.connection||(this.connection=s.defaultConnection(t)),this.dbname&&-1===t.indexOf(this.dbname)&&(this.warn("the url didnt contain this database identifier, that is strange. Adding it to the end",t),t=t+"/"+this.dbname),this.connection.corpusUrl=t}},get:{value:function(t,e){return e=e||this.url,e||this.bug("The url could not be extrapolated for this database, that is strange. The app will likely behave abnormally."),i.makeCORSRequest({method:"GET",url:e+"/"+t})}},set:{value:function(t,e,n){if(!this.dbname)throw this.bug("Cannot get something if the dbname is not defined ",t,e),new Error("Cannot get something if the dbname is not defined ");var o,a,s=r.defer(),u=this;return e?(o=t,a=e,a.id=o):a=t,this.url||(this.bug("the url could not be extrapolated for this database, that is strange. The app will likely behave abnormally."),this.todo("Consider letting users/apps use the optionalUrl in individual save of docs",n)),i.makeCORSRequest({method:"POST",data:a,url:this.url}).then(function(t){return t&&t.ok?(t.rev&&(a.rev=a._rev=t.rev),t.id&&(a.id=a._id=t.id),void s.resolve(a)):(t.status=t.status||400,t.userFriendlyErrors=t.userFriendlyErrors||["This application has errored. Please notify its developers: Cannot save data. If you keep your browser open, you will not loose your work."],void s.reject(t))},function(t){t||(t={status:400,userFriendlyErrors:["This application has errored. Please notify its developers: Cannot save data. If you keep your browser open, you will not loose your work."]}),t.details=a,u.debug(t),s.reject(t)}).fail(function(t){console.error(t.stack,u),s.reject(t)}),s.promise}},fetchRevisions:{value:function(t,e){var n=r.defer(),o=this;return t?(e=e||this.url,i.makeCORSRequest({method:"GET",url:e+"/"+t+"?revs_info=true"}).then(function(r){var i=[];r._revs_info.map(function(n){"available"===n.status&&i.push(e+"/"+t+'?rev="'+n.rev+'"')}),n.resolve(i)},function(t){t||(t={status:400,userFriendlyErrors:["This application has errored. Please notify its developers: Cannot save data. If you keep your browser open, you will not loose your work."]}),o.debug(t),n.reject(t)}).fail(function(t){console.error(t.stack,o),n.reject(t)}),n.promise):(r.nextTick(function(){n.resolve(o._revisions||[])}),n.promise)}},"delete":{value:function(t){return this.remove(t)}},remove:{value:function(t){throw this.bug("Deleting data is not permitted.",t),new Error("Deleting data is not permitted.")}},fetchAllDocuments:{value:function(){return this.fetchCollection("datums")}},fetchCollection:{value:function(t,e,n,o,a,s){var u=r.defer(),c=this;if(!t)return r.nextTick(function(){u.reject({status:406,userFriendlyErrors:["This application has errored. Please notify its developers: Cannot fetch data url."]})}),u.promise;s=s?'&key="'+s+'"':"",o=o||1e3;var l=t,f=function(e){c.debug(e),404===e.status&&(e.userFriendlyErrors=l===t?["The server didn't know about the collection "+t+"you requested. Please try another url."]:["The application was unable to request the "+t+" collection. Please report this 290323."]),u.reject(e)};if("[object Array]"===Object.prototype.toString.call(t)){var h=[];t.map(function(t){h.push(i.makeCORSRequest({type:"GET",dataType:"json",url:c.url+"/"+t}))}),r.allSettled(h).then(function(t){c.debug(t),u.resolve(t.length?t.map(function(t){return"fulfilled"===t.state?t.value:{}}):[])},f).fail(function(t){console.error(t.stack,c),u.reject(t)})}else-1===t.indexOf("/")?t=c.url+"/"+c.DEFAULT_COLLECTION_MAPREDUCE.replace("COLLECTION",t).replace("LIMIT",o)+s:-1===t.indexOf("://")?t=c.url+"/"+t:this.warn("Fetching data from a user supplied url",t),i.makeCORSRequest({type:"GET",dataType:"json",url:t}).then(function(t){if(!t.rows||!t.rows.length){var e=[];for(var n in t)t.hasOwnProperty(n)&&t[n].collection&&"datalists"===t[n].collection&&e.push(t[n]);return e&&1===e.length?(u.resolve(e[0]),e[0]):(u.resolve(e),e)}u.resolve(t.rows.map(function(t){return t.value}))},f).fail(function(t){console.error(t.stack,c),u.reject(t)});return u.promise}},couchSessionUrl:{get:function(){var t=this.url;return t||(t=this.application&&this.application.connection&&this.application.connection.corpusUrl?this.application.connection.corpusUrl:this.connection&&this.connection.corpusUrl?this.connection.corpusUrl:this.BASE_DB_URL),this.dbname&&t.indexOf(this.dbname)>0?t=t.replace(this.dbname,"_session"):this.connection&&this.connection.dbname&&t.indexOf(this.connection.dbname)>0?t=t.replace(this.connection.dbname,"_session"):t+="/_session",t}},resumeAuthenticationSession:{value:function(){var t=r.defer(),e=this;return i.makeCORSRequest({type:"GET",dataType:"json",url:this.couchSessionUrl}).then(function(n){e.debug(n),e.connectionInfo=n,n.userCtx.name?t.resolve({username:n.userCtx.name,roles:n.userCtx.roles}):t.reject({error:n,userFriendlyErrors:["Please login."],status:401})},function(e){t.reject(e)}).fail(function(n){console.error(n.stack,e),t.reject(n)}),t.promise}},connectionInfo:{get:function(){var t;try{t=localStorage.getItem("_connectionInfo")}catch(e){this.warn("Localstorage is not available, there will be no connectionInfo persistance across loads"),this.debug("Localstorage is not available, using the object there will be no persistance across loads",e,this._connectionInfo),t=this._connectionInfo}if(t){try{t=new a({secretkey:"connectionInfo"}).decrypt(t)}catch(e){this.warn("unable to read the connectionInfo info, ",e,this._connectionInfo),t=void 0}return t}},set:function(t){if(t)try{localStorage.setItem("_connectionInfo",new a({secretkey:"connectionInfo"}).encrypt(t))}catch(e){this._connectionInfo=new a({secretkey:"connectionInfo"}).encrypt(t),this.debug("Localstorage is not available, using the object there will be no persistance across loads",e,this._connectionInfo)}else try{localStorage.removeItem("_connectionInfo")}catch(e){this.debug("Localstorage is not available, using the object there will be no persistance across loads",e,this._connectionInfo),delete this._connectionInfo}}},getCouchUrl:{value:function(){return this.corpusUrl}},login:{value:function(t){var e=r.defer(),n=this;return r.nextTick(function(){if(!t)return void e.reject({details:t,userFriendlyErrors:["This application has errored, please contact us."],status:412});var r="name";if(!t.authUrl&&t.name&&(t.authUrl=n.BASE_DB_URL+"/_session"),t.authUrl=n.deduceAuthUrl(t.authUrl),-1===t.authUrl.indexOf("/_session")&&-1===t.authUrl.indexOf("/login")&&(t.authUrl=t.authUrl+"/login",r="username"),!t[r])return void e.reject({details:t,userFriendlyErrors:["Please supply a username."],status:412});if(!t.name&&t.authUrl.indexOf("/_session")>-1)return void e.reject({details:t,userFriendlyErrors:["Please supply a username."],status:412});if(!t.password)return void e.reject({details:t,userFriendlyErrors:["Please supply a password."],status:412});var o=s.validateUsername(t[r]);return o.changes.length>0?(t[r]=o.identifier,n.warn(" Invalid username ",o.changes.join("\n ")),void e.reject({error:o,userFriendlyErrors:o.changes,status:412})):void i.makeCORSRequest({type:"POST",dataType:"json",url:t.authUrl,data:t}).then(function(t){t&&t.user?(t.info&&"Preferences saved."===t.info[0]&&n.application.authentication&&(n.application.authentication="Welcome back "+t.user.username),e.resolve(t.user)):t&&t.roles?e.resolve(t):(t=t||{},t.userFriendlyErrors=t.userFriendlyErrors||[" Unknown response from server, please report this."],e.reject(t))},function(r){r.details=t,n.debug(r),e.reject(r)}).fail(function(t){n.debug(t),e.reject(t)})}),e.promise}},logout:{value:function(t){var e=r.defer(),n=this;return t||(t=this.couchSessionUrl),t&&-1!==t.indexOf("/_session")&&t.lastIndexOf("/_session")===t.length-"/_session".length?(i.makeCORSRequest({type:"DELETE",dataType:"json",url:t}).then(function(t){t.ok?(n.connectionInfo=null,e.resolve(t)):e.reject(t)},function(t){t=t||{},n.debug(t),e.reject(t)}).fail(function(t){console.error(t.stack,n),t.status=t.status||400,t.userFriendlyErrors=t.userFriendlyErrors||["Unknown error, please report this 8912."],e.reject(t)}),e.promise):(r.nextTick(function(){e.reject({userFriendlyErrors:["You cannot log out of "+t+" using this application."],status:412})}),e.promise)}},deduceAuthUrl:{value:function(t){return t||(t=this.authUrl?this.authUrl:this.application&&this.application.connection&&this.application.connection.authUrl?this.application.connection.authUrl:this.BASE_AUTH_URL),t}},register:{value:function(t){var e=r.defer(),n=this;return r.nextTick(function(){if(!t&&n.dbname&&2===n.dbname.split("-").length&&(t={username:n.dbname.split("-")[0],password:"testtest",confirmPassword:"testtest",connection:new s(s.knownConnections.production)},t.authUrl=t.connection.authUrl),!t)return void e.reject({details:t,userFriendlyErrors:["This application has errored, please contact us."],status:412});if(t.authUrl=n.deduceAuthUrl(t.authUrl),!t.username)return void e.reject({details:t,userFriendlyErrors:["Please supply a username."],status:412});if(!t.password)return void e.reject({details:t,userFriendlyErrors:["Please supply a password."],status:412});if(!t.confirmPassword)return void e.reject({details:t,userFriendlyErrors:["Please confirm your password."],status:412});if(t.confirmPassword!==t.password)return void e.reject({details:t,userFriendlyErrors:["Passwords don't match, please double check your password."],status:412});var r=s.validateUsername(t.username);return r.changes.length>0?(t.username=r.identifier,n.warn(" Invalid username ",r.changes.join("\n ")),void e.reject({error:r,details:t,userFriendlyErrors:r.changes,status:412})):(t.connection||(t.connection=n.application&&n.application.connection&&n.application.connection.authUrl?n.application.connection:s.defaultConnection(t.authUrl),delete t.connection.dbname,delete t.connection.pouchname,delete t.connection.title,delete t.connection.titleAsUrl,delete t.connection.corpusUrl),!t.appbrand&&n.application&&n.application.brandLowerCase&&(t.appbrand=n.application.brandLowerCase),t.appVersionWhenCreated=n.version,void i.makeCORSRequest({type:"POST",dataType:"json",url:t.authUrl+"/register",data:t}).then(function(r){return n.debug("registration results",r),r.user?void e.resolve(r.user):void e.reject({error:r,status:500,details:t,userFriendlyErrors:r.userFriendlyErrors||["Unknown error. Please report this 2391."]})},function(r){r=r||{},r.details=r.details||t,n.debug(r),e.reject(r)}).fail(function(r){console.error(r.stack,n),r.status=r.status||400,r.details=r.details||t,r.userFriendlyErrors=r.userFriendlyErrors||["Unknown error, please report this 1289128."],e.reject(r)}))}),e.promise}},replicateContinuouslyWithCouch:{value:function(t,e){var n=this;return n.pouch?void n.pouch(function(r,i){var o=n.connection.couchUrl;r?(n.debug("Opening db error",r),"function"==typeof e?e():(this.bug("Opening DB error"+JSON.stringify(r)),n.debug("Opening DB error"+JSON.stringify(r)))):(n.debug("Opening db success",i),n.bug("TODO check to see if  needs a slash if replicating with pouch on "+o),n.replicateFromCorpus(i,o,function(){n.replicateToCorpus(i,o)},function(){n.replicateToCorpus(i,o)}).fail(function(t){console.error(t.stack,n)}),"function"==typeof t&&t())}):(n.debug("Not replicating, no pouch ready."),void("function"==typeof t&&t()))}},replicateOnlyFromCorpus:{value:function(t,e,n){var r=this;return r.pouch?void r.pouch(function(t,i){var o=r.connection.corpusUrl;t?(r.debug("Opening db error",t),"function"==typeof n?n():(r.bug("Opening DB error"+JSON.stringify(t)),r.debug("Opening DB error"+JSON.stringify(t)))):i.replicate.from(o,{continuous:!1},function(t,i){r.debug("Replicate from "+o,i,t),t?"function"==typeof n?n():(r.bug("Corpus replicate from error"+JSON.stringify(t)),r.debug("Corpus replicate from error"+JSON.stringify(t))):(r.debug("Corpus replicate from success",i),"function"==typeof e&&e())})}):(r.debug("Not replicating, no pouch ready."),void("function"==typeof e&&e()))}},replicateToCorpus:{value:function(t,e,n,r){var i=this;t.replicate.to(e,{continuous:!0},function(t,o){i.debug("Replicated to "+e),i.debug(o),i.debug(t),t?(i.debug("replicate to db  error",t),"function"==typeof r?r():(i.bug("Database replicate to error"+JSON.stringify(t)),i.debug("Database replicate to error"+JSON.stringify(t)))):(i.debug("Database replicate to success",o),"function"==typeof n?n():i.debug("Database replicating"+JSON.stringify(i.connection)))})}},replicateFromCorpus:{value:function(t,e,n,r){var i=this;t.replicate.from(e,{continuous:!0},function(t,o){i.debug("Replicated from "+e),i.debug(o),i.debug(t),t?(i.debug("replicate from db  error",t),"function"==typeof r?r():(i.bug("Database replicate from error"+JSON.stringify(t)),i.debug("Database replicate from error"+JSON.stringify(t)))):(i.debug("Database replicate from success",o),"function"==typeof n?n():i.debug("Database replicating"+JSON.stringify(i.connection)))})}},changePouch:{value:function(t,e){void 0===this.pouch&&(this.pouch=o.sync.pouch(this.isAndroidApp()?t.touchUrl+t.dbname:t.pouchUrl+t.dbname)),"function"==typeof e&&e()}},addCorpusRoleToUser:{value:function(t,e,n,r){this.debug("deprecated ",t,e,n,r)}}}),n.Database=u;var h=h||{};h.CORS=i,h.setXMLHttpRequestLocal=function(t){h.CORS=t},h.connection={localCouch:{connected:!1,url:"https://localhost:6984",couchUser:null},centralAPI:{connected:!1,url:"https://localhost:3183",fieldDBUser:null}},h.connect=function(){var t=r.defer();if(this.timestamp&&this.connection.couchUser&&this.connection.fieldDBUser&&Date.now()-this.timestamp<1e3)return console.log("connection information is not old."),r.nextTick(function(){t.resolve(this.connection)}),t.promise;var e=r.defer(),n=r.defer(),i=[e.promise,n.promise],o=this;return h.CORS.makeCORSRequest({method:"GET",dataType:"json",url:o.connection.localCouch.url+"/_session"}).then(function(t){return this.timestamp=Date.now(),console.log(t),t&&t.userCtx?(o.connection.localCouch.connected=!0,o.connection.localCouch.timestamp=Date.now(),o.connection.localCouch.couchUser=t.userCtx,void(t.userCtx.name||h.CORS.makeCORSRequest({method:"POST",dataType:"json",data:{name:"public",password:"none"},url:o.connection.localCouch.url+"/_session"}).then(function(){console.log("Logged the user in as the public user so they can only see public info."),e.resolve(t)}).fail(function(t){console.log("The public user doesnt exist on this couch...",t),e.reject(t)}))):(o.connection.localCouch.connected=!1,o.connection.localCouch.timestamp=Date.now(),void e.reject({eror:'Recieved an odd response from the local couch. Can"t contact the local couchdb, it might be off or it might not be installed. This device can work online only.'}))}).fail(function(t){this.timestamp=Date.now(),console.log(t),o.connection.localCouch.connected=!1,o.connection.localCouch.timestamp=Date.now(),e.reject(t)}),h.CORS.makeCORSRequest({method:"GET",dataType:"json",url:o.connection.centralAPI.url+"/users"}).then(function(t){return this.timestamp=Date.now(),console.log("FieldDBConnection",t),t&&t.user?(o.connection.centralAPI.connected=!0,o.connection.centralAPI.timestamp=Date.now(),o.connection.localCouch.user=t.user,void(t.user.username||h.CORS.makeCORSRequest({method:"POST",dataType:"json",data:{username:"public",password:"none"},url:o.connection.centralAPI.url+"/users"}).then(function(){console.log("Logged the user in as the public user so they can only see public info."),n.resolve(t)}).fail(function(t){console.log('The public user doesn"t exist on this couch...',t),n.reject(t)}))):(o.connection.centralAPI.connected=!1,o.connection.centralAPI.timestamp=Date.now(),void n.reject({eror:'Received an odd response from the api. Can"t contact the api server. This is a bug which must be reported.'}))}).fail(function(t){this.timestamp=Date.now(),console.log(t),o.connection.centralAPI.connected=!1,o.connection.centralAPI.timestamp=Date.now(),n.reject(t)}),r.allSettled(i).then(function(e){console.log(e),t.resolve(this.connection)}),t.promise},n.FieldDBConnection=h;var d=function(t,e){this.url=t,this.user=e,this.result={},this.uploadResult={},this.login=function(t){var e=this;i.makeCORSRequest({type:"POST",url:e.url,data:e.user,success:function(n){e.result=n,console.log("server contacted",n),"function"==typeof t&&t()},error:function(t){e.result=t,console.log("There was a problem contacting the server to login.")}})},this.uploadADocument=function(t,e,n){var r=this;r.uploadResult={};var o="POST",a=e;t.id&&(o="PUT",a=e+"/"+t._id);var s=function(){i.makeCORSRequest({type:o,url:r.url.replace("_session",a),data:t,success:function(t){r.uploadResult=t,console.log("server contacted",t),"function"==typeof n&&n()},error:function(t){r.uploadResult=t,console.log("There was a problem contacting the server to upload.")}})};this.loggedIn?s():this.login(s)},this.docUploaded=function(){return this.uploadResult.ok},this.loggedIn=function(){return this.result.name===this.user.name},this.assertLoginSuccessful=function(){expect(this.result.name).toEqual(this.user.name)},this.assertUploadSuccessful=function(){expect(this.uploadResult.ok).toBeTruthy()}};n.CouchDBConnection=d},{"../CORS":1,"../FieldDBObject":2,"./../confidentiality_encryption/Confidential":3,"./Connection":5,q:10}],7:[function(t,e,n){(function(t){!function(){"use strict";function n(e){return new t(e,"base64").toString("binary")}e.exports=n}()}).call(this,t("buffer").Buffer)},{buffer:18}],8:[function(t,e,n){(function(t){!function(){"use strict";function n(e){var n;return n=e instanceof t?e:new t(e.toString(),"binary"),n.toString("base64")}e.exports=n}()}).call(this,t("buffer").Buffer)},{buffer:18}],9:[function(t,e,n){!function(t,n){"undefined"!=typeof e&&e.exports?e.exports=n():"function"==typeof define&&define.amd?define(n):this[t]=n()}("Diacritics",function(){for(var t={map:{}},e=[{base:" ",letters:""},{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"Th",letters:""},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"ff",letters:""},{base:"fi",letters:""},{base:"fl",letters:""},{base:"ffi",letters:""},{base:"ffl",letters:""},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"nn"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oe",letters:""},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"ss",letters:""},{base:"t",letters:"t"},{base:"th",letters:""},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],n=0,r=e.length;r>n;n++)for(var i=e[n].letters.split(""),o=0,a=i.length;a>o;o++)t.map[i[o]]=e[n].base;return t.clean=function(e){if(!e||!e.length||e.length<1)return"";for(var n,r="",i=e.split(""),o=0,a=i.length;a>o;o++)n=i[o],r+=n in t.map?t.map[n]:n;return r},t})},{}],10:[function(t,e,n){(function(t){!function(t){"use strict";if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof n&&"object"==typeof e)e.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else{if("undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");self.Q=t()}}(function(){"use strict";function e(t){return function(){return V.apply(t,arguments)}}function n(t){return t===Object(t)}function r(t){return"[object StopIteration]"===rt(t)||t instanceof J}function i(t,e){if(q&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(it)){for(var n=[],r=e;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(t.stack);var i=n.join("\n"+it+"\n");t.stack=o(i)}}function o(t){for(var e=t.split("\n"),n=[],r=0;r<e.length;++r){var i=e[r];u(i)||a(i)||!i||n.push(i)}return n.join("\n")}function a(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function s(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function u(t){var e=s(t);if(!e)return!1;var n=e[0],r=e[1];return n===Y&&r>=H&&ut>=r}function c(){if(q)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],r=s(n);if(!r)return;return Y=r[0],r[1]}}function l(t,e,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack),t.apply(t,arguments)}}function f(t){return t instanceof g?t:b(t)?k(t):A(t)}function h(){function t(t){e=t,o.source=t,X(n,function(e,n){f.nextTick(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,r=void 0}var e,n=[],r=[],i=tt(h.prototype),o=tt(g.prototype);if(o.promiseDispatch=function(t,i,o){var a=K(arguments);n?(n.push(a),"when"===i&&o[1]&&r.push(o[1])):f.nextTick(function(){e.promiseDispatch.apply(e,a)})},o.valueOf=function(){if(n)return o;var t=y(e);return v(t)&&(e=t),t},o.inspect=function(){return e?e.inspect():{state:"pending"}},f.longStackSupport&&q)try{throw new Error}catch(a){o.stack=a.stack.substring(a.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(n){e||t(f(n))},i.fulfill=function(n){e||t(A(n))},i.reject=function(n){e||t(C(n))},i.notify=function(t){e||X(r,function(e,n){f.nextTick(function(){n(t)})},void 0)},i}function d(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=h();try{t(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}return e.promise}function p(t){return d(function(e,n){for(var r=0,i=t.length;i>r;r++)f(t[r]).then(e,n)})}function g(t,e,n){void 0===e&&(e=function(t){return C(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=tt(g.prototype);if(r.promiseDispatch=function(n,i,o){var a;try{a=t[i]?t[i].apply(r,o):e.call(r,i,o)}catch(s){a=C(s)}n&&n(a)},r.inspect=n,n){var i=n();"rejected"===i.state&&(r.exception=i.reason),r.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?r:t.value}}return r}function m(t,e,n,r){return f(t).then(e,n,r)}function y(t){if(v(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function v(t){return t instanceof g}function b(t){return n(t)&&"function"==typeof t.then}function w(t){return v(t)&&"pending"===t.inspect().state}function x(t){return!v(t)||"fulfilled"===t.inspect().state}function M(t){return v(t)&&"rejected"===t.inspect().state}function _(){ot.length=0,at.length=0,st||(st=!0)}function S(t,e){st&&(at.push(t),ot.push(e&&"undefined"!=typeof e.stack?e.stack:"(no stack) "+e))}function E(t){if(st){var e=Z(at,t);-1!==e&&(at.splice(e,1),ot.splice(e,1))}}function C(t){var e=g({when:function(e){return e&&E(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return S(e,t),e}function A(t){return g({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},"delete":function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return nt(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function k(t){var e=h();return f.nextTick(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}}),e.promise}function T(t){return g({isDef:function(){}},function(e,n){return L(t,e,n)},function(){return f(t).inspect()})}function O(t,e,n){return f(t).spread(e,n)}function R(t){return function(){function e(t,e){var a;if("undefined"==typeof StopIteration){try{a=n[t](e)}catch(s){return C(s)}return a.done?f(a.value):m(a.value,i,o)}try{a=n[t](e)}catch(s){return r(s)?f(s.value):C(s)}return m(a,i,o)}var n=t.apply(this,arguments),i=e.bind(e,"next"),o=e.bind(e,"throw");return i()}}function D(t){f.done(f.async(t)())}function U(t){throw new J(t)}function N(t){return function(){return O([this,j(arguments)],function(e,n){return t.apply(e,n)})}}function L(t,e,n){return f(t).dispatch(e,n)}function j(t){return m(t,function(t){var e=0,n=h();return X(t,function(r,i,o){var a;v(i)&&"fulfilled"===(a=i.inspect()).state?t[o]=a.value:(++e,m(i,function(r){t[o]=r,0===--e&&n.resolve(t)},n.reject,function(t){n.notify({index:o,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function F(t){if(0===t.length)return f.resolve();var e=f.defer(),n=0;return X(t,function(r,i,o){function a(t){e.resolve(t)}function s(){n--,0===n&&e.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function u(t){e.notify({index:o,value:t})}var c=t[o];n++,m(c,a,s,u)},void 0),e.promise}function I(t){return m(t,function(t){return t=Q(t,f),m(j(Q(t,function(t){return m(t,G,G)})),function(){return t})})}function B(t){return f(t).allSettled()}function P(t,e){return f(t).then(void 0,void 0,e)}function z(t,e){return f(t).nodeify(e)}var q=!1;try{throw new Error}catch(W){q=!!W.stack}var Y,J,H=c(),G=function(){},$=function(){function e(){for(;n.next;){n=n.next;var t=n.task;n.task=void 0;var r=n.domain;r&&(n.domain=void 0,r.enter());try{t()}catch(o){if(a)throw r&&r.exit(),setTimeout(e,0),r&&r.enter(),o;setTimeout(function(){throw o},0)}r&&r.exit()}i=!1}var n={task:void 0,next:null},r=n,i=!1,o=void 0,a=!1;if($=function(e){r=r.next={task:e,domain:a&&t.domain,next:null},i||(i=!0,o())},"undefined"!=typeof t&&t.nextTick)a=!0,o=function(){t.nextTick(e)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){o=u,s.port1.onmessage=e,e()};var u=function(){s.port2.postMessage(0)};o=function(){setTimeout(e,0),u()}}else o=function(){setTimeout(e,0)};return $}(),V=Function.call,K=e(Array.prototype.slice),X=e(Array.prototype.reduce||function(t,e){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(e=t(e,this[n],n));return e}),Z=e(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),Q=e(Array.prototype.map||function(t,e){var n=this,r=[];return X(n,function(i,o,a){r.push(t.call(e,o,a,n))},void 0),r}),tt=Object.create||function(t){function e(){}return e.prototype=t,new e},et=e(Object.prototype.hasOwnProperty),nt=Object.keys||function(t){var e=[];for(var n in t)et(t,n)&&e.push(n);return e},rt=e(Object.prototype.toString);J="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var it="From previous event:";f.resolve=f,f.nextTick=$,f.longStackSupport=!1,"object"==typeof t&&t&&t.env&&t.env.Q_DEBUG&&(f.longStackSupport=!0),f.defer=h,h.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):t.resolve(arguments.length>2?K(arguments,1):n)}},f.Promise=d,f.promise=d,d.race=p,d.all=j,d.reject=C,d.resolve=f,f.passByCopy=function(t){return t},g.prototype.passByCopy=function(){return this},f.join=function(t,e){return f(t).join(e)},g.prototype.join=function(t){return f([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e);

})},f.race=p,g.prototype.race=function(){return this.then(f.race)},f.makePromise=g,g.prototype.toString=function(){return"[object Promise]"},g.prototype.then=function(t,e,n){function r(e){try{return"function"==typeof t?t(e):e}catch(n){return C(n)}}function o(t){if("function"==typeof e){i(t,s);try{return e(t)}catch(n){return C(n)}}return C(t)}function a(t){return"function"==typeof n?n(t):t}var s=this,u=h(),c=!1;return f.nextTick(function(){s.promiseDispatch(function(t){c||(c=!0,u.resolve(r(t)))},"when",[function(t){c||(c=!0,u.resolve(o(t)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=a(t)}catch(r){if(n=!0,!f.onerror)throw r;f.onerror(r)}n||u.notify(e)}]),u.promise},f.tap=function(t,e){return f(t).tap(e)},g.prototype.tap=function(t){return t=f(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},f.when=m,g.prototype.thenResolve=function(t){return this.then(function(){return t})},f.thenResolve=function(t,e){return f(t).thenResolve(e)},g.prototype.thenReject=function(t){return this.then(function(){throw t})},f.thenReject=function(t,e){return f(t).thenReject(e)},f.nearer=y,f.isPromise=v,f.isPromiseAlike=b,f.isPending=w,g.prototype.isPending=function(){return"pending"===this.inspect().state},f.isFulfilled=x,g.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},f.isRejected=M,g.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ot=[],at=[],st=!0;f.resetUnhandledRejections=_,f.getUnhandledReasons=function(){return ot.slice()},f.stopUnhandledRejectionTracking=function(){_(),st=!1},_(),f.reject=C,f.fulfill=A,f.master=T,f.spread=O,g.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},f.async=R,f.spawn=D,f["return"]=U,f.promised=N,f.dispatch=L,g.prototype.dispatch=function(t,e){var n=this,r=h();return f.nextTick(function(){n.promiseDispatch(r.resolve,t,e)}),r.promise},f.get=function(t,e){return f(t).dispatch("get",[e])},g.prototype.get=function(t){return this.dispatch("get",[t])},f.set=function(t,e,n){return f(t).dispatch("set",[e,n])},g.prototype.set=function(t,e){return this.dispatch("set",[t,e])},f.del=f["delete"]=function(t,e){return f(t).dispatch("delete",[e])},g.prototype.del=g.prototype["delete"]=function(t){return this.dispatch("delete",[t])},f.mapply=f.post=function(t,e,n){return f(t).dispatch("post",[e,n])},g.prototype.mapply=g.prototype.post=function(t,e){return this.dispatch("post",[t,e])},f.send=f.mcall=f.invoke=function(t,e){return f(t).dispatch("post",[e,K(arguments,2)])},g.prototype.send=g.prototype.mcall=g.prototype.invoke=function(t){return this.dispatch("post",[t,K(arguments,1)])},f.fapply=function(t,e){return f(t).dispatch("apply",[void 0,e])},g.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},f["try"]=f.fcall=function(t){return f(t).dispatch("apply",[void 0,K(arguments,1)])},g.prototype.fcall=function(){return this.dispatch("apply",[void 0,K(arguments)])},f.fbind=function(t){var e=f(t),n=K(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(K(arguments))])}},g.prototype.fbind=function(){var t=this,e=K(arguments);return function(){return t.dispatch("apply",[this,e.concat(K(arguments))])}},f.keys=function(t){return f(t).dispatch("keys",[])},g.prototype.keys=function(){return this.dispatch("keys",[])},f.all=j,g.prototype.all=function(){return j(this)},f.any=F,g.prototype.any=function(){return F(this)},f.allResolved=l(I,"allResolved","allSettled"),g.prototype.allResolved=function(){return I(this)},f.allSettled=B,g.prototype.allSettled=function(){return this.then(function(t){return j(Q(t,function(t){function e(){return t.inspect()}return t=f(t),t.then(e,e)}))})},f.fail=f["catch"]=function(t,e){return f(t).then(void 0,e)},g.prototype.fail=g.prototype["catch"]=function(t){return this.then(void 0,t)},f.progress=P,g.prototype.progress=function(t){return this.then(void 0,void 0,t)},f.fin=f["finally"]=function(t,e){return f(t)["finally"](e)},g.prototype.fin=g.prototype["finally"]=function(t){return t=f(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},f.done=function(t,e,n,r){return f(t).done(e,n,r)},g.prototype.done=function(e,n,r){var o=function(t){f.nextTick(function(){if(i(t,a),!f.onerror)throw t;f.onerror(t)})},a=e||n||r?this.then(e,n,r):this;"object"==typeof t&&t&&t.domain&&(o=t.domain.bind(o)),a.then(void 0,o)},f.timeout=function(t,e,n){return f(t).timeout(e,n)},g.prototype.timeout=function(t,e){var n=h(),r=setTimeout(function(){e&&"string"!=typeof e||(e=new Error(e||"Timed out after "+t+" ms"),e.code="ETIMEDOUT"),n.reject(e)},t);return this.then(function(t){clearTimeout(r),n.resolve(t)},function(t){clearTimeout(r),n.reject(t)},n.notify),n.promise},f.delay=function(t,e){return void 0===e&&(e=t,t=void 0),f(t).delay(e)},g.prototype.delay=function(t){return this.then(function(e){var n=h();return setTimeout(function(){n.resolve(e)},t),n.promise})},f.nfapply=function(t,e){return f(t).nfapply(e)},g.prototype.nfapply=function(t){var e=h(),n=K(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},f.nfcall=function(t){var e=K(arguments,1);return f(t).nfapply(e)},g.prototype.nfcall=function(){var t=K(arguments),e=h();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},f.nfbind=f.denodeify=function(t){var e=K(arguments,1);return function(){var n=e.concat(K(arguments)),r=h();return n.push(r.makeNodeResolver()),f(t).fapply(n).fail(r.reject),r.promise}},g.prototype.nfbind=g.prototype.denodeify=function(){var t=K(arguments);return t.unshift(this),f.denodeify.apply(void 0,t)},f.nbind=function(t,e){var n=K(arguments,2);return function(){function r(){return t.apply(e,arguments)}var i=n.concat(K(arguments)),o=h();return i.push(o.makeNodeResolver()),f(r).fapply(i).fail(o.reject),o.promise}},g.prototype.nbind=function(){var t=K(arguments,0);return t.unshift(this),f.nbind.apply(void 0,t)},f.nmapply=f.npost=function(t,e,n){return f(t).npost(e,n)},g.prototype.nmapply=g.prototype.npost=function(t,e){var n=K(e||[]),r=h();return n.push(r.makeNodeResolver()),this.dispatch("post",[t,n]).fail(r.reject),r.promise},f.nsend=f.nmcall=f.ninvoke=function(t,e){var n=K(arguments,2),r=h();return n.push(r.makeNodeResolver()),f(t).dispatch("post",[e,n]).fail(r.reject),r.promise},g.prototype.nsend=g.prototype.nmcall=g.prototype.ninvoke=function(t){var e=K(arguments,1),n=h();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},f.nodeify=z,g.prototype.nodeify=function(t){return t?void this.then(function(e){f.nextTick(function(){t(null,e)})},function(e){f.nextTick(function(){t(e)})}):this};var ut=c();return f})}).call(this,t("_process"))},{_process:22}],11:[function(t,e,n){e.exports={name:"fielddb",version:"3.12.13",description:"An offline/online field database which adapts to its user's terminology and I-Language",homepage:"https://github.com/OpenSourceFieldlinguistics/FieldDB/issues/milestones?state=closed",repository:{type:"git",url:"git://github.com/OpenSourceFieldlinguistics/FieldDB.git"},bugs:{url:"https://github.com/OpenSourceFieldlinguistics/FieldDB/issues"},keywords:["fielddb","client"],contributors:["cesine <cesine@yahoo.com>","trisapeace <trisapeace@gmail.com>","hisakonog <hisakonog@gmail.com>","Emmy Cathcart <maryellencathcart@gmail.com>","Tobin Skinner <tobin.skinner@gmail.com>","Yuliya Manyakina <yulia.manyakina@gmail.com>","Elise <elise.mcclay@gmail.com>","Josh Horner <josh.horner@gmail.com>","gretchenmcc <gretchen.mcculloch@gmail.com>","jrwdunham <jrwdunham@gmail.com>","ghazan <gay.hazan@gmail.com>","Fieldlinguist <info@fieldlinguist.com>","zazoo <kimdan.ng@gmail.com>","louisa-bielig <louisa.bielig@gmail.com>","lingllama <lingllama@lingsync.org>","geekrax <rakshit@thetechtime.com>","Yogurt1206 <sunx4@miamioh.edu>","Pablo Duboue <pablo.duboue@gmail.com>","Oriana <oriana.kilbourn-ceron@mail.mcgill.ca>"],dependencies:{MD5:"1.2.1",aes:"^0.1.0",atob:"^1.1.2","bcrypt-nodejs":"0.0.3","browserify-mime":"^1.2.9",btoa:"^1.1.2","crypto-js":"^3.1.4",diacritic:"0.0.2",mime:"^1.3.4","node-cryptojs-aes":"^0.4.0",q:"1.2.0",recordmp3js:"0.5.0",textgrid:"2.2.0",underscore:"^1.8.3"},devDependencies:{browserify:"9.0.7",grunt:"*","grunt-browserify":"3.6.0","grunt-contrib-concat":"0.5.1","grunt-contrib-jasmine":"^0.8.2","grunt-contrib-jshint":"0.11.1","grunt-contrib-uglify":"0.8.1","grunt-contrib-watch":"0.6.1","grunt-exec":"^0.4.6","grunt-jasmine-node":"git://github.com/cesine/grunt-jasmine-node.git","grunt-jsdoc":"0.5.8","grunt-newer":"^1.1.0","jasmine-node":"^1.14.5"},main:"api/fielddb.js",scripts:{test:"grunt",postinstall:"bower install"},license:"Apache-2.0"}},{}],12:[function(t,e,n){!function(){function t(t){function e(t){return t.text}function n(){return"serif"}function r(){return"normal"}function i(t){return Math.sqrt(t.value)}function o(){return 30*(~~(6*p())-3)}function a(){return 1}function s(t,e,n){if(!t.sprite){x.clearRect(0,0,(y<<5)/b,v/b);var r=0,i=0,o=0,a=e.length;for(--n;++n<a;){t=e[n],x.save(),x.font=t.style+" "+t.weight+" "+~~((t.size+1)/b)+"px "+t.font;var s=x.measureText(t.text+"m").width*b,u=t.size<<1;if(t.rotate){var c=Math.sin(t.rotate*m),l=Math.cos(t.rotate*m),f=s*l,h=s*c,d=u*l,p=u*c;s=Math.max(Math.abs(f+p),Math.abs(f-p))+31>>5<<5,u=~~Math.max(Math.abs(h+d),Math.abs(h-d))}else s=s+31>>5<<5;if(u>o&&(o=u),r+s>=y<<5&&(r=0,i+=o,o=0),i+u>=v)break;x.translate((r+(s>>1))/b,(i+(u>>1))/b),t.rotate&&x.rotate(t.rotate*m),x.fillText(t.text,0,0),t.padding&&(x.lineWidth=2*t.padding,x.strokeText(t.text,0,0)),x.restore(),t.width=s,t.height=u,t.xoff=r,t.yoff=i,t.x1=s>>1,t.y1=u>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,r+=s}for(var g=x.getImageData(0,0,(y<<5)/b,v/b).data,w=[];--n>=0;)if(t=e[n],t.hasText){for(var s=t.width,M=s>>5,u=t.y1-t.y0,_=0;u*M>_;_++)w[_]=0;if(r=t.xoff,null===r)return;i=t.yoff;for(var S=0,E=-1,C=0;u>C;C++){for(var _=0;s>_;_++){var A=M*C+(_>>5),k=g[(i+C)*(y<<5)+(r+_)<<2]?1<<31-_%32:0;w[A]|=k,S|=k}S?E=C:(t.y0++,u--,C--,i++)}t.y1=t.y0+E,t.sprite=w.slice(0,(t.y1-t.y0)*M)}}}function u(t,e,n){n>>=5;for(var r,i=t.sprite,o=t.width>>5,a=t.x-(o<<4),s=127&a,u=32-s,c=t.y1-t.y0,l=(t.y+t.y0)*n+(a>>5),f=0;c>f;f++){r=0;for(var h=0;o>=h;h++)if((r<<u|(o>h?(r=i[f*o+h])>>>s:0))&e[l+h])return!0;l+=n}return!1}function c(t,e){var n=t[0],r=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>r.x&&(r.x=e.x+e.x1),e.y+e.y1>r.y&&(r.y=e.y+e.y1)}function l(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function f(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function h(t){var e=4,n=e*t[0]/t[1],r=0,i=0;return function(t){var o=0>t?-1:1;switch(Math.sqrt(1+4*o*t)-o&3){case 0:r+=n;break;case 1:i+=e;break;case 2:r-=n;break;default:i-=e}return[r,i]}}function d(t){for(var e=[],n=-1;++n<t;)e[n]=0;return e}var p=Math.random;t.layout.cloud=function _(){function h(t,e,n){for(var r,i,o,a=([{x:0,y:0},{x:y[0],y:y[1]}],e.x),s=e.y,c=Math.sqrt(y[0]*y[0]+y[1]*y[1]),f=k(y),h=p()<.5?1:-1,d=-h;(r=f(d+=h))&&(i=~~r[0],o=~~r[1],!(Math.min(Math.abs(i),Math.abs(o))>=c));)if(e.x=a+i,e.y=s+o,(!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>y[0]||e.y+e.y1>y[1])||U)&&!(n&&u(e,t,y[0])||n&&!l(e,n))){for(var g,m=e.sprite,v=e.width>>5,b=y[0]>>5,w=e.x-(v<<4),x=127&w,M=32-x,_=e.y1-e.y0,S=(e.y+e.y0)*b+(w>>5),E=0;_>E;E++){g=0;for(var C=0;v>=C;C++)t[S+C]|=g<<M|(v>C?(g=m[E*v+C])>>>x:0);S+=b}return delete e.sprite,!0}return!1}var g=256,m=256,y=[g,m],v=null,b=e,w=n,x=i,S=r,E=r,C=o,A=a,k=f,T=[],O=1/0,R=t.dispatch("word","end"),D=null,U=!1,_={};return _.start=function(){function t(){for(var t,u,l,f=Date.now();Date.now()-f<O&&++i<r&&D;){var d=a[i];for(v?(t=d.x=v[0],u=d.y=v[1]):(t=d.x=y[0]*(p()+.5)>>1,u=d.y=y[1]*(p()+.5)>>1),l=i+1,s(d,a,i);d.hasText;){if(h(e,d,n)){o.push(d),R.word(d),n?c(n,d):n=[{x:d.x+d.x0,y:d.y+d.y0},{x:d.x+d.x1,y:d.y+d.y1}],d.x-=y[0]>>1,d.y-=y[1]>>1;break}delete d.sprite,d.sprite=null,d.x=t,d.y=u,d.size=l<a.length?a[l++].size:d.size-(d.size>>3),~~d.size>0?s(d,a,i):d.hasText=!1}}i>=r&&(_.stop(),R.end(o,n))}var e=d((y[0]>>5)*y[1]),n=null,r=T.length,i=-1,o=[],a=T.map(function(t,e){return t.text=b.call(this,t,e),t.font=w.call(this,t,e),t.style=S.call(this,t,e),t.weight=E.call(this,t,e),t.rotate=C.call(this,t,e),t.size=~~x.call(this,t,e),t.padding=A.call(this,t,e),t}).sort(function(t,e){return e.size-t.size});return D&&clearInterval(D),D=setInterval(t,0),t(),_},_.stop=function(){return D&&(clearInterval(D),D=null),_},_.timeInterval=function(t){return arguments.length?(O=null===t?1/0:t,_):O},_.words=function(t){return arguments.length?(T=t,_):T},_.size=function(t){return arguments.length?((!t[0]||t[0]<0)&&(t[0]=g),(!t[1]||t[1]<1)&&(t[1]=m),arguments.length?(y=[+t[0],+t[1]],_):y):y},_.font=function(e){return arguments.length?(w=t.functor(e),_):w},_.fontStyle=function(e){return arguments.length?(S=t.functor(e),_):S},_.fontWeight=function(e){return arguments.length?(E=t.functor(e),_):E},_.rotate=function(e){return arguments.length?(C=t.functor(e),_):C},_.text=function(e){return arguments.length?(b=t.functor(e),_):b},_.spiral=function(t){return arguments.length?(k=M[t]||t,_):k},_.fontSize=function(e){return arguments.length?(x=t.functor(e),_):x},_.padding=function(e){return arguments.length?(A=t.functor(e),_):A},_.random=function(t){return arguments.length?(p=t,_):p},_.startPoint=function(t){return arguments.length?(v=[+t[0],+t[1]],_):v},_.overflow=function(e){return arguments.length?(U=t.functor(e),_):U},t.rebind(_,R,"on")};var g,m=Math.PI/180,y=64,v=2048,b=1;if("undefined"!=typeof document)g=document.createElement("canvas"),g.width=1,g.height=1,b=Math.sqrt(g.getContext("2d").getImageData(0,0,1,1).data.length>>2),g.width=(y<<5)/b,g.height=v/b;else try{Canvas&&(g=new Canvas(y<<5,v))}catch(w){console.warn("Unable to use Canvas, clouds will not be able to render.",w),g={getContext:function(){return console.log("stub"),{}}}}var x=g.getContext("2d"),M={archimedean:f,rectangular:h};x.fillStyle=x.strokeStyle="red",x.textAlign="center"}"function"==typeof define&&define.amd?define(["d3"],t):t(this.d3)}()},{}],13:[function(t,e,n){!function(t){var e=t.Corpus2Morphology||{LANGUAGE:"inuktitut",run:function(){console.log("Removing all files and memories..."),console.log("Creating a wordlist..."),console.log("Creating  rankedpossiblemorpheme lists..."),console.log("Creating initial precedence relations..."),console.log("Creating an initial dense corpus..."),console.log("      (contains a hard coded seed list, change this to follow from above step in later versions)"),console.log("Creating precedence relations between morphemes..."),console.log("Creating a list of permissible morpheme boundaries ie, z > a, in xyz > abc ..."),console.log("Creating a (new) template by generalizing individual morphs to their class..."),console.log("Creating a new dense corpus...")}};t.Corpus2Morphology=e}("undefined"==typeof n?this:n)},{}],14:[function(t,e,n){!function(e){var n=e.Tokenizer||t("./Tokenizer").Tokenizer,r="hhh",i=function(t){var e={};for(var n in t)if(t.hasOwnProperty(n)){var i=n.replace(new RegExp(r+"$"),"");e[i]=t[n]}return e},o=function(t){for(var e={},n=[],r=0,i=t.length;i>r;++r)e.hasOwnProperty(t[r])||t[r]&&(n.push(t[r]),e[t[r]]=1);return n},a=function(t){t.vocabSize=0,t.textSize=0,t.prefixesArray=t.prefixesArray||[],t.suffixesArray=t.suffixesArray||[];var e,o,a,s=[],u=t.orthography;"[object Array]"!==Object.prototype.toString.call(u)&&(u=n.tokenizeInput(t).orthographicWords);for(var c,l,f={},h=0;h<u.length;h++){e=u[h];for(var d in t.functionsPerWord)t.functionsPerWord.hasOwnProperty(d)&&t.functionsPerWord[d](e);c="preserve"===t.caseSensitivity?e:e.toLocaleLowerCase()+r,l=e+r,f[c]?f[c][l]?f[c][l]+=1:f[c][l]=1:(f[c]={},f[c][l]=1,t.vocabSize+=1,s.push(c)),t.textSize+=1}t.wordFrequencies=[];for(var p in f)if(f.hasOwnProperty(p)){var g=0,m="",y=0;for(var v in f[p])f[p].hasOwnProperty(v)&&(g+=f[p][v],f[p][v]>y&&(m=v,y=f[p][v]));var b={orthography:m.replace(new RegExp(r+"$"),""),count:g};b.count>y&&(b.alternates=i(f[p])),t.wordFrequencies.push(b)}if(t.prefixesArray.sort(function(t,e){return e.length-t.length}),t.suffixesArray.sort(function(t,e){return e.length-t.length}),t.prefixesArray&&t.prefixesArray.length>0||t.suffixesArray&&t.suffixesArray>0){t.lexicalExperience={};for(var w=(s.sort(function(t,e){return t.localeCompare(e)}),0);w<s.length;w++){e=s[w];for(var x=0;x<t.suffixesArray.length;x++)o=t.suffixesArray[x].replace(/-/,""),a=e.replace(o,""),e.indexOf(o)===e.length-o.length&&a.length>2&&(t.lexicalExperience[o]=t.lexicalExperience[o]||[],t.lexicalExperience[o].push(a+"-"+o),t.lexicalExperience[a]=t.lexicalExperience[a]||[],t.lexicalExperience[a].push(a+"-"+o));for(var M=0;M<t.prefixesArray.length;M++)o=t.prefixesArray[M].replace(/-/,""),a=e.replace(new RegExp(r+"$"),"").replace(o,""),0===e.indexOf(o)&&a.length>2&&(t.lexicalExperience[o]=t.lexicalExperience[o]||[],t.lexicalExperience[o].push(o+"-"+a),t.lexicalExperience[a]=t.lexicalExperience[a]||[],t.lexicalExperience[a].push(o+"-"+a))}}return t.wordFrequencies=t.wordFrequencies.sort(function(t,e){return-(t.count-e.count)}),t},s=function(t){if(t.nonContentWordsArray=t.nonContentWordsArray||[],t.buzzWordsArray=t.buzzWordsArray||[],t.orthography){var e=[],n=[],r=t.wordFrequencies||a(t).wordFrequencies,i=t.cutoff;if(!i){var s=t.vocabSize/t.textSize;i=t.textSize<20?.2:s>60?.1:.007}for(var u in r)if(r.hasOwnProperty(u)){var c=r[u].count/t.vocabSize;if(c>i)if(r[u].orthography.length>5)e.push(r[u].orthography),r[u].categories=["buzzWord"];else{if(t.userSpecifiedNonContentWords&&-1===t.nonContentWordsArray.indexOf(r[u].orthography))continue;n.push(r[u].orthography),r[u].categories=["functionalWord"]}if(r[u].orthography.length<3){if(t.userSpecifiedNonContentWords&&-1===t.nonContentWordsArray.indexOf(r[u].orthography))continue;n.push(r[u].orthography),r[u].categories=["functionalWord"]}t.userRemovedWordsForThisDocumentArray&&t.userRemovedWordsForThisDocumentArray.indexOf(r[u].orthography)>-1&&(r[u].categories=r[u].categories||[],r[u].categories.unshift("userRemovedWordAsUnrepresentativeOfThisDocument")),t.userRemovedWordsForAllDocumentsArray&&t.userRemovedWordsForAllDocumentsArray.indexOf(r[u].orthography)>-1&&(r[u].categories=r[u].categories||[],r[u].categories.unshift("userRemovedWordFromAllDocuments"))}return t.userSpecifiedNonContentWords||(t.nonContentWordsArray=t.nonContentWordsArray.concat(n),t.nonContentWordsArray=o(t.nonContentWordsArray),t.nonContentWordsArray.sort(function(t,e){return t.localeCompare(e)})),t.userSpecifiedBuzzWords||(t.buzzWordsArray=o(e),t.buzzWordsArray.sort(function(t,e){return t.localeCompare(e)})),t}};e.LexemeFrequency=e.LexemeFrequency||{calculateWordFrequencies:a,calculateNonContentWords:s,getUnique:o}}("undefined"==typeof n?this:n)},{"./Tokenizer":17}],15:[function(t,e,n){!function(t){var e={},n=function(t,n){"object"==typeof t&&(t=JSON.stringify(t)),e[t]=e[t]||[],e[t].push(n)},r=function(t,e,n){return e.length},i=t.MorphemeSegmenter||{debugMode:!1,seeds2precedenceRelations:function(t){if(""!==t){t=t.replace(/^-/,"").replace(/-$/,"");var e=t.trim().split("-"),r="@";if(0!==e.length){e.push("@");for(var i in e){var o={};o.x=r,o.relation="preceeds",o.y=e[i],o.context=t,n(o,1),r=e[i]}}}},generateCompactPrecedenceRelationsFromSeeds:function(t){if(e={},0!==t.indexOf("*")){var n=t.toLowerCase().split(/[#?!.,/ ]+/);for(var i in n)if(n[i]){var o=n[i].replace(/\(\*[^)]*\)/g,"");o=o.replace(/\*\(([^)]*)\)/,"$1");var a=o.replace(/[(*)]/g,""),s=o.replace(/\([^)]*\)/g,"");a!==s&&this.seeds2precedenceRelations(s),this.seeds2precedenceRelations(a)}var u=[];for(var c in e)if(e.hasOwnProperty(c)){var l=c;try{l=JSON.parse(c)}catch(f){}u.push({key:l,value:r(c,e[c])})}var h=[];return u.map(function(t){if(!(t.key.distance&&t.key.distance>1)){t.key.previous&&t.key.previous.morphemes&&(t.key.x=t.key.previous.morphemes),t.key.subsequent&&t.key.subsequent.morphemes&&(t.key.y=t.key.subsequent.morphemes);var e=t.key.x+"-"+t.key.y;-1===h.indexOf(e)&&h.push(e)}}),h.sort(function(t,e){return t.length>e.length}),h}},generatePotentialSegmentations:function(t,e,n){var r=t.utterance||t.orthography;if(!r)return t;if(n)return t.morphemes=r,r;var i=e;if(!i)return console.warn("There were no rules which could be used, please supply a second argument to function generatePotentialSegmentations ",t),t.morphemes=r,t;var o,a,s="",u=[],c=r.trim().split(/ +/);for(var l in c){c[l]="@"+c[l]+"@";var f=[];for(var h in i)c[l].indexOf(i[h].replace(/-/,""))>=0&&f.push(i[h]);var d=[];d.push("@");for(var p=0;10>p&&void 0!==d[p];p++)for(var g in f)if(!(d.length>2&&"@"===d[d.length-1])&&(o=f[g].split("-")[0],a=f[g].split("-")[1],d[p]===o)){if(d[p+1]){d.pop();break}d[p+1]=a}if(d.length>2&&"@"===d[0]&&"@"===d[d.length-1])d.pop(),d.shift(),u.push(d.join("-"));else{var m=[];if("@"!==d[d.length-1]||1===d.length){m.push("@");for(var y=0;10>y&&void 0!==m[y];y++)for(var v in f)if(o=f[v].split("-")[0],a=f[v].split("-")[1],m[y]===a){if(m[y+1]){m.pop();break}m[y+1]=o}}var b=[];b=d.concat(m.reverse());for(var w in b)b[w]="("+b[w]+")";var x=new RegExp(b.join("(.*)"),"");s=c[l].replace(x,"$1-$2-$3-$4-$5-$6-$7-$8-$9").replace(/\$[0-9]/g,"").replace(/@/g,"").replace(/--+/g,"-").replace(/^-/,"").replace(/-$/,""),this.debugMode&&console.log("Potential parse of "+c[l].replace(/@/g,"")+" is "+s),u.push(s)}}return t.alternativeMorphemeSegentations=t.alternativeMorphemeSegentations||[],t.alternativeMorphemeSegentations.push(r),t.morphemes=u.join(" "),t},runSegmenter:function(t){if(!t.morphemeSegmentationOptions)return this.debugMode&&console.log("No segmentation options were specified, not returning any segmentations"),t.morphemes=t.morphemes||t.utterance||t.orthography,t;if(!t.utterance&&!t.orthography)return console.warn("I don't need to guess the segmentation of an empty string, it's just empty. ",t.utterance),t;var e=t.morphemes,n=t.morphemeSegmentationOptions.precedenceRelations;if(t.morphemeSegmentationOptions.seeds)n=this.generateCompactPrecedenceRelationsFromSeeds(t.morphemeSegmentationOptions.seeds);else if(!n){if(!t.ilanguage)return console.warn("I need a rule set to use. please specify an ilanguage (this might be a database or a corpus of similar data/dialect or language of an individual)"),t;try{n=localStorage.getItem(t.ilanguage+"reducedRules"),n=JSON.parse(n)}catch(r){console.warn("localStorage doesnt work and no seeds were specified so segmentation cannot run."+r)}}return t=this.generatePotentialSegmentations(t,n),t.originalMorphemes&&-1===t.alternativeMorphemeSegentations.indexOf(e)?(t.alternativeMorphemeSegentations.unshift(t.morphemes),t.morphemes=e):t.originalMorphemes&&console.warn("Overrwiting morphemes "+t.originalMorphemes+" to "+t.morphemes),t}};t.MorphemeSegmenter=t.MorphemeSegmenter||i}("undefined"==typeof n?this:n)},{}],16:[function(t,e,n){!function(e){var n=e.LexemeFrequency||t("./LexemeFrequency").LexemeFrequency,r=e.Tokenizer||t("./Tokenizer").Tokenizer,i={maxLength:30,punctuation:/[!"'&()*+,-\.\/:;<=>?\[\\\]^`\{|\}~]+/g,wordSeparators:/[\s\u3031-\u3035\u309b\u309c\u30a0\u30fc\uff70 ]+/g,english:/^(i|me|my|myself|we|us|our|ours|ourselves|you|your|yours|yourself|yourselves|he|him|his|himself|she|her|hers|herself|it|its|itself|they|them|their|theirs|themselves|what|which|who|whom|whose|this|that|these|those|am|is|are|was|were|be|been|being|have|has|had|having|do|does|did|doing|will|would|should|can|could|ought|i'm|you're|he's|she's|it's|we're|they're|i've|you've|we've|they've|i'd|you'd|he'd|she'd|we'd|they'd|i'll|you'll|he'll|she'll|we'll|they'll|isn't|aren't|wasn't|weren't|hasn't|haven't|hadn't|doesn't|don't|didn't|won't|wouldn't|shan't|shouldn't|can't|cannot|couldn't|mustn't|let's|that's|who's|what's|here's|there's|when's|where's|why's|how's|a|an|the|and|but|if|or|because|as|until|while|of|at|by|for|with|about|against|between|into|through|during|before|after|above|below|to|from|up|upon|down|in|out|on|off|over|under|again|further|then|once|here|there|when|where|why|how|all|any|both|each|few|more|most|other|some|such|no|nor|not|only|own|same|so|than|too|very|say|says|said|shall)$/},o=function(t){for(var e={},n=[],r=0,i=t.length;i>r;++r)e.hasOwnProperty(t[r])||t[r]&&(t[r].trim&&(t[r]=t[r].trim()),n.push(t[r]),e[t[r]]=1);return n},a=function(t){var e,n=/[,\s]+/g;return t.prefixesArray?(e=t.prefixesArray.toString().substring(0,20),0===e.indexOf("/")?t.prefixesArray=t.prefixesArray.toString().replace("/^(","").replace(")$/","").split("|"):"[object Array]"===Object.prototype.toString.call(t.prefixesArray)||(-1!==e.indexOf(",")||-1===e.indexOf(",")&&-1!==e.indexOf(" "))&&(t.prefixesArray=t.prefixesArray.split(n))):t.prefixesArray=[],t.suffixesArray?(e=t.suffixesArray.toString().substring(0,20),0===e.indexOf("/")?t.suffixesArray=t.suffixesArray.toString().replace("/^(","").replace(")$/","").split("|"):"[object Array]"===Object.prototype.toString.call(t.suffixesArray)||(-1!==e.indexOf(",")||-1===e.indexOf(",")&&-1!==e.indexOf(" "))&&(t.suffixesArray=t.suffixesArray.split(n))):t.suffixesArray=[],t.morphemesArray?(e=t.morphemesArray.toString().substring(0,20),0===e.indexOf("/")?t.morphemesArray=t.morphemesArray.toString().replace("/^(","").replace(")$/","").split("|"):"[object Array]"===Object.prototype.toString.call(t.morphemesArray)||(-1!==e.indexOf(",")||-1===e.indexOf(",")&&-1!==e.indexOf(" "))&&(t.morphemesArray=t.morphemesArray.split(n))):t.morphemesArray=[],t.morphemesArray=t.morphemesArray.concat(t.prefixesArray).concat(t.suffixesArray),t.morphemesArray=o(t.morphemesArray).sort(function(t,e){return e.length-t.length}),t.morphemesArray.length>0?(t.morphemesRegExp=t.morphemesArray.map(function(t){return 0===t.indexOf("-")?t.replace("-","")+"$":t.indexOf("-")===t.length-1?"^"+t.replace("-",""):void 0}).join("|"),t.morphemesRegExp=new RegExp("("+t.morphemesRegExp+")")):t.morphemesRegExp=null,t},s=function(t){var e,r,i=!1;if(a(t),t.userSpecifiedNonContentWords){if(e=t.nonContentWordsArray.toString().substring(0,20),r=/[,\s]+/g,0===e.indexOf("/"))i=!0,t.nonContentWordsArray=t.nonContentWordsArray.toString().replace("/^(","").replace(")$/","").split("|");else if("[object Array]"===Object.prototype.toString.call(t.nonContentWordsArray))i=!0,t.nonContentWordsArray=t.nonContentWordsArray;else if(-1!==e.indexOf(",")||-1===e.indexOf(",")&&-1!==e.indexOf(" "))i=!0,t.nonContentWordsArray=t.nonContentWordsArray.split(r);else if(!i)throw"Invalid RegExp "+t.nonContentWordsArray}else t.wordFrequencies=null,t.nonContentWordsArray=[],t.nonContentWordsArray=n.calculateNonContentWords(t).nonContentWordsArray;return t.nonContentWordsRegExp=t.nonContentWordsArray.length>0?new RegExp("^("+t.nonContentWordsArray.join("|")+")$"):null,t.userRemovedWordsForAllDocumentsRegExp=t.userRemovedWordsForAllDocumentsArray&&t.userRemovedWordsForAllDocumentsArray.length>0?new RegExp("^("+t.userRemovedWordsForAllDocumentsArray.join("|")+")$"):null,t.userRemovedWordsForThisDocumentRegExp=t.userRemovedWordsForThisDocumentArray&&t.userRemovedWordsForThisDocumentArray.length>0?new RegExp("^("+t.userRemovedWordsForThisDocumentArray.join("|")+")$"):null,t},u=function(t){if(t.nonContentWordsRegExp||s(t),t.nonContentWordsRegExp&&t.nonContentWordsRegExp.test){var e=r.tokenizeInput(t).orthographicWords.map(function(e){return t.nonContentWordsRegExp.test(e)?"":t.userRemovedWordsForThisDocumentRegExp&&t.userRemovedWordsForThisDocumentRegExp.test(e)?"":t.userRemovedWordsForAllDocumentsRegExp&&t.userRemovedWordsForAllDocumentsRegExp.test(e)?"":(t.morphemesRegExp&&(e=e.replace(t.morphemesRegExp,"")),e)});return t.filteredText=e.join(" "),t}};e.NonContentWords={processNonContentWords:s,defaults:i,LexemeFrequency:n,filterText:u}}("undefined"==typeof n?this:n)},{"./LexemeFrequency":14,"./Tokenizer":17}],17:[function(t,e,n){!function(e){var n=e.MorphemeSegmenter||t("./MorphemeSegmenter").MorphemeSegmenter,r=e.Corpus2Morphology||t("./../core/corpus2morphology").Corpus2Morphology,i={punctuationArray:["!-,",".-/",":-@","[-`","{-~","-","","","","","","-"],fineWordInternallyButNotExternallyArray:["-","'","-","-"],wordDelimitersArray:[],japaneseWordBoundaryMorphemes:["-","-","-"]},o=function(t){return String(t).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},a=function(t){if(!t.orthography||!t.orthography.length)return t.orthographyArray=[],t.orthographicWords=[],t;t.punctuationArray&&0===t.punctuationArray.length&&(t.punctuationArray=null),t.wordDelimitersArray&&0===t.wordDelimitersArray.length&&(t.wordDelimitersArray=null),t.fineWordInternallyButNotExternallyArray&&0===t.fineWordInternallyButNotExternallyArray.length&&(t.fineWordInternallyButNotExternallyArray=null),t.morphemeSegmentationOptions&&(t=n.runSegmenter(t));var e=[],r=[],a=t.orthography.trim(),s=t.punctuationArray||i.punctuationArray,u=t.wordDelimitersArray||i.wordDelimitersArray,c=t.wordBoundaryMorphemes,l=t.fineWordInternallyButNotExternallyArray||i.fineWordInternallyButNotExternallyArray;if("lower"===t.caseSensitivity&&(a=a.toLocaleLowerCase()),t.userDefinedCleaningReWriteRules)for(var f in t.userDefinedCleaningReWriteRules)t.userDefinedCleaningReWriteRules.hasOwnProperty(f)&&(a=a.replace(new RegExp(t.userDefinedCleaningReWriteRules[f].source,"g"),t.userDefinedCleaningReWriteRules[f].target));return t.tokenizeOnTheseArray=s.concat(u),t.tokenizeOnTheseRegExp=new RegExp("(["+t.tokenizeOnTheseArray.join("")+"])","g"),c&&c.length>0&&(t.wordBoundaryMorphemesRegExp=new RegExp("(["+c.join()+"])","g"),a=a.replace(t.wordBoundaryMorphemesRegExp," $1 ")),a=a.replace(t.tokenizeOnTheseRegExp," $1 "),t.wordExternalPunctuationRegExp=new RegExp("(^["+l.join("")+"]|["+l.join("")+"]$)","g"),a.split(/\s/).map(function(n){if(n=n.replace(t.wordExternalPunctuationRegExp," $1 ").trim()){var i=new RegExp("(["+o(t.tokenizeOnTheseArray.join(""))+"])","g");if(1===n.length)e.push(n),t.tokenizeOnTheseRegExp.test(o(n))||t.tokenizeOnTheseRegExp.test(n)||t.wordExternalPunctuationRegExp.test(o(n))||"-"===n||","===n||r.push(n);else{var a=n.split(" ");if(1===a.length)e.push(n),r.push(n);else for(var s in a)i.test(a[s])||t.wordExternalPunctuationRegExp.test(a[s])?e.push(a[s]):(e.push(a[s]),r.push(a[s]))}}}),t.punctuationArray=s,t.orthographyArray=e,t.orthographicWords=r,t};e.Tokenizer={tokenizeInput:a},e.Corpus2Morphology=e.Corpus2Morphology||r}("undefined"==typeof n?this:n)},{"./../core/corpus2morphology":13,"./MorphemeSegmenter":15}],18:[function(t,e,n){function r(){return i.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(t){return this instanceof i?(this.length=0,this.parent=void 0,"number"==typeof t?o(this,t):"string"==typeof t?a(this,t,arguments.length>1?arguments[1]:"utf8"):s(this,t)):arguments.length>1?new i(t,arguments[1]):new i(t)}function o(t,e){if(t=d(t,0>e?0:0|p(e)),!i.TYPED_ARRAY_SUPPORT)for(var n=0;e>n;n++)t[n]=0;return t}function a(t,e,n){("string"!=typeof n||""===n)&&(n="utf8");var r=0|m(e,n);return t=d(t,r),t.write(e,n),t}function s(t,e){if(i.isBuffer(e))return u(t,e);if($(e))return c(t,e);if(null==e)throw new TypeError("must start with number, buffer, array or string");return"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer?l(t,e):e.length?f(t,e):h(t,e)}function u(t,e){var n=0|p(e.length);return t=d(t,n),e.copy(t,0,0,n),t}function c(t,e){var n=0|p(e.length);t=d(t,n);for(var r=0;n>r;r+=1)t[r]=255&e[r];return t}function l(t,e){var n=0|p(e.length);t=d(t,n);for(var r=0;n>r;r+=1)t[r]=255&e[r];return t}function f(t,e){var n=0|p(e.length);t=d(t,n);for(var r=0;n>r;r+=1)t[r]=255&e[r];return t}function h(t,e){var n,r=0;"Buffer"===e.type&&$(e.data)&&(n=e.data,r=0|p(n.length)),t=d(t,r);for(var i=0;r>i;i+=1)t[i]=255&n[i];return t}function d(t,e){i.TYPED_ARRAY_SUPPORT?t=i._augment(new Uint8Array(e)):(t.length=e,t._isBuffer=!0);var n=0!==e&&e<=i.poolSize>>>1;return n&&(t.parent=V),t}function p(t){if(t>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|t}function g(t,e){if(!(this instanceof g))return new g(t,e);var n=new i(t,e);return delete n.parent,n}function m(t,e){
"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"binary":case"raw":case"raws":return n;case"utf8":case"utf-8":return P(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(t).length;default:if(r)return P(t).length;e=(""+e).toLowerCase(),r=!0}}function y(t,e,n){var r=!1;if(e=0|e,n=void 0===n||n===1/0?this.length:0|n,t||(t="utf8"),0>e&&(e=0),n>this.length&&(n=this.length),e>=n)return"";for(;;)switch(t){case"hex":return k(this,e,n);case"utf8":case"utf-8":return E(this,e,n);case"ascii":return C(this,e,n);case"binary":return A(this,e,n);case"base64":return S(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function v(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var o=e.length;if(o%2!==0)throw new Error("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;r>a;a++){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))throw new Error("Invalid hex string");t[n+a]=s}return a}function b(t,e,n,r){return Y(P(e,t.length-n),t,n,r)}function w(t,e,n,r){return Y(z(e),t,n,r)}function x(t,e,n,r){return w(t,e,n,r)}function M(t,e,n,r){return Y(W(e),t,n,r)}function _(t,e,n,r){return Y(q(e,t.length-n),t,n,r)}function S(t,e,n){return H.fromByteArray(0===e&&n===t.length?t:t.slice(e,n))}function E(t,e,n){var r="",i="";n=Math.min(t.length,n);for(var o=e;n>o;o++)t[o]<=127?(r+=J(i)+String.fromCharCode(t[o]),i=""):i+="%"+t[o].toString(16);return r+J(i)}function C(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;n>i;i++)r+=String.fromCharCode(127&t[i]);return r}function A(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;n>i;i++)r+=String.fromCharCode(t[i]);return r}function k(t,e,n){var r=t.length;(!e||0>e)&&(e=0),(!n||0>n||n>r)&&(n=r);for(var i="",o=e;n>o;o++)i+=B(t[o]);return i}function T(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function O(t,e,n){if(t%1!==0||0>t)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,n,r,o,a){if(!i.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");if(e>o||a>e)throw new RangeError("value is out of bounds");if(n+r>t.length)throw new RangeError("index out of range")}function D(t,e,n,r){0>e&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);o>i;i++)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function U(t,e,n,r){0>e&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);o>i;i++)t[n+i]=e>>>8*(r?i:3-i)&255}function N(t,e,n,r,i,o){if(e>i||o>e)throw new RangeError("value is out of bounds");if(n+r>t.length)throw new RangeError("index out of range");if(0>n)throw new RangeError("index out of range")}function L(t,e,n,r,i){return i||N(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),G.write(t,e,n,r,23,4),n+4}function j(t,e,n,r,i){return i||N(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),G.write(t,e,n,r,52,8),n+8}function F(t){if(t=I(t).replace(X,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function I(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function B(t){return 16>t?"0"+t.toString(16):t.toString(16)}function P(t,e){e=e||1/0;for(var n,r=t.length,i=null,o=[],a=0;r>a;a++){if(n=t.charCodeAt(a),n>55295&&57344>n){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(56320>n){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&((e-=3)>-1&&o.push(239,191,189),i=null);if(128>n){if((e-=1)<0)break;o.push(n)}else if(2048>n){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(65536>n){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(2097152>n))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function z(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e}function q(t,e){for(var n,r,i,o=[],a=0;a<t.length&&!((e-=2)<0);a++)n=t.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function W(t){return H.toByteArray(F(t))}function Y(t,e,n,r){for(var i=0;r>i&&!(i+n>=e.length||i>=t.length);i++)e[i+n]=t[i];return i}function J(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}var H=t("base64-js"),G=t("ieee754"),$=t("is-array");n.Buffer=i,n.SlowBuffer=g,n.INSPECT_MAX_BYTES=50,i.poolSize=8192;var V={};i.TYPED_ARRAY_SUPPORT=function(){function t(){}try{var e=new ArrayBuffer(0),n=new Uint8Array(e);return n.foo=function(){return 42},n.constructor=t,42===n.foo()&&n.constructor===t&&"function"==typeof n.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(r){return!1}}(),i.isBuffer=function(t){return!(null==t||!t._isBuffer)},i.compare=function(t,e){if(!i.isBuffer(t)||!i.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,o=0,a=Math.min(n,r);a>o&&t[o]===e[o];)++o;return o!==a&&(n=t[o],r=e[o]),r>n?-1:n>r?1:0},i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(t,e){if(!$(t))throw new TypeError("list argument must be an Array of Buffers.");if(0===t.length)return new i(0);if(1===t.length)return t[0];var n;if(void 0===e)for(e=0,n=0;n<t.length;n++)e+=t[n].length;var r=new i(e),o=0;for(n=0;n<t.length;n++){var a=t[n];a.copy(r,o),o+=a.length}return r},i.byteLength=m,i.prototype.length=void 0,i.prototype.parent=void 0,i.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?E(this,0,t):y.apply(this,arguments)},i.prototype.equals=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:0===i.compare(this,t)},i.prototype.inspect=function(){var t="",e=n.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},i.prototype.compare=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?0:i.compare(this,t)},i.prototype.indexOf=function(t,e){function n(t,e,n){for(var r=-1,i=0;n+i<t.length;i++)if(t[n+i]===e[-1===r?0:i-r]){if(-1===r&&(r=i),i-r+1===e.length)return n+r}else r=-1;return-1}if(e>2147483647?e=2147483647:-2147483648>e&&(e=-2147483648),e>>=0,0===this.length)return-1;if(e>=this.length)return-1;if(0>e&&(e=Math.max(this.length+e,0)),"string"==typeof t)return 0===t.length?-1:String.prototype.indexOf.call(this,t,e);if(i.isBuffer(t))return n(this,t,e);if("number"==typeof t)return i.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,t,e):n(this,[t],e);throw new TypeError("val must be string, number or Buffer")},i.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},i.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},i.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else if(isFinite(e))e=0|e,isFinite(n)?(n=0|n,void 0===r&&(r="utf8")):(r=n,n=void 0);else{var i=r;r=e,e=0|n,n=i}var o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(0>n||0>e)||e>this.length)throw new RangeError("attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return v(this,t,e,n);case"utf8":case"utf-8":return b(this,t,e,n);case"ascii":return w(this,t,e,n);case"binary":return x(this,t,e,n);case"base64":return M(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,t,e,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},i.prototype.slice=function(t,e){var n=this.length;t=~~t,e=void 0===e?n:~~e,0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),t>e&&(e=t);var r;if(i.TYPED_ARRAY_SUPPORT)r=i._augment(this.subarray(t,e));else{var o=e-t;r=new i(o,void 0);for(var a=0;o>a;a++)r[a]=this[a+t]}return r.length&&(r.parent=this.parent||this),r},i.prototype.readUIntLE=function(t,e,n){t=0|t,e=0|e,n||O(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},i.prototype.readUIntBE=function(t,e,n){t=0|t,e=0|e,n||O(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},i.prototype.readUInt8=function(t,e){return e||O(t,1,this.length),this[t]},i.prototype.readUInt16LE=function(t,e){return e||O(t,2,this.length),this[t]|this[t+1]<<8},i.prototype.readUInt16BE=function(t,e){return e||O(t,2,this.length),this[t]<<8|this[t+1]},i.prototype.readUInt32LE=function(t,e){return e||O(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},i.prototype.readUInt32BE=function(t,e){return e||O(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},i.prototype.readIntLE=function(t,e,n){t=0|t,e=0|e,n||O(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},i.prototype.readIntBE=function(t,e,n){t=0|t,e=0|e,n||O(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*e)),o},i.prototype.readInt8=function(t,e){return e||O(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},i.prototype.readInt16LE=function(t,e){e||O(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt16BE=function(t,e){e||O(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt32LE=function(t,e){return e||O(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},i.prototype.readInt32BE=function(t,e){return e||O(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},i.prototype.readFloatLE=function(t,e){return e||O(t,4,this.length),G.read(this,t,!0,23,4)},i.prototype.readFloatBE=function(t,e){return e||O(t,4,this.length),G.read(this,t,!1,23,4)},i.prototype.readDoubleLE=function(t,e){return e||O(t,8,this.length),G.read(this,t,!0,52,8)},i.prototype.readDoubleBE=function(t,e){return e||O(t,8,this.length),G.read(this,t,!1,52,8)},i.prototype.writeUIntLE=function(t,e,n,r){t=+t,e=0|e,n=0|n,r||R(this,t,e,n,Math.pow(2,8*n),0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},i.prototype.writeUIntBE=function(t,e,n,r){t=+t,e=0|e,n=0|n,r||R(this,t,e,n,Math.pow(2,8*n),0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},i.prototype.writeUInt8=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,1,255,0),i.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=t,e+1},i.prototype.writeUInt16LE=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,2,65535,0),i.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},i.prototype.writeUInt16BE=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,2,65535,0),i.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):D(this,t,e,!1),e+2},i.prototype.writeUInt32LE=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,4,4294967295,0),i.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t):U(this,t,e,!0),e+4},i.prototype.writeUInt32BE=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,4,4294967295,0),i.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):U(this,t,e,!1),e+4},i.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e=0|e,!r){var i=Math.pow(2,8*n-1);R(this,t,e,n,i-1,-i)}var o=0,a=1,s=0>t?1:0;for(this[e]=255&t;++o<n&&(a*=256);)this[e+o]=(t/a>>0)-s&255;return e+n},i.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e=0|e,!r){var i=Math.pow(2,8*n-1);R(this,t,e,n,i-1,-i)}var o=n-1,a=1,s=0>t?1:0;for(this[e+o]=255&t;--o>=0&&(a*=256);)this[e+o]=(t/a>>0)-s&255;return e+n},i.prototype.writeInt8=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,1,127,-128),i.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),0>t&&(t=255+t+1),this[e]=t,e+1},i.prototype.writeInt16LE=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,2,32767,-32768),i.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},i.prototype.writeInt16BE=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,2,32767,-32768),i.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):D(this,t,e,!1),e+2},i.prototype.writeInt32LE=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,4,2147483647,-2147483648),i.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):U(this,t,e,!0),e+4},i.prototype.writeInt32BE=function(t,e,n){return t=+t,e=0|e,n||R(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),i.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):U(this,t,e,!1),e+4},i.prototype.writeFloatLE=function(t,e,n){return L(this,t,e,!0,n)},i.prototype.writeFloatBE=function(t,e,n){return L(this,t,e,!1,n)},i.prototype.writeDoubleLE=function(t,e,n){return j(this,t,e,!0,n)},i.prototype.writeDoubleBE=function(t,e,n){return j(this,t,e,!1,n)},i.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&n>r&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(0>e)throw new RangeError("targetStart out of bounds");if(0>n||n>=this.length)throw new RangeError("sourceStart out of bounds");if(0>r)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var o=r-n;if(1e3>o||!i.TYPED_ARRAY_SUPPORT)for(var a=0;o>a;a++)t[a+e]=this[a+n];else t._set(this.subarray(n,n+o),e);return o},i.prototype.fill=function(t,e,n){if(t||(t=0),e||(e=0),n||(n=this.length),e>n)throw new RangeError("end < start");if(n!==e&&0!==this.length){if(0>e||e>=this.length)throw new RangeError("start out of bounds");if(0>n||n>this.length)throw new RangeError("end out of bounds");var r;if("number"==typeof t)for(r=e;n>r;r++)this[r]=t;else{var i=P(t.toString()),o=i.length;for(r=e;n>r;r++)this[r]=i[r%o]}return this}},i.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(i.TYPED_ARRAY_SUPPORT)return new i(this).buffer;for(var t=new Uint8Array(this.length),e=0,n=t.length;n>e;e+=1)t[e]=this[e];return t.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var K=i.prototype;i._augment=function(t){return t.constructor=i,t._isBuffer=!0,t._set=t.set,t.get=K.get,t.set=K.set,t.write=K.write,t.toString=K.toString,t.toLocaleString=K.toString,t.toJSON=K.toJSON,t.equals=K.equals,t.compare=K.compare,t.indexOf=K.indexOf,t.copy=K.copy,t.slice=K.slice,t.readUIntLE=K.readUIntLE,t.readUIntBE=K.readUIntBE,t.readUInt8=K.readUInt8,t.readUInt16LE=K.readUInt16LE,t.readUInt16BE=K.readUInt16BE,t.readUInt32LE=K.readUInt32LE,t.readUInt32BE=K.readUInt32BE,t.readIntLE=K.readIntLE,t.readIntBE=K.readIntBE,t.readInt8=K.readInt8,t.readInt16LE=K.readInt16LE,t.readInt16BE=K.readInt16BE,t.readInt32LE=K.readInt32LE,t.readInt32BE=K.readInt32BE,t.readFloatLE=K.readFloatLE,t.readFloatBE=K.readFloatBE,t.readDoubleLE=K.readDoubleLE,t.readDoubleBE=K.readDoubleBE,t.writeUInt8=K.writeUInt8,t.writeUIntLE=K.writeUIntLE,t.writeUIntBE=K.writeUIntBE,t.writeUInt16LE=K.writeUInt16LE,t.writeUInt16BE=K.writeUInt16BE,t.writeUInt32LE=K.writeUInt32LE,t.writeUInt32BE=K.writeUInt32BE,t.writeIntLE=K.writeIntLE,t.writeIntBE=K.writeIntBE,t.writeInt8=K.writeInt8,t.writeInt16LE=K.writeInt16LE,t.writeInt16BE=K.writeInt16BE,t.writeInt32LE=K.writeInt32LE,t.writeInt32BE=K.writeInt32BE,t.writeFloatLE=K.writeFloatLE,t.writeFloatBE=K.writeFloatBE,t.writeDoubleLE=K.writeDoubleLE,t.writeDoubleBE=K.writeDoubleBE,t.fill=K.fill,t.inspect=K.inspect,t.toArrayBuffer=K.toArrayBuffer,t};var X=/[^+\/0-9A-z\-]/g},{"base64-js":19,ieee754:20,"is-array":21}],19:[function(t,e,n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(t){"use strict";function e(t){var e=t.charCodeAt(0);return e===a||e===f?62:e===s||e===h?63:u>e?-1:u+10>e?e-u+26+26:l+26>e?e-l:c+26>e?e-c+26:void 0}function n(t){function n(t){c[f++]=t}var r,i,a,s,u,c;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var l=t.length;u="="===t.charAt(l-2)?2:"="===t.charAt(l-1)?1:0,c=new o(3*t.length/4-u),a=u>0?t.length-4:t.length;var f=0;for(r=0,i=0;a>r;r+=4,i+=3)s=e(t.charAt(r))<<18|e(t.charAt(r+1))<<12|e(t.charAt(r+2))<<6|e(t.charAt(r+3)),n((16711680&s)>>16),n((65280&s)>>8),n(255&s);return 2===u?(s=e(t.charAt(r))<<2|e(t.charAt(r+1))>>4,n(255&s)):1===u&&(s=e(t.charAt(r))<<10|e(t.charAt(r+1))<<4|e(t.charAt(r+2))>>2,n(s>>8&255),n(255&s)),c}function i(t){function e(t){return r.charAt(t)}function n(t){return e(t>>18&63)+e(t>>12&63)+e(t>>6&63)+e(63&t)}var i,o,a,s=t.length%3,u="";for(i=0,a=t.length-s;a>i;i+=3)o=(t[i]<<16)+(t[i+1]<<8)+t[i+2],u+=n(o);switch(s){case 1:o=t[t.length-1],u+=e(o>>2),u+=e(o<<4&63),u+="==";break;case 2:o=(t[t.length-2]<<8)+t[t.length-1],u+=e(o>>10),u+=e(o>>4&63),u+=e(o<<2&63),u+="="}return u}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="+".charCodeAt(0),s="/".charCodeAt(0),u="0".charCodeAt(0),c="a".charCodeAt(0),l="A".charCodeAt(0),f="-".charCodeAt(0),h="_".charCodeAt(0);t.toByteArray=n,t.fromByteArray=i}("undefined"==typeof n?this.base64js={}:n)},{}],20:[function(t,e,n){n.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,f=n?i-1:0,h=n?-1:1,d=t[e+f];for(f+=h,o=d&(1<<-l)-1,d>>=-l,l+=s;l>0;o=256*o+t[e+f],f+=h,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return a?0/0:(d?-1:1)*(1/0);a+=Math.pow(2,r),o-=c}return(d?-1:1)*a*Math.pow(2,o-r)},n.write=function(t,e,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,g=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),e+=a+f>=1?h/u:h*Math.pow(2,1-f),e*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(e*u-1)*Math.pow(2,i),a+=f):(s=e*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;t[n+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;t[n+d]=255&a,d+=p,a/=256,c-=8);t[n+d-p]|=128*g}},{}],21:[function(t,e,n){var r=Array.isArray,i=Object.prototype.toString;e.exports=r||function(t){return!!t&&"[object Array]"==i.call(t)}},{}],22:[function(t,e,n){function r(){l=!1,s.length?c=s.concat(c):f=-1,c.length&&i()}function i(){if(!l){var t=setTimeout(r);l=!0;for(var e=c.length;e;){for(s=c,c=[];++f<e;)s[f].run();f=-1,e=c.length}s=null,l=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function a(){}var s,u=e.exports={},c=[],l=!1,f=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new o(t,e)),1!==c.length||l||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],23:[function(t,e,n){var r=e.exports=function(t,e){var n=document.createElement("canvas");return n.width=t||300,n.height=e||150,n};r.Image=function(){var t=document.createElement("img");return t}},{}],24:[function(t,e,n){!function(){function t(t){return t&&(t.ownerDocument||t.document||t).documentElement}function n(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}function r(t,e){return e>t?-1:t>e?1:t>=e?0:0/0}function i(t){return null===t?0/0:+t}function o(t){return!isNaN(t)}function a(t){return{left:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);i>r;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);i>r;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}function s(t){return t.length}function u(t){for(var e=1;t*e%1;)e*=10;return e}function c(t,e){for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}function l(){this._=Object.create(null)}function f(t){return(t+="")===ma||t[0]===ya?ya+t:t}function h(t){return(t+="")[0]===ya?t.slice(1):t}function d(t){return f(t)in this._}function p(t){return(t=f(t))in this._&&delete this._[t]}function g(){var t=[];for(var e in this._)t.push(h(e));return t}function m(){var t=0;for(var e in this._)++t;return t}function y(){for(var t in this._)return!1;return!0}function v(){this._=Object.create(null)}function b(t){return t}function w(t,e,n){return function(){var r=n.apply(e,arguments);return r===e?t:r}}function x(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.slice(1);for(var n=0,r=va.length;r>n;++n){var i=va[n]+e;if(i in t)return i}}function M(){}function _(){}function S(t){function e(){for(var e,r=n,i=-1,o=r.length;++i<o;)(e=r[i].on)&&e.apply(this,arguments);return t}var n=[],r=new l;return e.on=function(e,i){var o,a=r.get(e);return arguments.length<2?a&&a.on:(a&&(a.on=null,n=n.slice(0,o=n.indexOf(a)).concat(n.slice(o+1)),r.remove(e)),i&&n.push(r.set(e,{on:i})),t)},e}function E(){ra.event.preventDefault()}function C(){for(var t,e=ra.event;t=e.sourceEvent;)e=t;return e}function A(t){for(var e=new _,n=0,r=arguments.length;++n<r;)e[arguments[n]]=S(e);return e.of=function(n,r){return function(i){try{var o=i.sourceEvent=ra.event;i.target=t,ra.event=i,e[i.type].apply(n,r)}finally{ra.event=o}}},e}function k(t){return wa(t,Sa),t}function T(t){return"function"==typeof t?t:function(){return xa(t,this)}}function O(t){return"function"==typeof t?t:function(){return Ma(t,this)}}function R(t,e){function n(){this.removeAttribute(t)}function r(){this.removeAttributeNS(t.space,t.local)}function i(){this.setAttribute(t,e)}function o(){this.setAttributeNS(t.space,t.local,e)}function a(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function s(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}return t=ra.ns.qualify(t),null==e?t.local?r:n:"function"==typeof e?t.local?s:a:t.local?o:i}function D(t){return t.trim().replace(/\s+/g," ")}function U(t){return new RegExp("(?:^|\\s+)"+ra.requote(t)+"(?:\\s+|$)","g")}function N(t){return(t+"").trim().split(/^|\s+/)}function L(t,e){function n(){for(var n=-1;++n<i;)t[n](this,e)}function r(){for(var n=-1,r=e.apply(this,arguments);++n<i;)t[n](this,r)}t=N(t).map(j);var i=t.length;return"function"==typeof e?r:n}function j(t){var e=U(t);return function(n,r){if(i=n.classList)return r?i.add(t):i.remove(t);var i=n.getAttribute("class")||"";r?(e.lastIndex=0,e.test(i)||n.setAttribute("class",D(i+" "+t))):n.setAttribute("class",D(i.replace(e," ")))}}function F(t,e,n){function r(){this.style.removeProperty(t)}function i(){this.style.setProperty(t,e,n)}function o(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}return null==e?r:"function"==typeof e?o:i}function I(t,e){function n(){delete this[t]}function r(){this[t]=e}function i(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return null==e?n:"function"==typeof e?i:r}function B(t){function e(){var e=this.ownerDocument,n=this.namespaceURI;return n?e.createElementNS(n,t):e.createElement(t)}function n(){return this.ownerDocument.createElementNS(t.space,t.local)}return"function"==typeof t?t:(t=ra.ns.qualify(t)).local?n:e}function P(){var t=this.parentNode;t&&t.removeChild(this)}function z(t){return{__data__:t}}function q(t){return function(){return _a(this,t)}}function W(t){return arguments.length||(t=r),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function Y(t,e){for(var n=0,r=t.length;r>n;n++)for(var i,o=t[n],a=0,s=o.length;s>a;a++)(i=o[a])&&e(i,a,n);return t}function J(t){return wa(t,Ca),t}function H(t){var e,n;return function(r,i,o){var a,s=t[o].update,u=s.length;for(o!=n&&(n=o,e=0),i>=e&&(e=i+1);!(a=s[e])&&++e<u;);return a}}function G(t,e,n){function r(){var e=this[a];e&&(this.removeEventListener(t,e,e.$),delete this[a])}function i(){var i=u(e,oa(arguments));r.call(this),this.addEventListener(t,this[a]=i,i.$=n),i._=e}function o(){var e,n=new RegExp("^__on([^.]+)"+ra.requote(t)+"$");for(var r in this)if(e=r.match(n)){var i=this[r];this.removeEventListener(e[1],i,i.$),delete this[r]}}var a="__on"+t,s=t.indexOf("."),u=$;s>0&&(t=t.slice(0,s));var c=Aa.get(t);return c&&(t=c,u=V),s?e?i:r:e?M:o}function $(t,e){return function(n){var r=ra.event;ra.event=n,e[0]=this.__data__;try{t.apply(this,e)}finally{ra.event=r}}}function V(t,e){var n=$(t,e);return function(t){var e=this,r=t.relatedTarget;r&&(r===e||8&r.compareDocumentPosition(e))||n.call(e,t)}}function K(e){var r=".dragsuppress-"+ ++Ta,i="click"+r,o=ra.select(n(e)).on("touchmove"+r,E).on("dragstart"+r,E).on("selectstart"+r,E);if(null==ka&&(ka="onselectstart"in e?!1:x(e.style,"userSelect")),ka){var a=t(e).style,s=a[ka];a[ka]="none"}return function(t){if(o.on(r,null),ka&&(a[ka]=s),t){var e=function(){o.on(i,null)};o.on(i,function(){E(),e()},!0),setTimeout(e,0)}}}function X(t,e){e.changedTouches&&(e=e.changedTouches[0]);var r=t.ownerSVGElement||t;if(r.createSVGPoint){var i=r.createSVGPoint();if(0>Oa){var o=n(t);if(o.scrollX||o.scrollY){r=ra.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var a=r[0][0].getScreenCTM();Oa=!(a.f||a.e),r.remove()}}return Oa?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}function Z(){return ra.event.changedTouches[0].identifier}function Q(t){return t>0?1:0>t?-1:0}function tt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function et(t){return t>1?0:-1>t?Ua:Math.acos(t)}function nt(t){return t>1?ja:-1>t?-ja:Math.asin(t)}function rt(t){return((t=Math.exp(t))-1/t)/2}function it(t){return((t=Math.exp(t))+1/t)/2}function ot(t){return((t=Math.exp(2*t))-1)/(t+1)}function at(t){return(t=Math.sin(t/2))*t}function st(){}function ut(t,e,n){return this instanceof ut?(this.h=+t,this.s=+e,void(this.l=+n)):arguments.length<2?t instanceof ut?new ut(t.h,t.s,t.l):Mt(""+t,_t,ut):new ut(t,e,n)}function ct(t,e,n){function r(t){return t>360?t-=360:0>t&&(t+=360),60>t?o+(a-o)*t/60:180>t?a:240>t?o+(a-o)*(240-t)/60:o}function i(t){return Math.round(255*r(t))}var o,a;return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)?0:0>e?0:e>1?1:e,n=0>n?0:n>1?1:n,a=.5>=n?n*(1+e):n+e-n*e,o=2*n-a,new vt(i(t+120),i(t),i(t-120))}function lt(t,e,n){return this instanceof lt?(this.h=+t,this.c=+e,void(this.l=+n)):arguments.length<2?t instanceof lt?new lt(t.h,t.c,t.l):t instanceof ht?pt(t.l,t.a,t.b):pt((t=St((t=ra.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new lt(t,e,n)}function ft(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new ht(n,Math.cos(t*=Fa)*e,Math.sin(t)*e)}function ht(t,e,n){return this instanceof ht?(this.l=+t,this.a=+e,void(this.b=+n)):arguments.length<2?t instanceof ht?new ht(t.l,t.a,t.b):t instanceof lt?ft(t.h,t.c,t.l):St((t=vt(t)).r,t.g,t.b):new ht(t,e,n)}function dt(t,e,n){var r=(t+16)/116,i=r+e/500,o=r-n/200;return i=gt(i)*$a,r=gt(r)*Va,o=gt(o)*Ka,new vt(yt(3.2404542*i-1.5371385*r-.4985314*o),yt(-.969266*i+1.8760108*r+.041556*o),yt(.0556434*i-.2040259*r+1.0572252*o))}function pt(t,e,n){return t>0?new lt(Math.atan2(n,e)*Ia,Math.sqrt(e*e+n*n),t):new lt(0/0,0/0,t)}function gt(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function mt(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function yt(t){return Math.round(255*(.00304>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function vt(t,e,n){return this instanceof vt?(this.r=~~t,this.g=~~e,void(this.b=~~n)):arguments.length<2?t instanceof vt?new vt(t.r,t.g,t.b):Mt(""+t,vt,ct):new vt(t,e,n)}function bt(t){return new vt(t>>16,t>>8&255,255&t)}function wt(t){return bt(t)+""}function xt(t){return 16>t?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function Mt(t,e,n){t=t.toLowerCase();var r,i,o,a=0,s=0,u=0;if(r=/([a-z]+)\((.*)\)/.exec(t))switch(i=r[2].split(","),r[1]){case"hsl":return n(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return e(Ct(i[0]),Ct(i[1]),Ct(i[2]))}return(o=Qa.get(t))?e(o.r,o.g,o.b):(null==t||"#"!==t.charAt(0)||isNaN(o=parseInt(t.slice(1),16))||(4===t.length?(a=(3840&o)>>4,a=a>>4|a,s=240&o,s=s>>4|s,u=15&o,u=u<<4|u):7===t.length&&(a=(16711680&o)>>16,s=(65280&o)>>8,u=255&o)),e(a,s,u))}function _t(t,e,n){var r,i,o=Math.min(t/=255,e/=255,n/=255),a=Math.max(t,e,n),s=a-o,u=(a+o)/2;return s?(i=.5>u?s/(a+o):s/(2-a-o),r=t==a?(e-n)/s+(n>e?6:0):e==a?(n-t)/s+2:(t-e)/s+4,r*=60):(r=0/0,i=u>0&&1>u?0:r),new ut(r,i,u)}function St(t,e,n){t=Et(t),e=Et(e),n=Et(n);var r=mt((.4124564*t+.3575761*e+.1804375*n)/$a),i=mt((.2126729*t+.7151522*e+.072175*n)/Va),o=mt((.0193339*t+.119192*e+.9503041*n)/Ka);return ht(116*i-16,500*(r-i),200*(i-o))}function Et(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ct(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function At(t){return"function"==typeof t?t:function(){return t}}function kt(t){return function(e,n,r){return 2===arguments.length&&"function"==typeof n&&(r=n,n=null),Tt(e,n,t,r)}}function Tt(t,e,n,r){function i(){var t,e=u.status;if(!e&&Rt(u)||e>=200&&300>e||304===e){try{t=n.call(o,u)}catch(r){return void a.error.call(o,r)}a.load.call(o,t)}else a.error.call(o,u)}var o={},a=ra.dispatch("beforesend","progress","load","error"),s={},u=new XMLHttpRequest,c=null;return!this.XDomainRequest||"withCredentials"in u||!/^(http(s)?:)?\/\//.test(t)||(u=new XDomainRequest),"onload"in u?u.onload=u.onerror=i:u.onreadystatechange=function(){u.readyState>3&&i()},u.onprogress=function(t){var e=ra.event;ra.event=t;try{a.progress.call(o,u)}finally{ra.event=e}},o.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s[t]:(null==e?delete s[t]:s[t]=e+"",o)},o.mimeType=function(t){return arguments.length?(e=null==t?null:t+"",o):e},o.responseType=function(t){return arguments.length?(c=t,o):c},o.response=function(t){return n=t,o},["get","post"].forEach(function(t){o[t]=function(){return o.send.apply(o,[t].concat(oa(arguments)))}}),o.send=function(n,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),u.open(n,t,!0),null==e||"accept"in s||(s.accept=e+",*/*"),u.setRequestHeader)for(var l in s)u.setRequestHeader(l,s[l]);return null!=e&&u.overrideMimeType&&u.overrideMimeType(e),null!=c&&(u.responseType=c),null!=i&&o.on("error",i).on("load",function(t){i(null,t)}),a.beforesend.call(o,u),u.send(null==r?null:r),o},o.abort=function(){return u.abort(),o},ra.rebind(o,a,"on"),null==r?o:o.get(Ot(r))}function Ot(t){return 1===t.length?function(e,n){t(null==e?n:null)}:t}function Rt(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function Dt(){var t=Ut(),e=Nt()-t;e>24?(isFinite(e)&&(clearTimeout(rs),rs=setTimeout(Dt,e)),ns=0):(ns=1,os(Dt))}function Ut(){var t=Date.now();for(is=ts;is;)t>=is.t&&(is.f=is.c(t-is.t)),is=is.n;return t}function Nt(){for(var t,e=ts,n=1/0;e;)e.f?e=t?t.n=e.n:ts=e.n:(e.t<n&&(n=e.t),e=(t=e).n);return es=t,n}function Lt(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function jt(t,e){var n=Math.pow(10,3*ga(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}function Ft(t){var e=t.decimal,n=t.thousands,r=t.grouping,i=t.currency,o=r&&n?function(t,e){for(var i=t.length,o=[],a=0,s=r[0],u=0;i>0&&s>0&&(u+s+1>e&&(s=Math.max(1,e-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>e));)s=r[a=(a+1)%r.length];return o.reverse().join(n)}:b;return function(t){var n=ss.exec(t),r=n[1]||" ",a=n[2]||">",s=n[3]||"-",u=n[4]||"",c=n[5],l=+n[6],f=n[7],h=n[8],d=n[9],p=1,g="",m="",y=!1,v=!0;

switch(h&&(h=+h.substring(1)),(c||"0"===r&&"="===a)&&(c=r="0",a="="),d){case"n":f=!0,d="g";break;case"%":p=100,m="%",d="f";break;case"p":p=100,m="%",d="r";break;case"b":case"o":case"x":case"X":"#"===u&&(g="0"+d.toLowerCase());case"c":v=!1;case"d":y=!0,h=0;break;case"s":p=-1,d="r"}"$"===u&&(g=i[0],m=i[1]),"r"!=d||h||(d="g"),null!=h&&("g"==d?h=Math.max(1,Math.min(21,h)):("e"==d||"f"==d)&&(h=Math.max(0,Math.min(20,h)))),d=us.get(d)||It;var b=c&&f;return function(t){var n=m;if(y&&t%1)return"";var i=0>t||0===t&&0>1/t?(t=-t,"-"):"-"===s?"":s;if(0>p){var u=ra.formatPrefix(t,h);t=u.scale(t),n=u.symbol+m}else t*=p;t=d(t,h);var w,x,M=t.lastIndexOf(".");if(0>M){var _=v?t.lastIndexOf("e"):-1;0>_?(w=t,x=""):(w=t.substring(0,_),x=t.substring(_))}else w=t.substring(0,M),x=e+t.substring(M+1);!c&&f&&(w=o(w,1/0));var S=g.length+w.length+x.length+(b?0:i.length),E=l>S?new Array(S=l-S+1).join(r):"";return b&&(w=o(E+w,E.length?l-x.length:1/0)),i+=g,t=w+x,("<"===a?i+t+E:">"===a?E+i+t:"^"===a?E.substring(0,S>>=1)+i+t+E.substring(S):i+(b?t:E+t))+n}}}function It(t){return t+""}function Bt(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Pt(t,e,n){function r(e){var n=t(e),r=o(n,1);return r-e>e-n?n:r}function i(n){return e(n=t(new ls(n-1)),1),n}function o(t,n){return e(t=new ls(+t),n),t}function a(t,r,o){var a=i(t),s=[];if(o>1)for(;r>a;)n(a)%o||s.push(new Date(+a)),e(a,1);else for(;r>a;)s.push(new Date(+a)),e(a,1);return s}function s(t,e,n){try{ls=Bt;var r=new Bt;return r._=t,a(r,e,n)}finally{ls=Date}}t.floor=t,t.round=r,t.ceil=i,t.offset=o,t.range=a;var u=t.utc=zt(t);return u.floor=u,u.round=zt(r),u.ceil=zt(i),u.offset=zt(o),u.range=s,t}function zt(t){return function(e,n){try{ls=Bt;var r=new Bt;return r._=e,t(r,n)._}finally{ls=Date}}}function qt(t){function e(t){function e(e){for(var n,i,o,a=[],s=-1,u=0;++s<r;)37===t.charCodeAt(s)&&(a.push(t.slice(u,s)),null!=(i=hs[n=t.charAt(++s)])&&(n=t.charAt(++s)),(o=k[n])&&(n=o(e,null==i?"e"===n?" ":"0":i)),a.push(n),u=s+1);return a.push(t.slice(u,s)),a.join("")}var r=t.length;return e.parse=function(e){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=n(r,t,e,0);if(i!=e.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var o=null!=r.Z&&ls!==Bt,a=new(o?Bt:ls);return"j"in r?a.setFullYear(r.y,0,r.j):"w"in r&&("W"in r||"U"in r)?(a.setFullYear(r.y,0,1),a.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(a.getDay()+5)%7:r.w+7*r.U-(a.getDay()+6)%7)):a.setFullYear(r.y,r.m,r.d),a.setHours(r.H+(r.Z/100|0),r.M+r.Z%100,r.S,r.L),o?a._:a},e.toString=function(){return t},e}function n(t,e,n,r){for(var i,o,a,s=0,u=e.length,c=n.length;u>s;){if(r>=c)return-1;if(i=e.charCodeAt(s++),37===i){if(a=e.charAt(s++),o=T[a in hs?e.charAt(s++):a],!o||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function r(t,e,n){M.lastIndex=0;var r=M.exec(e.slice(n));return r?(t.w=_.get(r[0].toLowerCase()),n+r[0].length):-1}function i(t,e,n){w.lastIndex=0;var r=w.exec(e.slice(n));return r?(t.w=x.get(r[0].toLowerCase()),n+r[0].length):-1}function o(t,e,n){C.lastIndex=0;var r=C.exec(e.slice(n));return r?(t.m=A.get(r[0].toLowerCase()),n+r[0].length):-1}function a(t,e,n){S.lastIndex=0;var r=S.exec(e.slice(n));return r?(t.m=E.get(r[0].toLowerCase()),n+r[0].length):-1}function s(t,e,r){return n(t,k.c.toString(),e,r)}function u(t,e,r){return n(t,k.x.toString(),e,r)}function c(t,e,r){return n(t,k.X.toString(),e,r)}function l(t,e,n){var r=b.get(e.slice(n,n+=2).toLowerCase());return null==r?-1:(t.p=r,n)}var f=t.dateTime,h=t.date,d=t.time,p=t.periods,g=t.days,m=t.shortDays,y=t.months,v=t.shortMonths;e.utc=function(t){function n(t){try{ls=Bt;var e=new ls;return e._=t,r(e)}finally{ls=Date}}var r=e(t);return n.parse=function(t){try{ls=Bt;var e=r.parse(t);return e&&e._}finally{ls=Date}},n.toString=r.toString,n},e.multi=e.utc.multi=ue;var b=ra.map(),w=Yt(g),x=Jt(g),M=Yt(m),_=Jt(m),S=Yt(y),E=Jt(y),C=Yt(v),A=Jt(v);p.forEach(function(t,e){b.set(t.toLowerCase(),e)});var k={a:function(t){return m[t.getDay()]},A:function(t){return g[t.getDay()]},b:function(t){return v[t.getMonth()]},B:function(t){return y[t.getMonth()]},c:e(f),d:function(t,e){return Wt(t.getDate(),e,2)},e:function(t,e){return Wt(t.getDate(),e,2)},H:function(t,e){return Wt(t.getHours(),e,2)},I:function(t,e){return Wt(t.getHours()%12||12,e,2)},j:function(t,e){return Wt(1+cs.dayOfYear(t),e,3)},L:function(t,e){return Wt(t.getMilliseconds(),e,3)},m:function(t,e){return Wt(t.getMonth()+1,e,2)},M:function(t,e){return Wt(t.getMinutes(),e,2)},p:function(t){return p[+(t.getHours()>=12)]},S:function(t,e){return Wt(t.getSeconds(),e,2)},U:function(t,e){return Wt(cs.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return Wt(cs.mondayOfYear(t),e,2)},x:e(h),X:e(d),y:function(t,e){return Wt(t.getFullYear()%100,e,2)},Y:function(t,e){return Wt(t.getFullYear()%1e4,e,4)},Z:ae,"%":function(){return"%"}},T={a:r,A:i,b:o,B:a,c:s,d:te,e:te,H:ne,I:ne,j:ee,L:oe,m:Qt,M:re,p:l,S:ie,U:Gt,w:Ht,W:$t,x:u,X:c,y:Kt,Y:Vt,Z:Xt,"%":se};return e}function Wt(t,e,n){var r=0>t?"-":"",i=(r?-t:t)+"",o=i.length;return r+(n>o?new Array(n-o+1).join(e)+i:i)}function Yt(t){return new RegExp("^(?:"+t.map(ra.requote).join("|")+")","i")}function Jt(t){for(var e=new l,n=-1,r=t.length;++n<r;)e.set(t[n].toLowerCase(),n);return e}function Ht(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Gt(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n));return r?(t.U=+r[0],n+r[0].length):-1}function $t(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n));return r?(t.W=+r[0],n+r[0].length):-1}function Vt(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Kt(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+2));return r?(t.y=Zt(+r[0]),n+r[0].length):-1}function Xt(t,e,n){return/^[+-]\d{4}$/.test(e=e.slice(n,n+5))?(t.Z=-e,n+5):-1}function Zt(t){return t+(t>68?1900:2e3)}function Qt(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function te(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function ee(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+3));return r?(t.j=+r[0],n+r[0].length):-1}function ne(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function re(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function ie(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function oe(t,e,n){ds.lastIndex=0;var r=ds.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function ae(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",r=ga(e)/60|0,i=ga(e)%60;return n+Wt(r,"0",2)+Wt(i,"0",2)}function se(t,e,n){ps.lastIndex=0;var r=ps.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function ue(t){for(var e=t.length,n=-1;++n<e;)t[n][0]=this(t[n][0]);return function(e){for(var n=0,r=t[n];!r[1](e);)r=t[++n];return r[0](e)}}function ce(){}function le(t,e,n){var r=n.s=t+e,i=r-t,o=r-i;n.t=t-o+(e-i)}function fe(t,e){t&&vs.hasOwnProperty(t.type)&&vs[t.type](t,e)}function he(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function de(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)he(t[n],e,1);e.polygonEnd()}function pe(){function t(t,e){t*=Fa,e=e*Fa/2+Ua/4;var n=t-r,a=n>=0?1:-1,s=a*n,u=Math.cos(e),c=Math.sin(e),l=o*c,f=i*u+l*Math.cos(s),h=l*a*Math.sin(s);ws.add(Math.atan2(h,f)),r=t,i=u,o=c}var e,n,r,i,o;xs.point=function(a,s){xs.point=t,r=(e=a)*Fa,i=Math.cos(s=(n=s)*Fa/2+Ua/4),o=Math.sin(s)},xs.lineEnd=function(){t(e,n)}}function ge(t){var e=t[0],n=t[1],r=Math.cos(n);return[r*Math.cos(e),r*Math.sin(e),Math.sin(n)]}function me(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ye(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ve(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function be(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function we(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function xe(t){return[Math.atan2(t[1],t[0]),nt(t[2])]}function Me(t,e){return ga(t[0]-e[0])<Ra&&ga(t[1]-e[1])<Ra}function _e(t,e){t*=Fa;var n=Math.cos(e*=Fa);Se(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function Se(t,e,n){++Ms,Ss+=(t-Ss)/Ms,Es+=(e-Es)/Ms,Cs+=(n-Cs)/Ms}function Ee(){function t(t,i){t*=Fa;var o=Math.cos(i*=Fa),a=o*Math.cos(t),s=o*Math.sin(t),u=Math.sin(i),c=Math.atan2(Math.sqrt((c=n*u-r*s)*c+(c=r*a-e*u)*c+(c=e*s-n*a)*c),e*a+n*s+r*u);_s+=c,As+=c*(e+(e=a)),ks+=c*(n+(n=s)),Ts+=c*(r+(r=u)),Se(e,n,r)}var e,n,r;Us.point=function(i,o){i*=Fa;var a=Math.cos(o*=Fa);e=a*Math.cos(i),n=a*Math.sin(i),r=Math.sin(o),Us.point=t,Se(e,n,r)}}function Ce(){Us.point=_e}function Ae(){function t(t,e){t*=Fa;var n=Math.cos(e*=Fa),a=n*Math.cos(t),s=n*Math.sin(t),u=Math.sin(e),c=i*u-o*s,l=o*a-r*u,f=r*s-i*a,h=Math.sqrt(c*c+l*l+f*f),d=r*a+i*s+o*u,p=h&&-et(d)/h,g=Math.atan2(h,d);Os+=p*c,Rs+=p*l,Ds+=p*f,_s+=g,As+=g*(r+(r=a)),ks+=g*(i+(i=s)),Ts+=g*(o+(o=u)),Se(r,i,o)}var e,n,r,i,o;Us.point=function(a,s){e=a,n=s,Us.point=t,a*=Fa;var u=Math.cos(s*=Fa);r=u*Math.cos(a),i=u*Math.sin(a),o=Math.sin(s),Se(r,i,o)},Us.lineEnd=function(){t(e,n),Us.lineEnd=Ce,Us.point=_e}}function ke(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return n=e.invert(n,r),n&&t.invert(n[0],n[1])}),n}function Te(){return!0}function Oe(t,e,n,r,i){var o=[],a=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],r=t[e];if(Me(n,r)){i.lineStart();for(var s=0;e>s;++s)i.point((n=t[s])[0],n[1]);return void i.lineEnd()}var u=new De(n,t,null,!0),c=new De(n,null,u,!1);u.o=c,o.push(u),a.push(c),u=new De(r,t,null,!1),c=new De(r,null,u,!0),u.o=c,o.push(u),a.push(c)}}),a.sort(e),Re(o),Re(a),o.length){for(var s=0,u=n,c=a.length;c>s;++s)a[s].e=u=!u;for(var l,f,h=o[0];;){for(var d=h,p=!0;d.v;)if((d=d.n)===h)return;l=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(p)for(var s=0,c=l.length;c>s;++s)i.point((f=l[s])[0],f[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(p){l=d.p.z;for(var s=l.length-1;s>=0;--s)i.point((f=l[s])[0],f[1])}else r(d.x,d.p.x,-1,i);d=d.p}d=d.o,l=d.z,p=!p}while(!d.v);i.lineEnd()}}}function Re(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function De(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Ue(t,e,n,r){return function(i,o){function a(e,n){var r=i(e,n);t(e=r[0],n=r[1])&&o.point(e,n)}function s(t,e){var n=i(t,e);m.point(n[0],n[1])}function u(){v.point=s,m.lineStart()}function c(){v.point=a,m.lineEnd()}function l(t,e){g.push([t,e]);var n=i(t,e);w.point(n[0],n[1])}function f(){w.lineStart(),g=[]}function h(){l(g[0][0],g[0][1]),w.lineEnd();var t,e=w.clean(),n=b.buffer(),r=n.length;if(g.pop(),p.push(g),g=null,r)if(1&e){t=n[0];var i,r=t.length-1,a=-1;if(r>0){for(x||(o.polygonStart(),x=!0),o.lineStart();++a<r;)o.point((i=t[a])[0],i[1]);o.lineEnd()}}else r>1&&2&e&&n.push(n.pop().concat(n.shift())),d.push(n.filter(Ne))}var d,p,g,m=e(o),y=i.invert(r[0],r[1]),v={point:a,lineStart:u,lineEnd:c,polygonStart:function(){v.point=l,v.lineStart=f,v.lineEnd=h,d=[],p=[]},polygonEnd:function(){v.point=a,v.lineStart=u,v.lineEnd=c,d=ra.merge(d);var t=Pe(y,p);d.length?(x||(o.polygonStart(),x=!0),Oe(d,je,t,n,o)):t&&(x||(o.polygonStart(),x=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),x&&(o.polygonEnd(),x=!1),d=p=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}},b=Le(),w=e(b),x=!1;return v}}function Ne(t){return t.length>1}function Le(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:M,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function je(t,e){return((t=t.x)[0]<0?t[1]-ja-Ra:ja-t[1])-((e=e.x)[0]<0?e[1]-ja-Ra:ja-e[1])}function Fe(t){var e,n=0/0,r=0/0,i=0/0;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var s=o>0?Ua:-Ua,u=ga(o-n);ga(u-Ua)<Ra?(t.point(n,r=(r+a)/2>0?ja:-ja),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),t.point(o,r),e=0):i!==s&&u>=Ua&&(ga(n-i)<Ra&&(n-=i*Ra),ga(o-s)<Ra&&(o-=s*Ra),r=Ie(n,r,o,a),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),e=0),t.point(n=o,r=a),i=s},lineEnd:function(){t.lineEnd(),n=r=0/0},clean:function(){return 2-e}}}function Ie(t,e,n,r){var i,o,a=Math.sin(t-n);return ga(a)>Ra?Math.atan((Math.sin(e)*(o=Math.cos(r))*Math.sin(n)-Math.sin(r)*(i=Math.cos(e))*Math.sin(t))/(i*o*a)):(e+r)/2}function Be(t,e,n,r){var i;if(null==t)i=n*ja,r.point(-Ua,i),r.point(0,i),r.point(Ua,i),r.point(Ua,0),r.point(Ua,-i),r.point(0,-i),r.point(-Ua,-i),r.point(-Ua,0),r.point(-Ua,i);else if(ga(t[0]-e[0])>Ra){var o=t[0]<e[0]?Ua:-Ua;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])}function Pe(t,e){var n=t[0],r=t[1],i=[Math.sin(n),-Math.cos(n),0],o=0,a=0;ws.reset();for(var s=0,u=e.length;u>s;++s){var c=e[s],l=c.length;if(l)for(var f=c[0],h=f[0],d=f[1]/2+Ua/4,p=Math.sin(d),g=Math.cos(d),m=1;;){m===l&&(m=0),t=c[m];var y=t[0],v=t[1]/2+Ua/4,b=Math.sin(v),w=Math.cos(v),x=y-h,M=x>=0?1:-1,_=M*x,S=_>Ua,E=p*b;if(ws.add(Math.atan2(E*M*Math.sin(_),g*w+E*Math.cos(_))),o+=S?x+M*Na:x,S^h>=n^y>=n){var C=ye(ge(f),ge(t));we(C);var A=ye(i,C);we(A);var k=(S^x>=0?-1:1)*nt(A[2]);(r>k||r===k&&(C[0]||C[1]))&&(a+=S^x>=0?1:-1)}if(!m++)break;h=y,p=b,g=w,f=t}}return(-Ra>o||Ra>o&&0>ws)^1&a}function ze(t){function e(t,e){return Math.cos(t)*Math.cos(e)>o}function n(t){var n,o,u,c,l;return{lineStart:function(){c=u=!1,l=1},point:function(f,h){var d,p=[f,h],g=e(f,h),m=a?g?0:i(f,h):g?i(f+(0>f?Ua:-Ua),h):0;if(!n&&(c=u=g)&&t.lineStart(),g!==u&&(d=r(n,p),(Me(n,d)||Me(p,d))&&(p[0]+=Ra,p[1]+=Ra,g=e(p[0],p[1]))),g!==u)l=0,g?(t.lineStart(),d=r(p,n),t.point(d[0],d[1])):(d=r(n,p),t.point(d[0],d[1]),t.lineEnd()),n=d;else if(s&&n&&a^g){var y;m&o||!(y=r(p,n,!0))||(l=0,a?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1])))}!g||n&&Me(n,p)||t.point(p[0],p[1]),n=p,u=g,o=m},lineEnd:function(){u&&t.lineEnd(),n=null},clean:function(){return l|(c&&u)<<1}}}function r(t,e,n){var r=ge(t),i=ge(e),a=[1,0,0],s=ye(r,i),u=me(s,s),c=s[0],l=u-c*c;if(!l)return!n&&t;var f=o*u/l,h=-o*c/l,d=ye(a,s),p=be(a,f),g=be(s,h);ve(p,g);var m=d,y=me(p,m),v=me(m,m),b=y*y-v*(me(p,p)-1);if(!(0>b)){var w=Math.sqrt(b),x=be(m,(-y-w)/v);if(ve(x,p),x=xe(x),!n)return x;var M,_=t[0],S=e[0],E=t[1],C=e[1];_>S&&(M=_,_=S,S=M);var A=S-_,k=ga(A-Ua)<Ra,T=k||Ra>A;if(!k&&E>C&&(M=E,E=C,C=M),T?k?E+C>0^x[1]<(ga(x[0]-_)<Ra?E:C):E<=x[1]&&x[1]<=C:A>Ua^(_<=x[0]&&x[0]<=S)){var O=be(m,(-y+w)/v);return ve(O,p),[x,xe(O)]}}}function i(e,n){var r=a?t:Ua-t,i=0;return-r>e?i|=1:e>r&&(i|=2),-r>n?i|=4:n>r&&(i|=8),i}var o=Math.cos(t),a=o>0,s=ga(o)>Ra,u=gn(t,6*Fa);return Ue(e,n,u,a?[0,-t]:[-Ua,t-Ua])}function qe(t,e,n,r){return function(i){var o,a=i.a,s=i.b,u=a.x,c=a.y,l=s.x,f=s.y,h=0,d=1,p=l-u,g=f-c;if(o=t-u,p||!(o>0)){if(o/=p,0>p){if(h>o)return;d>o&&(d=o)}else if(p>0){if(o>d)return;o>h&&(h=o)}if(o=n-u,p||!(0>o)){if(o/=p,0>p){if(o>d)return;o>h&&(h=o)}else if(p>0){if(h>o)return;d>o&&(d=o)}if(o=e-c,g||!(o>0)){if(o/=g,0>g){if(h>o)return;d>o&&(d=o)}else if(g>0){if(o>d)return;o>h&&(h=o)}if(o=r-c,g||!(0>o)){if(o/=g,0>g){if(o>d)return;o>h&&(h=o)}else if(g>0){if(h>o)return;d>o&&(d=o)}return h>0&&(i.a={x:u+h*p,y:c+h*g}),1>d&&(i.b={x:u+d*p,y:c+d*g}),i}}}}}}function We(t,e,n,r){function i(r,i){return ga(r[0]-t)<Ra?i>0?0:3:ga(r[0]-n)<Ra?i>0?2:1:ga(r[1]-e)<Ra?i>0?1:0:i>0?3:2}function o(t,e){return a(t.x,e.x)}function a(t,e){var n=i(t,1),r=i(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){function u(t){for(var e=0,n=m.length,r=t[1],i=0;n>i;++i)for(var o,a=1,s=m[i],u=s.length,c=s[0];u>a;++a)o=s[a],c[1]<=r?o[1]>r&&tt(c,o,t)>0&&++e:o[1]<=r&&tt(c,o,t)<0&&--e,c=o;return 0!==e}function c(o,s,u,c){var l=0,f=0;if(null==o||(l=i(o,u))!==(f=i(s,u))||a(o,s)<0^u>0){do c.point(0===l||3===l?t:n,l>1?r:e);while((l=(l+u+4)%4)!==f)}else c.point(s[0],s[1])}function l(i,o){return i>=t&&n>=i&&o>=e&&r>=o}function f(t,e){l(t,e)&&s.point(t,e)}function h(){T.point=p,m&&m.push(y=[]),S=!0,_=!1,x=M=0/0}function d(){g&&(p(v,b),w&&_&&A.rejoin(),g.push(A.buffer())),T.point=f,_&&s.lineEnd()}function p(t,e){t=Math.max(-Ls,Math.min(Ls,t)),e=Math.max(-Ls,Math.min(Ls,e));var n=l(t,e);if(m&&y.push([t,e]),S)v=t,b=e,w=n,S=!1,n&&(s.lineStart(),s.point(t,e));else if(n&&_)s.point(t,e);else{var r={a:{x:x,y:M},b:{x:t,y:e}};k(r)?(_||(s.lineStart(),s.point(r.a.x,r.a.y)),s.point(r.b.x,r.b.y),n||s.lineEnd(),E=!1):n&&(s.lineStart(),s.point(t,e),E=!1)}x=t,M=e,_=n}var g,m,y,v,b,w,x,M,_,S,E,C=s,A=Le(),k=qe(t,e,n,r),T={point:f,lineStart:h,lineEnd:d,polygonStart:function(){s=A,g=[],m=[],E=!0},polygonEnd:function(){s=C,g=ra.merge(g);var e=u([t,r]),n=E&&e,i=g.length;(n||i)&&(s.polygonStart(),n&&(s.lineStart(),c(null,null,1,s),s.lineEnd()),i&&Oe(g,o,e,c,s),s.polygonEnd()),g=m=y=null}};return T}}function Ye(t){var e=0,n=Ua/3,r=sn(t),i=r(e,n);return i.parallels=function(t){return arguments.length?r(e=t[0]*Ua/180,n=t[1]*Ua/180):[e/Ua*180,n/Ua*180]},i}function Je(t,e){function n(t,e){var n=Math.sqrt(o-2*i*Math.sin(e))/i;return[n*Math.sin(t*=i),a-n*Math.cos(t)]}var r=Math.sin(t),i=(r+Math.sin(e))/2,o=1+r*(2*i-r),a=Math.sqrt(o)/i;return n.invert=function(t,e){var n=a-e;return[Math.atan2(t,n)/i,nt((o-(t*t+n*n)*i*i)/(2*i))]},n}function He(){function t(t,e){Fs+=i*t-r*e,r=t,i=e}var e,n,r,i;qs.point=function(o,a){qs.point=t,e=r=o,n=i=a},qs.lineEnd=function(){t(e,n)}}function Ge(t,e){Is>t&&(Is=t),t>Ps&&(Ps=t),Bs>e&&(Bs=e),e>zs&&(zs=e)}function $e(){function t(t,e){a.push("M",t,",",e,o)}function e(t,e){a.push("M",t,",",e),s.point=n}function n(t,e){a.push("L",t,",",e)}function r(){s.point=t}function i(){a.push("Z")}var o=Ve(4.5),a=[],s={point:t,lineStart:function(){s.point=e},lineEnd:r,polygonStart:function(){s.lineEnd=i},polygonEnd:function(){s.lineEnd=r,s.point=t},pointRadius:function(t){return o=Ve(t),s},result:function(){if(a.length){var t=a.join("");return a=[],t}}};return s}function Ve(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Ke(t,e){Ss+=t,Es+=e,++Cs}function Xe(){function t(t,r){var i=t-e,o=r-n,a=Math.sqrt(i*i+o*o);As+=a*(e+t)/2,ks+=a*(n+r)/2,Ts+=a,Ke(e=t,n=r)}var e,n;Ys.point=function(r,i){Ys.point=t,Ke(e=r,n=i)}}function Ze(){Ys.point=Ke}function Qe(){function t(t,e){var n=t-r,o=e-i,a=Math.sqrt(n*n+o*o);As+=a*(r+t)/2,ks+=a*(i+e)/2,Ts+=a,a=i*t-r*e,Os+=a*(r+t),Rs+=a*(i+e),Ds+=3*a,Ke(r=t,i=e)}var e,n,r,i;Ys.point=function(o,a){Ys.point=t,Ke(e=r=o,n=i=a)},Ys.lineEnd=function(){t(e,n)}}function tn(t){function e(e,n){t.moveTo(e+a,n),t.arc(e,n,a,0,Na)}function n(e,n){t.moveTo(e,n),s.point=r}function r(e,n){t.lineTo(e,n)}function i(){s.point=e}function o(){t.closePath()}var a=4.5,s={point:e,lineStart:function(){s.point=n},lineEnd:i,polygonStart:function(){s.lineEnd=o},polygonEnd:function(){s.lineEnd=i,s.point=e},pointRadius:function(t){return a=t,s},result:M};return s}function en(t){function e(t){return(s?r:n)(t)}function n(e){return on(e,function(n,r){n=t(n,r),e.point(n[0],n[1])})}function r(e){function n(n,r){n=t(n,r),e.point(n[0],n[1])}function r(){b=0/0,S.point=o,e.lineStart()}function o(n,r){var o=ge([n,r]),a=t(n,r);i(b,w,v,x,M,_,b=a[0],w=a[1],v=n,x=o[0],M=o[1],_=o[2],s,e),e.point(b,w)}function a(){S.point=n,e.lineEnd()}function u(){r(),S.point=c,S.lineEnd=l}function c(t,e){o(f=t,h=e),d=b,p=w,g=x,m=M,y=_,S.point=o}function l(){i(b,w,v,x,M,_,d,p,f,g,m,y,s,e),S.lineEnd=a,a()}var f,h,d,p,g,m,y,v,b,w,x,M,_,S={point:n,lineStart:r,lineEnd:a,polygonStart:function(){e.polygonStart(),S.lineStart=u},polygonEnd:function(){e.polygonEnd(),S.lineStart=r}};return S}function i(e,n,r,s,u,c,l,f,h,d,p,g,m,y){var v=l-e,b=f-n,w=v*v+b*b;if(w>4*o&&m--){var x=s+d,M=u+p,_=c+g,S=Math.sqrt(x*x+M*M+_*_),E=Math.asin(_/=S),C=ga(ga(_)-1)<Ra||ga(r-h)<Ra?(r+h)/2:Math.atan2(M,x),A=t(C,E),k=A[0],T=A[1],O=k-e,R=T-n,D=b*O-v*R;(D*D/w>o||ga((v*O+b*R)/w-.5)>.3||a>s*d+u*p+c*g)&&(i(e,n,r,s,u,c,k,T,C,x/=S,M/=S,_,m,y),y.point(k,T),i(k,T,C,x,M,_,l,f,h,d,p,g,m,y))}}var o=.5,a=Math.cos(30*Fa),s=16;return e.precision=function(t){return arguments.length?(s=(o=t*t)>0&&16,e):Math.sqrt(o)},e}function nn(t){var e=en(function(e,n){return t([e*Ia,n*Ia])});return function(t){return un(e(t))}}function rn(t){this.stream=t}function on(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function an(t){return sn(function(){return t})()}function sn(t){function e(t){return t=s(t[0]*Fa,t[1]*Fa),[t[0]*h+u,c-t[1]*h]}function n(t){return t=s.invert((t[0]-u)/h,(c-t[1])/h),t&&[t[0]*Ia,t[1]*Ia]}function r(){s=ke(a=fn(y,v,w),o);var t=o(g,m);return u=d-t[0]*h,c=p+t[1]*h,i()}function i(){return l&&(l.valid=!1,l=null),e}var o,a,s,u,c,l,f=en(function(t,e){return t=o(t,e),[t[0]*h+u,c-t[1]*h]}),h=150,d=480,p=250,g=0,m=0,y=0,v=0,w=0,x=Ns,M=b,_=null,S=null;return e.stream=function(t){return l&&(l.valid=!1),l=un(x(a,f(M(t)))),l.valid=!0,l},e.clipAngle=function(t){return arguments.length?(x=null==t?(_=t,Ns):ze((_=+t)*Fa),i()):_},e.clipExtent=function(t){return arguments.length?(S=t,M=t?We(t[0][0],t[0][1],t[1][0],t[1][1]):b,i()):S},e.scale=function(t){return arguments.length?(h=+t,r()):h},e.translate=function(t){return arguments.length?(d=+t[0],p=+t[1],r()):[d,p]},e.center=function(t){return arguments.length?(g=t[0]%360*Fa,m=t[1]%360*Fa,r()):[g*Ia,m*Ia]},e.rotate=function(t){return arguments.length?(y=t[0]%360*Fa,v=t[1]%360*Fa,w=t.length>2?t[2]%360*Fa:0,r()):[y*Ia,v*Ia,w*Ia]},ra.rebind(e,f,"precision"),function(){return o=t.apply(this,arguments),e.invert=o.invert&&n,r()}}function un(t){return on(t,function(e,n){t.point(e*Fa,n*Fa)})}function cn(t,e){return[t,e]}function ln(t,e){return[t>Ua?t-Na:-Ua>t?t+Na:t,e]}function fn(t,e,n){return t?e||n?ke(dn(t),pn(e,n)):dn(t):e||n?pn(e,n):ln}function hn(t){return function(e,n){return e+=t,[e>Ua?e-Na:-Ua>e?e+Na:e,n]}}function dn(t){var e=hn(t);return e.invert=hn(-t),e}function pn(t,e){function n(t,e){var n=Math.cos(e),s=Math.cos(t)*n,u=Math.sin(t)*n,c=Math.sin(e),l=c*r+s*i;return[Math.atan2(u*o-l*a,s*r-c*i),nt(l*o+u*a)]}var r=Math.cos(t),i=Math.sin(t),o=Math.cos(e),a=Math.sin(e);return n.invert=function(t,e){var n=Math.cos(e),s=Math.cos(t)*n,u=Math.sin(t)*n,c=Math.sin(e),l=c*o-u*a;return[Math.atan2(u*o+c*a,s*r+l*i),nt(l*r-s*i)]},n}function gn(t,e){var n=Math.cos(t),r=Math.sin(t);return function(i,o,a,s){var u=a*e;null!=i?(i=mn(n,i),o=mn(n,o),(a>0?o>i:i>o)&&(i+=a*Na)):(i=t+a*Na,o=t-.5*u);for(var c,l=i;a>0?l>o:o>l;l-=u)s.point((c=xe([n,-r*Math.cos(l),-r*Math.sin(l)]))[0],c[1])}}function mn(t,e){var n=ge(e);n[0]-=t,we(n);var r=et(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-Ra)%(2*Math.PI)}function yn(t,e,n){var r=ra.range(t,e-Ra,n).concat(e);return function(t){return r.map(function(e){return[t,e]})}}function vn(t,e,n){var r=ra.range(t,e-Ra,n).concat(e);return function(t){return r.map(function(e){return[e,t]})}}function bn(t){return t.source}function wn(t){return t.target}function xn(t,e,n,r){var i=Math.cos(e),o=Math.sin(e),a=Math.cos(r),s=Math.sin(r),u=i*Math.cos(t),c=i*Math.sin(t),l=a*Math.cos(n),f=a*Math.sin(n),h=2*Math.asin(Math.sqrt(at(r-e)+i*a*at(n-t))),d=1/Math.sin(h),p=h?function(t){var e=Math.sin(t*=h)*d,n=Math.sin(h-t)*d,r=n*u+e*l,i=n*c+e*f,a=n*o+e*s;return[Math.atan2(i,r)*Ia,Math.atan2(a,Math.sqrt(r*r+i*i))*Ia]}:function(){return[t*Ia,e*Ia]};return p.distance=h,p}function Mn(){function t(t,i){var o=Math.sin(i*=Fa),a=Math.cos(i),s=ga((t*=Fa)-e),u=Math.cos(s);Js+=Math.atan2(Math.sqrt((s=a*Math.sin(s))*s+(s=r*o-n*a*u)*s),n*o+r*a*u),e=t,n=o,r=a}var e,n,r;Hs.point=function(i,o){e=i*Fa,n=Math.sin(o*=Fa),r=Math.cos(o),Hs.point=t},Hs.lineEnd=function(){Hs.point=Hs.lineEnd=M}}function _n(t,e){function n(e,n){var r=Math.cos(e),i=Math.cos(n),o=t(r*i);return[o*i*Math.sin(e),o*Math.sin(n)]}return n.invert=function(t,n){var r=Math.sqrt(t*t+n*n),i=e(r),o=Math.sin(i),a=Math.cos(i);return[Math.atan2(t*o,r*a),Math.asin(r&&n*o/r)]},n}function Sn(t,e){function n(t,e){a>0?-ja+Ra>e&&(e=-ja+Ra):e>ja-Ra&&(e=ja-Ra);var n=a/Math.pow(i(e),o);return[n*Math.sin(o*t),a-n*Math.cos(o*t)]}var r=Math.cos(t),i=function(t){return Math.tan(Ua/4+t/2)},o=t===e?Math.sin(t):Math.log(r/Math.cos(e))/Math.log(i(e)/i(t)),a=r*Math.pow(i(t),o)/o;return o?(n.invert=function(t,e){var n=a-e,r=Q(o)*Math.sqrt(t*t+n*n);return[Math.atan2(t,n)/o,2*Math.atan(Math.pow(a/r,1/o))-ja]},n):Cn}function En(t,e){function n(t,e){var n=o-e;return[n*Math.sin(i*t),o-n*Math.cos(i*t)]}var r=Math.cos(t),i=t===e?Math.sin(t):(r-Math.cos(e))/(e-t),o=r/i+t;return ga(i)<Ra?cn:(n.invert=function(t,e){var n=o-e;return[Math.atan2(t,n)/i,o-Q(i)*Math.sqrt(t*t+n*n)]},n)}function Cn(t,e){return[t,Math.log(Math.tan(Ua/4+e/2))]}function An(t){var e,n=an(t),r=n.scale,i=n.translate,o=n.clipExtent;return n.scale=function(){var t=r.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.translate=function(){var t=i.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.clipExtent=function(t){var a=o.apply(n,arguments);if(a===n){if(e=null==t){var s=Ua*r(),u=i();o([[u[0]-s,u[1]-s],[u[0]+s,u[1]+s]])}}else e&&(a=null);return a},n.clipExtent(null)}function kn(t,e){return[Math.log(Math.tan(Ua/4+e/2)),-t]}function Tn(t){return t[0]}function On(t){return t[1]}function Rn(t){for(var e=t.length,n=[0,1],r=2,i=2;e>i;i++){for(;r>1&&tt(t[n[r-2]],t[n[r-1]],t[i])<=0;)--r;n[r++]=i}return n.slice(0,r)}function Dn(t,e){return t[0]-e[0]||t[1]-e[1]}function Un(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function Nn(t,e,n,r){var i=t[0],o=n[0],a=e[0]-i,s=r[0]-o,u=t[1],c=n[1],l=e[1]-u,f=r[1]-c,h=(s*(u-c)-f*(i-o))/(f*a-s*l);return[i+h*a,u+h*l]}function Ln(t){var e=t[0],n=t[t.length-1];return!(e[0]-n[0]||e[1]-n[1])}function jn(){rr(this),this.edge=this.site=this.circle=null}function Fn(t){var e=iu.pop()||new jn;return e.site=t,e}function In(t){$n(t),eu.remove(t),iu.push(t),rr(t)}function Bn(t){var e=t.circle,n=e.x,r=e.cy,i={x:n,y:r},o=t.P,a=t.N,s=[t];In(t);for(var u=o;u.circle&&ga(n-u.circle.x)<Ra&&ga(r-u.circle.cy)<Ra;)o=u.P,s.unshift(u),In(u),u=o;s.unshift(u),$n(u);for(var c=a;c.circle&&ga(n-c.circle.x)<Ra&&ga(r-c.circle.cy)<Ra;)a=c.N,s.push(c),In(c),c=a;s.push(c),$n(c);var l,f=s.length;for(l=1;f>l;++l)c=s[l],u=s[l-1],tr(c.edge,u.site,c.site,i);u=s[0],c=s[f-1],c.edge=Zn(u.site,c.site,null,i),Gn(u),Gn(c)}function Pn(t){for(var e,n,r,i,o=t.x,a=t.y,s=eu._;s;)if(r=zn(s,a)-o,r>Ra)s=s.L;else{if(i=o-qn(s,a),!(i>Ra)){r>-Ra?(e=s.P,n=s):i>-Ra?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}var u=Fn(t);if(eu.insert(e,u),e||n){if(e===n)return $n(e),n=Fn(e.site),eu.insert(u,n),u.edge=n.edge=Zn(e.site,u.site),Gn(e),void Gn(n);if(!n)return void(u.edge=Zn(e.site,u.site));$n(e),$n(n);var c=e.site,l=c.x,f=c.y,h=t.x-l,d=t.y-f,p=n.site,g=p.x-l,m=p.y-f,y=2*(h*m-d*g),v=h*h+d*d,b=g*g+m*m,w={x:(m*v-d*b)/y+l,y:(h*b-g*v)/y+f};tr(n.edge,c,p,w),u.edge=Zn(c,t,null,w),n.edge=Zn(t,p,null,w),Gn(e),Gn(n)}}function zn(t,e){var n=t.site,r=n.x,i=n.y,o=i-e;if(!o)return r;var a=t.P;if(!a)return-(1/0);n=a.site;var s=n.x,u=n.y,c=u-e;if(!c)return s;var l=s-r,f=1/o-1/c,h=l/c;return f?(-h+Math.sqrt(h*h-2*f*(l*l/(-2*c)-u+c/2+i-o/2)))/f+r:(r+s)/2}function qn(t,e){var n=t.N;if(n)return zn(n,e);var r=t.site;return r.y===e?r.x:1/0}function Wn(t){this.site=t,this.edges=[]}function Yn(t){for(var e,n,r,i,o,a,s,u,c,l,f=t[0][0],h=t[1][0],d=t[0][1],p=t[1][1],g=tu,m=g.length;m--;)if(o=g[m],o&&o.prepare())for(s=o.edges,u=s.length,a=0;u>a;)l=s[a].end(),r=l.x,i=l.y,c=s[++a%u].start(),e=c.x,n=c.y,(ga(r-e)>Ra||ga(i-n)>Ra)&&(s.splice(a,0,new er(Qn(o.site,l,ga(r-f)<Ra&&p-i>Ra?{x:f,y:ga(e-f)<Ra?n:p}:ga(i-p)<Ra&&h-r>Ra?{x:ga(n-p)<Ra?e:h,y:p}:ga(r-h)<Ra&&i-d>Ra?{x:h,y:ga(e-h)<Ra?n:d}:ga(i-d)<Ra&&r-f>Ra?{x:ga(n-d)<Ra?e:f,y:d}:null),o.site,null)),++u)}function Jn(t,e){return e.angle-t.angle}function Hn(){rr(this),this.x=this.y=this.arc=this.site=this.cy=null}function Gn(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var a=i.x,s=i.y,u=r.x-a,c=r.y-s,l=o.x-a,f=o.y-s,h=2*(u*f-c*l);if(!(h>=-Da)){var d=u*u+c*c,p=l*l+f*f,g=(f*d-c*p)/h,m=(u*p-l*d)/h,f=m+s,y=ou.pop()||new Hn;y.arc=t,y.site=i,y.x=g+a,y.y=f+Math.sqrt(g*g+m*m),y.cy=f,t.circle=y;for(var v=null,b=ru._;b;)if(y.y<b.y||y.y===b.y&&y.x<=b.x){if(!b.L){v=b.P;break}b=b.L}else{if(!b.R){v=b;break}b=b.R}ru.insert(v,y),v||(nu=y)}}}}function $n(t){var e=t.circle;e&&(e.P||(nu=e.N),ru.remove(e),ou.push(e),rr(e),t.circle=null)}function Vn(t){for(var e,n=Qs,r=qe(t[0][0],t[0][1],t[1][0],t[1][1]),i=n.length;i--;)e=n[i],(!Kn(e,t)||!r(e)||ga(e.a.x-e.b.x)<Ra&&ga(e.a.y-e.b.y)<Ra)&&(e.a=e.b=null,n.splice(i,1))}function Kn(t,e){var n=t.b;if(n)return!0;var r,i,o=t.a,a=e[0][0],s=e[1][0],u=e[0][1],c=e[1][1],l=t.l,f=t.r,h=l.x,d=l.y,p=f.x,g=f.y,m=(h+p)/2,y=(d+g)/2;if(g===d){if(a>m||m>=s)return;if(h>p){if(o){if(o.y>=c)return}else o={x:m,y:u};n={x:m,y:c}}else{if(o){if(o.y<u)return}else o={x:m,y:c};n={x:m,y:u}}}else if(r=(h-p)/(g-d),i=y-r*m,-1>r||r>1)if(h>p){if(o){if(o.y>=c)return}else o={x:(u-i)/r,y:u};n={x:(c-i)/r,y:c}}else{if(o){if(o.y<u)return}else o={x:(c-i)/r,y:c};n={x:(u-i)/r,y:u}}else if(g>d){if(o){if(o.x>=s)return}else o={x:a,y:r*a+i};n={x:s,y:r*s+i}}else{if(o){if(o.x<a)return}else o={x:s,y:r*s+i};n={x:a,y:r*a+i}}return t.a=o,t.b=n,!0}function Xn(t,e){this.l=t,this.r=e,this.a=this.b=null}function Zn(t,e,n,r){var i=new Xn(t,e);return Qs.push(i),n&&tr(i,t,e,n),r&&tr(i,e,t,r),tu[t.i].edges.push(new er(i,t,e)),tu[e.i].edges.push(new er(i,e,t)),i}function Qn(t,e,n){var r=new Xn(t,null);return r.a=e,r.b=n,Qs.push(r),r}function tr(t,e,n,r){t.a||t.b?t.l===n?t.b=r:t.a=r:(t.a=r,t.l=e,t.r=n)}function er(t,e,n){var r=t.a,i=t.b;this.edge=t,this.site=e,this.angle=n?Math.atan2(n.y-e.y,n.x-e.x):t.l===e?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function nr(){this._=null}function rr(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function ir(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function or(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function ar(t){for(;t.L;)t=t.L;return t}function sr(t,e){var n,r,i,o=t.sort(ur).pop();for(Qs=[],tu=new Array(t.length),eu=new nr,ru=new nr;;)if(i=nu,o&&(!i||o.y<i.y||o.y===i.y&&o.x<i.x))(o.x!==n||o.y!==r)&&(tu[o.i]=new Wn(o),Pn(o),n=o.x,r=o.y),o=t.pop();else{if(!i)break;Bn(i.arc)}e&&(Vn(e),Yn(e));var a={cells:tu,edges:Qs};return eu=ru=Qs=tu=null,a}function ur(t,e){return e.y-t.y||e.x-t.x}function cr(t,e,n){return(t.x-n.x)*(e.y-t.y)-(t.x-e.x)*(n.y-t.y)}function lr(t){return t.x}function fr(t){return t.y}function hr(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function dr(t,e,n,r,i,o){if(!t(e,n,r,i,o)){var a=.5*(n+i),s=.5*(r+o),u=e.nodes;u[0]&&dr(t,u[0],n,r,a,s),u[1]&&dr(t,u[1],a,r,i,s),u[2]&&dr(t,u[2],n,s,a,o),u[3]&&dr(t,u[3],a,s,i,o)}}function pr(t,e,n,r,i,o,a){var s,u=1/0;return function c(t,l,f,h,d){if(!(l>o||f>a||r>h||i>d)){if(p=t.point){var p,g=e-t.x,m=n-t.y,y=g*g+m*m;if(u>y){var v=Math.sqrt(u=y);r=e-v,i=n-v,o=e+v,a=n+v,s=p}}for(var b=t.nodes,w=.5*(l+h),x=.5*(f+d),M=e>=w,_=n>=x,S=_<<1|M,E=S+4;E>S;++S)if(t=b[3&S])switch(3&S){case 0:c(t,l,f,w,x);break;case 1:c(t,w,f,h,x);break;case 2:c(t,l,x,w,d);break;case 3:c(t,w,x,h,d)}}}(t,r,i,o,a),s}function gr(t,e){t=ra.rgb(t),e=ra.rgb(e);var n=t.r,r=t.g,i=t.b,o=e.r-n,a=e.g-r,s=e.b-i;return function(t){return"#"+xt(Math.round(n+o*t))+xt(Math.round(r+a*t))+xt(Math.round(i+s*t))}}function mr(t,e){var n,r={},i={};for(n in t)n in e?r[n]=br(t[n],e[n]):i[n]=t[n];for(n in e)n in t||(i[n]=e[n]);return function(t){for(n in r)i[n]=r[n](t);return i}}function yr(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function vr(t,e){var n,r,i,o=su.lastIndex=uu.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=su.exec(t))&&(r=uu.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:yr(n,r)})),o=uu.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?(e=u[0].x,function(t){return e(t)+"";

}):function(){return e}:(e=u.length,function(t){for(var n,r=0;e>r;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function br(t,e){for(var n,r=ra.interpolators.length;--r>=0&&!(n=ra.interpolators[r](t,e)););return n}function wr(t,e){var n,r=[],i=[],o=t.length,a=e.length,s=Math.min(t.length,e.length);for(n=0;s>n;++n)r.push(br(t[n],e[n]));for(;o>n;++n)i[n]=t[n];for(;a>n;++n)i[n]=e[n];return function(t){for(n=0;s>n;++n)i[n]=r[n](t);return i}}function xr(t){return function(e){return 0>=e?0:e>=1?1:t(e)}}function Mr(t){return function(e){return 1-t(1-e)}}function _r(t){return function(e){return.5*(.5>e?t(2*e):2-t(2-2*e))}}function Sr(t){return t*t}function Er(t){return t*t*t}function Cr(t){if(0>=t)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(.5>t?n:3*(t-e)+n-.75)}function Ar(t){return function(e){return Math.pow(e,t)}}function kr(t){return 1-Math.cos(t*ja)}function Tr(t){return Math.pow(2,10*(t-1))}function Or(t){return 1-Math.sqrt(1-t*t)}function Rr(t,e){var n;return arguments.length<2&&(e=.45),arguments.length?n=e/Na*Math.asin(1/t):(t=1,n=e/4),function(r){return 1+t*Math.pow(2,-10*r)*Math.sin((r-n)*Na/e)}}function Dr(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function Ur(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Nr(t,e){t=ra.hcl(t),e=ra.hcl(e);var n=t.h,r=t.c,i=t.l,o=e.h-n,a=e.c-r,s=e.l-i;return isNaN(a)&&(a=0,r=isNaN(r)?e.c:r),isNaN(o)?(o=0,n=isNaN(n)?e.h:n):o>180?o-=360:-180>o&&(o+=360),function(t){return ft(n+o*t,r+a*t,i+s*t)+""}}function Lr(t,e){t=ra.hsl(t),e=ra.hsl(e);var n=t.h,r=t.s,i=t.l,o=e.h-n,a=e.s-r,s=e.l-i;return isNaN(a)&&(a=0,r=isNaN(r)?e.s:r),isNaN(o)?(o=0,n=isNaN(n)?e.h:n):o>180?o-=360:-180>o&&(o+=360),function(t){return ct(n+o*t,r+a*t,i+s*t)+""}}function jr(t,e){t=ra.lab(t),e=ra.lab(e);var n=t.l,r=t.a,i=t.b,o=e.l-n,a=e.a-r,s=e.b-i;return function(t){return dt(n+o*t,r+a*t,i+s*t)+""}}function Fr(t,e){return e-=t,function(n){return Math.round(t+e*n)}}function Ir(t){var e=[t.a,t.b],n=[t.c,t.d],r=Pr(e),i=Br(e,n),o=Pr(zr(n,e,-i))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*Ia,this.translate=[t.e,t.f],this.scale=[r,o],this.skew=o?Math.atan2(i,o)*Ia:0}function Br(t,e){return t[0]*e[0]+t[1]*e[1]}function Pr(t){var e=Math.sqrt(Br(t,t));return e&&(t[0]/=e,t[1]/=e),e}function zr(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function qr(t,e){var n,r=[],i=[],o=ra.transform(t),a=ra.transform(e),s=o.translate,u=a.translate,c=o.rotate,l=a.rotate,f=o.skew,h=a.skew,d=o.scale,p=a.scale;return s[0]!=u[0]||s[1]!=u[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:yr(s[0],u[0])},{i:3,x:yr(s[1],u[1])})):r.push(u[0]||u[1]?"translate("+u+")":""),c!=l?(c-l>180?l+=360:l-c>180&&(c+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:yr(c,l)})):l&&r.push(r.pop()+"rotate("+l+")"),f!=h?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:yr(f,h)}):h&&r.push(r.pop()+"skewX("+h+")"),d[0]!=p[0]||d[1]!=p[1]?(n=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:n-4,x:yr(d[0],p[0])},{i:n-2,x:yr(d[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),n=i.length,function(t){for(var e,o=-1;++o<n;)r[(e=i[o]).i]=e.x(t);return r.join("")}}function Wr(t,e){return e=(e-=t=+t)||1/e,function(n){return(n-t)/e}}function Yr(t,e){return e=(e-=t=+t)||1/e,function(n){return Math.max(0,Math.min(1,(n-t)/e))}}function Jr(t){for(var e=t.source,n=t.target,r=Gr(e,n),i=[e];e!==r;)e=e.parent,i.push(e);for(var o=i.length;n!==r;)i.splice(o,0,n),n=n.parent;return i}function Hr(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function Gr(t,e){if(t===e)return t;for(var n=Hr(t),r=Hr(e),i=n.pop(),o=r.pop(),a=null;i===o;)a=i,i=n.pop(),o=r.pop();return a}function $r(t){t.fixed|=2}function Vr(t){t.fixed&=-7}function Kr(t){t.fixed|=4,t.px=t.x,t.py=t.y}function Xr(t){t.fixed&=-5}function Zr(t,e,n){var r=0,i=0;if(t.charge=0,!t.leaf)for(var o,a=t.nodes,s=a.length,u=-1;++u<s;)o=a[u],null!=o&&(Zr(o,e,n),t.charge+=o.charge,r+=o.charge*o.cx,i+=o.charge*o.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var c=e*n[t.point.index];t.charge+=t.pointCharge=c,r+=c*t.point.x,i+=c*t.point.y}t.cx=r/t.charge,t.cy=i/t.charge}function Qr(t,e){return ra.rebind(t,e,"sort","children","value"),t.nodes=t,t.links=oi,t}function ti(t,e){for(var n=[t];null!=(t=n.pop());)if(e(t),(i=t.children)&&(r=i.length))for(var r,i;--r>=0;)n.push(i[r])}function ei(t,e){for(var n=[t],r=[];null!=(t=n.pop());)if(r.push(t),(o=t.children)&&(i=o.length))for(var i,o,a=-1;++a<i;)n.push(o[a]);for(;null!=(t=r.pop());)e(t)}function ni(t){return t.children}function ri(t){return t.value}function ii(t,e){return e.value-t.value}function oi(t){return ra.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function ai(t){return t.x}function si(t){return t.y}function ui(t,e,n){t.y0=e,t.y=n}function ci(t){return ra.range(t.length)}function li(t){for(var e=-1,n=t[0].length,r=[];++e<n;)r[e]=0;return r}function fi(t){for(var e,n=1,r=0,i=t[0][1],o=t.length;o>n;++n)(e=t[n][1])>i&&(r=n,i=e);return r}function hi(t){return t.reduce(di,0)}function di(t,e){return t+e[1]}function pi(t,e){return gi(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function gi(t,e){for(var n=-1,r=+t[0],i=(t[1]-r)/e,o=[];++n<=e;)o[n]=i*n+r;return o}function mi(t){return[ra.min(t),ra.max(t)]}function yi(t,e){return t.value-e.value}function vi(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function bi(t,e){t._pack_next=e,e._pack_prev=t}function wi(t,e){var n=e.x-t.x,r=e.y-t.y,i=t.r+e.r;return.999*i*i>n*n+r*r}function xi(t){function e(t){l=Math.min(t.x-t.r,l),f=Math.max(t.x+t.r,f),h=Math.min(t.y-t.r,h),d=Math.max(t.y+t.r,d)}if((n=t.children)&&(c=n.length)){var n,r,i,o,a,s,u,c,l=1/0,f=-(1/0),h=1/0,d=-(1/0);if(n.forEach(Mi),r=n[0],r.x=-r.r,r.y=0,e(r),c>1&&(i=n[1],i.x=i.r,i.y=0,e(i),c>2))for(o=n[2],Ei(r,i,o),e(o),vi(r,o),r._pack_prev=o,vi(o,i),i=r._pack_next,a=3;c>a;a++){Ei(r,i,o=n[a]);var p=0,g=1,m=1;for(s=i._pack_next;s!==i;s=s._pack_next,g++)if(wi(s,o)){p=1;break}if(1==p)for(u=r._pack_prev;u!==s._pack_prev&&!wi(u,o);u=u._pack_prev,m++);p?(m>g||g==m&&i.r<r.r?bi(r,i=s):bi(r=u,i),a--):(vi(r,o),i=o,e(o))}var y=(l+f)/2,v=(h+d)/2,b=0;for(a=0;c>a;a++)o=n[a],o.x-=y,o.y-=v,b=Math.max(b,o.r+Math.sqrt(o.x*o.x+o.y*o.y));t.r=b,n.forEach(_i)}}function Mi(t){t._pack_next=t._pack_prev=t}function _i(t){delete t._pack_next,delete t._pack_prev}function Si(t,e,n,r){var i=t.children;if(t.x=e+=r*t.x,t.y=n+=r*t.y,t.r*=r,i)for(var o=-1,a=i.length;++o<a;)Si(i[o],e,n,r)}function Ei(t,e,n){var r=t.r+n.r,i=e.x-t.x,o=e.y-t.y;if(r&&(i||o)){var a=e.r+n.r,s=i*i+o*o;a*=a,r*=r;var u=.5+(r-a)/(2*s),c=Math.sqrt(Math.max(0,2*a*(r+s)-(r-=s)*r-a*a))/(2*s);n.x=t.x+u*i+c*o,n.y=t.y+u*o-c*i}else n.x=t.x+r,n.y=t.y}function Ci(t,e){return t.parent==e.parent?1:2}function Ai(t){var e=t.children;return e.length?e[0]:t.t}function ki(t){var e,n=t.children;return(e=n.length)?n[e-1]:t.t}function Ti(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function Oi(t){for(var e,n=0,r=0,i=t.children,o=i.length;--o>=0;)e=i[o],e.z+=n,e.m+=n,n+=e.s+(r+=e.c)}function Ri(t,e,n){return t.a.parent===e.parent?t.a:n}function Di(t){return 1+ra.max(t,function(t){return t.y})}function Ui(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function Ni(t){var e=t.children;return e&&e.length?Ni(e[0]):t}function Li(t){var e,n=t.children;return n&&(e=n.length)?Li(n[e-1]):t}function ji(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function Fi(t,e){var n=t.x+e[3],r=t.y+e[0],i=t.dx-e[1]-e[3],o=t.dy-e[0]-e[2];return 0>i&&(n+=i/2,i=0),0>o&&(r+=o/2,o=0),{x:n,y:r,dx:i,dy:o}}function Ii(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function Bi(t){return t.rangeExtent?t.rangeExtent():Ii(t.range())}function Pi(t,e,n,r){var i=n(t[0],t[1]),o=r(e[0],e[1]);return function(t){return o(i(t))}}function zi(t,e){var n,r=0,i=t.length-1,o=t[r],a=t[i];return o>a&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function qi(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:bu}function Wi(t,e,n,r){var i=[],o=[],a=0,s=Math.min(t.length,e.length)-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<=s;)i.push(n(t[a-1],t[a])),o.push(r(e[a-1],e[a]));return function(e){var n=ra.bisect(t,e,1,s)-1;return o[n](i[n](e))}}function Yi(t,e,n,r){function i(){var i=Math.min(t.length,e.length)>2?Wi:Pi,u=r?Yr:Wr;return a=i(t,e,u,n),s=i(e,t,u,br),o}function o(t){return a(t)}var a,s;return o.invert=function(t){return s(t)},o.domain=function(e){return arguments.length?(t=e.map(Number),i()):t},o.range=function(t){return arguments.length?(e=t,i()):e},o.rangeRound=function(t){return o.range(t).interpolate(Fr)},o.clamp=function(t){return arguments.length?(r=t,i()):r},o.interpolate=function(t){return arguments.length?(n=t,i()):n},o.ticks=function(e){return $i(t,e)},o.tickFormat=function(e,n){return Vi(t,e,n)},o.nice=function(e){return Hi(t,e),i()},o.copy=function(){return Yi(t,e,n,r)},i()}function Ji(t,e){return ra.rebind(t,e,"range","rangeRound","interpolate","clamp")}function Hi(t,e){return zi(t,qi(Gi(t,e)[2]))}function Gi(t,e){null==e&&(e=10);var n=Ii(t),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/e)/Math.LN10)),o=e/r*i;return.15>=o?i*=10:.35>=o?i*=5:.75>=o&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+.5*i,n[2]=i,n}function $i(t,e){return ra.range.apply(ra,Gi(t,e))}function Vi(t,e,n){var r=Gi(t,e);if(n){var i=ss.exec(n);if(i.shift(),"s"===i[8]){var o=ra.formatPrefix(Math.max(ga(r[0]),ga(r[1])));return i[7]||(i[7]="."+Ki(o.scale(r[2]))),i[8]="f",n=ra.format(i.join("")),function(t){return n(o.scale(t))+o.symbol}}i[7]||(i[7]="."+Xi(i[8],r)),n=i.join("")}else n=",."+Ki(r[2])+"f";return ra.format(n)}function Ki(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function Xi(t,e){var n=Ki(e[2]);return t in wu?Math.abs(n-Ki(Math.max(ga(e[0]),ga(e[1]))))+ +("e"!==t):n-2*("%"===t)}function Zi(t,e,n,r){function i(t){return(n?Math.log(0>t?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function o(t){return n?Math.pow(e,t):-Math.pow(e,-t)}function a(e){return t(i(e))}return a.invert=function(e){return o(t.invert(e))},a.domain=function(e){return arguments.length?(n=e[0]>=0,t.domain((r=e.map(Number)).map(i)),a):r},a.base=function(n){return arguments.length?(e=+n,t.domain(r.map(i)),a):e},a.nice=function(){var e=zi(r.map(i),n?Math:Mu);return t.domain(e),r=e.map(o),a},a.ticks=function(){var t=Ii(r),a=[],s=t[0],u=t[1],c=Math.floor(i(s)),l=Math.ceil(i(u)),f=e%1?2:e;if(isFinite(l-c)){if(n){for(;l>c;c++)for(var h=1;f>h;h++)a.push(o(c)*h);a.push(o(c))}else for(a.push(o(c));c++<l;)for(var h=f-1;h>0;h--)a.push(o(c)*h);for(c=0;a[c]<s;c++);for(l=a.length;a[l-1]>u;l--);a=a.slice(c,l)}return a},a.tickFormat=function(t,e){if(!arguments.length)return xu;arguments.length<2?e=xu:"function"!=typeof e&&(e=ra.format(e));var r,s=Math.max(.1,t/a.ticks().length),u=n?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(t){return t/o(u(i(t)+r))<=s?e(t):""}},a.copy=function(){return Zi(t.copy(),e,n,r)},Ji(a,t)}function Qi(t,e,n){function r(e){return t(i(e))}var i=to(e),o=to(1/e);return r.invert=function(e){return o(t.invert(e))},r.domain=function(e){return arguments.length?(t.domain((n=e.map(Number)).map(i)),r):n},r.ticks=function(t){return $i(n,t)},r.tickFormat=function(t,e){return Vi(n,t,e)},r.nice=function(t){return r.domain(Hi(n,t))},r.exponent=function(a){return arguments.length?(i=to(e=a),o=to(1/e),t.domain(n.map(i)),r):e},r.copy=function(){return Qi(t.copy(),e,n)},Ji(r,t)}function to(t){return function(e){return 0>e?-Math.pow(-e,t):Math.pow(e,t)}}function eo(t,e){function n(n){return o[((i.get(n)||("range"===e.t?i.set(n,t.push(n)):0/0))-1)%o.length]}function r(e,n){return ra.range(t.length).map(function(t){return e+n*t})}var i,o,a;return n.domain=function(r){if(!arguments.length)return t;t=[],i=new l;for(var o,a=-1,s=r.length;++a<s;)i.has(o=r[a])||i.set(o,t.push(o));return n[e.t].apply(n,e.a)},n.range=function(t){return arguments.length?(o=t,a=0,e={t:"range",a:arguments},n):o},n.rangePoints=function(i,s){arguments.length<2&&(s=0);var u=i[0],c=i[1],l=t.length<2?(u=(u+c)/2,0):(c-u)/(t.length-1+s);return o=r(u+l*s/2,l),a=0,e={t:"rangePoints",a:arguments},n},n.rangeRoundPoints=function(i,s){arguments.length<2&&(s=0);var u=i[0],c=i[1],l=t.length<2?(u=c=Math.round((u+c)/2),0):(c-u)/(t.length-1+s)|0;return o=r(u+Math.round(l*s/2+(c-u-(t.length-1+s)*l)/2),l),a=0,e={t:"rangeRoundPoints",a:arguments},n},n.rangeBands=function(i,s,u){arguments.length<2&&(s=0),arguments.length<3&&(u=s);var c=i[1]<i[0],l=i[c-0],f=i[1-c],h=(f-l)/(t.length-s+2*u);return o=r(l+h*u,h),c&&o.reverse(),a=h*(1-s),e={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(i,s,u){arguments.length<2&&(s=0),arguments.length<3&&(u=s);var c=i[1]<i[0],l=i[c-0],f=i[1-c],h=Math.floor((f-l)/(t.length-s+2*u));return o=r(l+Math.round((f-l-(t.length-s)*h)/2),h),c&&o.reverse(),a=Math.round(h*(1-s)),e={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return a},n.rangeExtent=function(){return Ii(e.a[0])},n.copy=function(){return eo(t,e)},n.domain(t)}function no(t,e){function n(){var n=0,r=e.length;for(s=[];++n<r;)s[n-1]=ra.quantile(t,n/r);return a}function a(t){return isNaN(t=+t)?void 0:e[ra.bisect(s,t)]}var s;return a.domain=function(e){return arguments.length?(t=e.map(i).filter(o).sort(r),n()):t},a.range=function(t){return arguments.length?(e=t,n()):e},a.quantiles=function(){return s},a.invertExtent=function(n){return n=e.indexOf(n),0>n?[0/0,0/0]:[n>0?s[n-1]:t[0],n<s.length?s[n]:t[t.length-1]]},a.copy=function(){return no(t,e)},n()}function ro(t,e,n){function r(e){return n[Math.max(0,Math.min(a,Math.floor(o*(e-t))))]}function i(){return o=n.length/(e-t),a=n.length-1,r}var o,a;return r.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],i()):[t,e]},r.range=function(t){return arguments.length?(n=t,i()):n},r.invertExtent=function(e){return e=n.indexOf(e),e=0>e?0/0:e/o+t,[e,e+1/o]},r.copy=function(){return ro(t,e,n)},i()}function io(t,e){function n(n){return n>=n?e[ra.bisect(t,n)]:void 0}return n.domain=function(e){return arguments.length?(t=e,n):t},n.range=function(t){return arguments.length?(e=t,n):e},n.invertExtent=function(n){return n=e.indexOf(n),[t[n-1],t[n]]},n.copy=function(){return io(t,e)},n}function oo(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return $i(t,e)},e.tickFormat=function(e,n){return Vi(t,e,n)},e.copy=function(){return oo(t)},e}function ao(){return 0}function so(t){return t.innerRadius}function uo(t){return t.outerRadius}function co(t){return t.startAngle}function lo(t){return t.endAngle}function fo(t){return t&&t.padAngle}function ho(t,e,n,r){return(t-n)*e-(e-r)*t>0?0:1}function po(t,e,n,r,i){var o=t[0]-e[0],a=t[1]-e[1],s=(i?r:-r)/Math.sqrt(o*o+a*a),u=s*a,c=-s*o,l=t[0]+u,f=t[1]+c,h=e[0]+u,d=e[1]+c,p=(l+h)/2,g=(f+d)/2,m=h-l,y=d-f,v=m*m+y*y,b=n-r,w=l*d-h*f,x=(0>y?-1:1)*Math.sqrt(b*b*v-w*w),M=(w*y-m*x)/v,_=(-w*m-y*x)/v,S=(w*y+m*x)/v,E=(-w*m+y*x)/v,C=M-p,A=_-g,k=S-p,T=E-g;return C*C+A*A>k*k+T*T&&(M=S,_=E),[[M-u,_-c],[M*n/b,_*n/b]]}function go(t){function e(e){function a(){c.push("M",o(t(l),s))}for(var u,c=[],l=[],f=-1,h=e.length,d=At(n),p=At(r);++f<h;)i.call(this,u=e[f],f)?l.push([+d.call(this,u,f),+p.call(this,u,f)]):l.length&&(a(),l=[]);return l.length&&a(),c.length?c.join(""):null}var n=Tn,r=On,i=Te,o=mo,a=o.key,s=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(r=t,e):r},e.defined=function(t){return arguments.length?(i=t,e):i},e.interpolate=function(t){return arguments.length?(a="function"==typeof t?o=t:(o=ku.get(t)||mo).key,e):a},e.tension=function(t){return arguments.length?(s=t,e):s},e}function mo(t){return t.join("L")}function yo(t){return mo(t)+"Z"}function vo(t){for(var e=0,n=t.length,r=t[0],i=[r[0],",",r[1]];++e<n;)i.push("H",(r[0]+(r=t[e])[0])/2,"V",r[1]);return n>1&&i.push("H",r[0]),i.join("")}function bo(t){for(var e=0,n=t.length,r=t[0],i=[r[0],",",r[1]];++e<n;)i.push("V",(r=t[e])[1],"H",r[0]);return i.join("")}function wo(t){for(var e=0,n=t.length,r=t[0],i=[r[0],",",r[1]];++e<n;)i.push("H",(r=t[e])[0],"V",r[1]);return i.join("")}function xo(t,e){return t.length<4?mo(t):t[1]+So(t.slice(1,-1),Eo(t,e))}function Mo(t,e){return t.length<3?mo(t):t[0]+So((t.push(t[0]),t),Eo([t[t.length-2]].concat(t,[t[1]]),e))}function _o(t,e){return t.length<3?mo(t):t[0]+So(t,Eo(t,e))}function So(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return mo(t);var n=t.length!=e.length,r="",i=t[0],o=t[1],a=e[0],s=a,u=1;if(n&&(r+="Q"+(o[0]-2*a[0]/3)+","+(o[1]-2*a[1]/3)+","+o[0]+","+o[1],i=t[1],u=2),e.length>1){s=e[1],o=t[u],u++,r+="C"+(i[0]+a[0])+","+(i[1]+a[1])+","+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1];for(var c=2;c<e.length;c++,u++)o=t[u],s=e[c],r+="S"+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1]}if(n){var l=t[u];r+="Q"+(o[0]+2*s[0]/3)+","+(o[1]+2*s[1]/3)+","+l[0]+","+l[1]}return r}function Eo(t,e){for(var n,r=[],i=(1-e)/2,o=t[0],a=t[1],s=1,u=t.length;++s<u;)n=o,o=a,a=t[s],r.push([i*(a[0]-n[0]),i*(a[1]-n[1])]);return r}function Co(t){if(t.length<3)return mo(t);var e=1,n=t.length,r=t[0],i=r[0],o=r[1],a=[i,i,i,(r=t[1])[0]],s=[o,o,o,r[1]],u=[i,",",o,"L",Oo(Ru,a),",",Oo(Ru,s)];for(t.push(t[n-1]);++e<=n;)r=t[e],a.shift(),a.push(r[0]),s.shift(),s.push(r[1]),Ro(u,a,s);return t.pop(),u.push("L",r),u.join("")}function Ao(t){if(t.length<4)return mo(t);for(var e,n=[],r=-1,i=t.length,o=[0],a=[0];++r<3;)e=t[r],o.push(e[0]),a.push(e[1]);for(n.push(Oo(Ru,o)+","+Oo(Ru,a)),--r;++r<i;)e=t[r],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),Ro(n,o,a);return n.join("")}function ko(t){for(var e,n,r=-1,i=t.length,o=i+4,a=[],s=[];++r<4;)n=t[r%i],a.push(n[0]),s.push(n[1]);for(e=[Oo(Ru,a),",",Oo(Ru,s)],--r;++r<o;)n=t[r%i],a.shift(),a.push(n[0]),s.shift(),s.push(n[1]),Ro(e,a,s);return e.join("")}function To(t,e){var n=t.length-1;if(n)for(var r,i,o=t[0][0],a=t[0][1],s=t[n][0]-o,u=t[n][1]-a,c=-1;++c<=n;)r=t[c],i=c/n,r[0]=e*r[0]+(1-e)*(o+i*s),r[1]=e*r[1]+(1-e)*(a+i*u);return Co(t)}function Oo(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Ro(t,e,n){t.push("C",Oo(Tu,e),",",Oo(Tu,n),",",Oo(Ou,e),",",Oo(Ou,n),",",Oo(Ru,e),",",Oo(Ru,n))}function Do(t,e){return(e[1]-t[1])/(e[0]-t[0])}function Uo(t){for(var e=0,n=t.length-1,r=[],i=t[0],o=t[1],a=r[0]=Do(i,o);++e<n;)r[e]=(a+(a=Do(i=o,o=t[e+1])))/2;return r[e]=a,r}function No(t){for(var e,n,r,i,o=[],a=Uo(t),s=-1,u=t.length-1;++s<u;)e=Do(t[s],t[s+1]),ga(e)<Ra?a[s]=a[s+1]=0:(n=a[s]/e,r=a[s+1]/e,i=n*n+r*r,i>9&&(i=3*e/Math.sqrt(i),a[s]=i*n,a[s+1]=i*r));for(s=-1;++s<=u;)i=(t[Math.min(u,s+1)][0]-t[Math.max(0,s-1)][0])/(6*(1+a[s]*a[s])),o.push([i||0,a[s]*i||0]);return o}function Lo(t){return t.length<3?mo(t):t[0]+So(t,No(t))}function jo(t){for(var e,n,r,i=-1,o=t.length;++i<o;)e=t[i],n=e[0],r=e[1]-ja,e[0]=n*Math.cos(r),e[1]=n*Math.sin(r);return t}function Fo(t){function e(e){function u(){g.push("M",s(t(y),f),l,c(t(m.reverse()),f),"Z")}for(var h,d,p,g=[],m=[],y=[],v=-1,b=e.length,w=At(n),x=At(i),M=n===r?function(){return d}:At(r),_=i===o?function(){return p}:At(o);++v<b;)a.call(this,h=e[v],v)?(m.push([d=+w.call(this,h,v),p=+x.call(this,h,v)]),y.push([+M.call(this,h,v),+_.call(this,h,v)])):m.length&&(u(),m=[],y=[]);return m.length&&u(),g.length?g.join(""):null}var n=Tn,r=Tn,i=0,o=On,a=Te,s=mo,u=s.key,c=s,l="L",f=.7;return e.x=function(t){return arguments.length?(n=r=t,e):r},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(r=t,e):r},e.y=function(t){return arguments.length?(i=o=t,e):o},e.y0=function(t){return arguments.length?(i=t,e):i},e.y1=function(t){return arguments.length?(o=t,e):o},e.defined=function(t){return arguments.length?(a=t,e):a},e.interpolate=function(t){return arguments.length?(u="function"==typeof t?s=t:(s=ku.get(t)||mo).key,c=s.reverse||s,l=s.closed?"M":"L",e):u},e.tension=function(t){return arguments.length?(f=t,e):f},e}function Io(t){return t.radius}function Bo(t){return[t.x,t.y]}function Po(t){return function(){var e=t.apply(this,arguments),n=e[0],r=e[1]-ja;return[n*Math.cos(r),n*Math.sin(r)]}}function zo(){return 64}function qo(){return"circle"}function Wo(t){var e=Math.sqrt(t/Ua);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function Yo(t){return function(){var e,n;(e=this[t])&&(n=e[e.active])&&(--e.count?delete e[e.active]:delete this[t],e.active+=.5,n.event&&n.event.interrupt.call(this,this.__data__,n.index))}}function Jo(t,e,n){return wa(t,Iu),t.namespace=e,t.id=n,t}function Ho(t,e,n,r){var i=t.id,o=t.namespace;return Y(t,"function"==typeof n?function(t,a,s){t[o][i].tween.set(e,r(n.call(t,t.__data__,a,s)))}:(n=r(n),function(t){t[o][i].tween.set(e,n)}))}function Go(t){return null==t&&(t=""),function(){this.textContent=t}}function $o(t){return null==t?"__transition__":"__transition_"+t+"__"}function Vo(t,e,n,r,i){var o=t[n]||(t[n]={active:0,count:0}),a=o[r];if(!a){var s=i.time;a=o[r]={tween:new l,time:s,delay:i.delay,duration:i.duration,ease:i.ease,index:e},i=null,++o.count,ra.timer(function(i){function u(n){if(o.active>r)return l();var i=o[o.active];i&&(--o.count,delete o[o.active],i.event&&i.event.interrupt.call(t,t.__data__,i.index)),o.active=r,a.event&&a.event.start.call(t,t.__data__,e),a.tween.forEach(function(n,r){(r=r.call(t,t.__data__,e))&&g.push(r)}),h=a.ease,f=a.duration,ra.timer(function(){return p.c=c(n||1)?Te:c,1},0,s)}function c(n){if(o.active!==r)return 1;for(var i=n/f,s=h(i),u=g.length;u>0;)g[--u].call(t,s);return i>=1?(a.event&&a.event.end.call(t,t.__data__,e),l()):void 0}function l(){return--o.count?delete o[r]:delete t[n],1}var f,h,d=a.delay,p=is,g=[];return p.t=d+s,i>=d?u(i-d):void(p.c=u)},0,s)}}function Ko(t,e,n){t.attr("transform",function(t){var r=e(t);return"translate("+(isFinite(r)?r:n(t))+",0)"})}function Xo(t,e,n){t.attr("transform",function(t){var r=e(t);return"translate(0,"+(isFinite(r)?r:n(t))+")"})}function Zo(t){return t.toISOString()}function Qo(t,e,n){function r(e){return t(e)}function i(t,n){var r=t[1]-t[0],i=r/n,o=ra.bisect(Gu,i);return o==Gu.length?[e.year,Gi(t.map(function(t){return t/31536e6}),n)[2]]:o?e[i/Gu[o-1]<Gu[o]/i?o-1:o]:[Ku,Gi(t,n)[2]]}return r.invert=function(e){return ta(t.invert(e))},r.domain=function(e){return arguments.length?(t.domain(e),r):t.domain().map(ta)},r.nice=function(t,e){function n(n){return!isNaN(n)&&!t.range(n,ta(+n+1),e).length}var o=r.domain(),a=Ii(o),s=null==t?i(a,10):"number"==typeof t&&i(a,t);return s&&(t=s[0],e=s[1]),r.domain(zi(o,e>1?{floor:function(e){for(;n(e=t.floor(e));)e=ta(e-1);return e},ceil:function(e){for(;n(e=t.ceil(e));)e=ta(+e+1);return e}}:t))},r.ticks=function(t,e){var n=Ii(r.domain()),o=null==t?i(n,10):"number"==typeof t?i(n,t):!t.range&&[{range:t},e];return o&&(t=o[0],e=o[1]),t.range(n[0],ta(+n[1]+1),1>e?1:e)},r.tickFormat=function(){return n},r.copy=function(){return Qo(t.copy(),e,n)},Ji(r,t)}function ta(t){return new Date(t)}function ea(t){return JSON.parse(t.responseText)}function na(t){var e=aa.createRange();return e.selectNode(aa.body),e.createContextualFragment(t.responseText)}var ra={version:"3.5.6"},ia=[].slice,oa=function(t){return ia.call(t)},aa=this.document;if(aa)try{oa(aa.documentElement.childNodes)[0].nodeType}catch(sa){oa=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}if(Date.now||(Date.now=function(){return+new Date}),aa)try{aa.createElement("DIV").style.setProperty("opacity",0,"")}catch(ua){var ca=this.Element.prototype,la=ca.setAttribute,fa=ca.setAttributeNS,ha=this.CSSStyleDeclaration.prototype,da=ha.setProperty;ca.setAttribute=function(t,e){la.call(this,t,e+"")},ca.setAttributeNS=function(t,e,n){fa.call(this,t,e,n+"")},ha.setProperty=function(t,e,n){da.call(this,t,e+"",n)}}ra.ascending=r,ra.descending=function(t,e){return t>e?-1:e>t?1:e>=t?0:0/0},ra.min=function(t,e){var n,r,i=-1,o=t.length;if(1===arguments.length){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&n>r&&(n=r)}else{for(;++i<o;)if(null!=(r=e.call(t,t[i],i))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e.call(t,t[i],i))&&n>r&&(n=r)}return n},ra.max=function(t,e){var n,r,i=-1,o=t.length;if(1===arguments.length){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&r>n&&(n=r)}else{for(;++i<o;)if(null!=(r=e.call(t,t[i],i))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e.call(t,t[i],i))&&r>n&&(n=r)}return n},ra.extent=function(t,e){var n,r,i,o=-1,a=t.length;if(1===arguments.length){for(;++o<a;)if(null!=(r=t[o])&&r>=r){n=i=r;break}for(;++o<a;)null!=(r=t[o])&&(n>r&&(n=r),r>i&&(i=r))}else{for(;++o<a;)if(null!=(r=e.call(t,t[o],o))&&r>=r){n=i=r;break}for(;++o<a;)null!=(r=e.call(t,t[o],o))&&(n>r&&(n=r),r>i&&(i=r))}return[n,i]},ra.sum=function(t,e){var n,r=0,i=t.length,a=-1;if(1===arguments.length)for(;++a<i;)o(n=+t[a])&&(r+=n);else for(;++a<i;)o(n=+e.call(t,t[a],a))&&(r+=n);return r},ra.mean=function(t,e){var n,r=0,a=t.length,s=-1,u=a;if(1===arguments.length)for(;++s<a;)o(n=i(t[s]))?r+=n:--u;else for(;++s<a;)o(n=i(e.call(t,t[s],s)))?r+=n:--u;return u?r/u:void 0},ra.quantile=function(t,e){var n=(t.length-1)*e+1,r=Math.floor(n),i=+t[r-1],o=n-r;return o?i+o*(t[r]-i):i},ra.median=function(t,e){var n,a=[],s=t.length,u=-1;if(1===arguments.length)for(;++u<s;)o(n=i(t[u]))&&a.push(n);else for(;++u<s;)o(n=i(e.call(t,t[u],u)))&&a.push(n);return a.length?ra.quantile(a.sort(r),.5):void 0},ra.variance=function(t,e){var n,r,a=t.length,s=0,u=0,c=-1,l=0;if(1===arguments.length)for(;++c<a;)o(n=i(t[c]))&&(r=n-s,s+=r/++l,u+=r*(n-s));else for(;++c<a;)o(n=i(e.call(t,t[c],c)))&&(r=n-s,s+=r/++l,u+=r*(n-s));return l>1?u/(l-1):void 0},ra.deviation=function(){var t=ra.variance.apply(this,arguments);return t?Math.sqrt(t):t};var pa=a(r);ra.bisectLeft=pa.left,ra.bisect=ra.bisectRight=pa.right,ra.bisector=function(t){return a(1===t.length?function(e,n){return r(t(e),n)}:t)},ra.shuffle=function(t,e,n){(o=arguments.length)<3&&(n=t.length,2>o&&(e=0));for(var r,i,o=n-e;o;)i=Math.random()*o--|0,r=t[o+e],t[o+e]=t[i+e],t[i+e]=r;return t},ra.permute=function(t,e){for(var n=e.length,r=new Array(n);n--;)r[n]=t[e[n]];return r},ra.pairs=function(t){for(var e,n=0,r=t.length-1,i=t[0],o=new Array(0>r?0:r);r>n;)o[n]=[e=i,i=t[++n]];return o},ra.zip=function(){if(!(r=arguments.length))return[];for(var t=-1,e=ra.min(arguments,s),n=new Array(e);++t<e;)for(var r,i=-1,o=n[t]=new Array(r);++i<r;)o[i]=arguments[i][t];return n},ra.transpose=function(t){return ra.zip.apply(ra,t)},ra.keys=function(t){var e=[];for(var n in t)e.push(n);return e},ra.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},ra.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},ra.merge=function(t){for(var e,n,r,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(n=new Array(a);--i>=0;)for(r=t[i],e=r.length;--e>=0;)n[--a]=r[e];return n};var ga=Math.abs;ra.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n===1/0)throw new Error("infinite range");var r,i=[],o=u(ga(n)),a=-1;if(t*=o,e*=o,n*=o,0>n)for(;(r=t+n*++a)>e;)i.push(r/o);else for(;(r=t+n*++a)<e;)i.push(r/o);return i},ra.map=function(t,e){var n=new l;if(t instanceof l)t.forEach(function(t,e){n.set(t,e)});else if(Array.isArray(t)){var r,i=-1,o=t.length;if(1===arguments.length)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e.call(t,r=t[i],i),r)}else for(var a in t)n.set(a,t[a]);return n};var ma="__proto__",ya="\x00";c(l,{has:d,get:function(t){return this._[f(t)]},set:function(t,e){return this._[f(t)]=e},remove:p,keys:g,values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:h(e),value:this._[e]});return t},size:m,empty:y,forEach:function(t){for(var e in this._)t.call(this,h(e),this._[e])}}),ra.nest=function(){function t(e,a,s){if(s>=o.length)return r?r.call(i,a):n?a.sort(n):a;for(var u,c,f,h,d=-1,p=a.length,g=o[s++],m=new l;++d<p;)(h=m.get(u=g(c=a[d])))?h.push(c):m.set(u,[c]);return e?(c=e(),f=function(n,r){c.set(n,t(e,r,s))}):(c={},f=function(n,r){c[n]=t(e,r,s)}),m.forEach(f),c}function e(t,n){if(n>=o.length)return t;var r=[],i=a[n++];return t.forEach(function(t,i){r.push({key:t,values:e(i,n)})}),i?r.sort(function(t,e){return i(t.key,e.key)}):r}var n,r,i={},o=[],a=[];return i.map=function(e,n){return t(n,e,0)},i.entries=function(n){return e(t(ra.map,n,0),0)},i.key=function(t){return o.push(t),i},i.sortKeys=function(t){return a[o.length-1]=t,i},i.sortValues=function(t){return n=t,i},i.rollup=function(t){return r=t,i},i},ra.set=function(t){var e=new v;if(t)for(var n=0,r=t.length;r>n;++n)e.add(t[n]);return e},c(v,{has:d,add:function(t){return this._[f(t+="")]=!0,t},remove:p,values:g,size:m,empty:y,forEach:function(t){for(var e in this._)t.call(this,h(e))}}),ra.behavior={},ra.rebind=function(t,e){for(var n,r=1,i=arguments.length;++r<i;)t[n=arguments[r]]=w(t,e,e[n]);return t};var va=["webkit","ms","moz","Moz","o","O"];ra.dispatch=function(){for(var t=new _,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=S(t);return t},_.prototype.on=function(t,e){var n=t.indexOf("."),r="";if(n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),t)return arguments.length<2?this[t].on(r):this[t].on(r,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(r,null);return this}},ra.event=null,ra.requote=function(t){return t.replace(ba,"\\$&")};var ba=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,wa={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]},xa=function(t,e){return e.querySelector(t)},Ma=function(t,e){return e.querySelectorAll(t)},_a=function(t,e){var n=t.matches||t[x(t,"matchesSelector")];return(_a=function(t,e){return n.call(t,e)})(t,e)};"function"==typeof Sizzle&&(xa=function(t,e){return Sizzle(t,e)[0]||null},Ma=Sizzle,_a=Sizzle.matchesSelector),ra.selection=function(){return ra.select(aa.documentElement)};var Sa=ra.selection.prototype=[];Sa.select=function(t){var e,n,r,i,o=[];t=T(t);for(var a=-1,s=this.length;++a<s;){o.push(e=[]),e.parentNode=(r=this[a]).parentNode;for(var u=-1,c=r.length;++u<c;)(i=r[u])?(e.push(n=t.call(i,i.__data__,u,a)),n&&"__data__"in i&&(n.__data__=i.__data__)):e.push(null)}return k(o)},Sa.selectAll=function(t){var e,n,r=[];t=O(t);for(var i=-1,o=this.length;++i<o;)for(var a=this[i],s=-1,u=a.length;++s<u;)(n=a[s])&&(r.push(e=oa(t.call(n,n.__data__,s,i))),e.parentNode=n);return k(r)};var Ea={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ra.ns={prefix:Ea,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&(n=t.slice(0,e),t=t.slice(e+1)),Ea.hasOwnProperty(n)?{space:Ea[n],local:t}:t}},Sa.attr=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node();return t=ra.ns.qualify(t),t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}for(e in t)this.each(R(e,t[e]));return this}return this.each(R(t,e))},Sa.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),r=(t=N(t)).length,i=-1;if(e=n.classList){for(;++i<r;)if(!e.contains(t[i]))return!1}else for(e=n.getAttribute("class");++i<r;)if(!U(t[i]).test(e))return!1;return!0}for(e in t)this.each(L(e,t[e]));return this}return this.each(L(t,e))},Sa.style=function(t,e,r){var i=arguments.length;if(3>i){if("string"!=typeof t){2>i&&(e="");for(r in t)this.each(F(r,t[r],e));return this}if(2>i){var o=this.node();return n(o).getComputedStyle(o,null).getPropertyValue(t)}r=""}return this.each(F(t,e,r))},Sa.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(I(e,t[e]));return this}return this.each(I(t,e))},Sa.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent;

},Sa.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},Sa.append=function(t){return t=B(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},Sa.insert=function(t,e){return t=B(t),e=T(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},Sa.remove=function(){return this.each(P)},Sa.data=function(t,e){function n(t,n){var r,i,o,a=t.length,f=n.length,h=Math.min(a,f),d=new Array(f),p=new Array(f),g=new Array(a);if(e){var m,y=new l,v=new Array(a);for(r=-1;++r<a;)y.has(m=e.call(i=t[r],i.__data__,r))?g[r]=i:y.set(m,i),v[r]=m;for(r=-1;++r<f;)(i=y.get(m=e.call(n,o=n[r],r)))?i!==!0&&(d[r]=i,i.__data__=o):p[r]=z(o),y.set(m,!0);for(r=-1;++r<a;)y.get(v[r])!==!0&&(g[r]=t[r])}else{for(r=-1;++r<h;)i=t[r],o=n[r],i?(i.__data__=o,d[r]=i):p[r]=z(o);for(;f>r;++r)p[r]=z(n[r]);for(;a>r;++r)g[r]=t[r]}p.update=d,p.parentNode=d.parentNode=g.parentNode=t.parentNode,s.push(p),u.push(d),c.push(g)}var r,i,o=-1,a=this.length;if(!arguments.length){for(t=new Array(a=(r=this[0]).length);++o<a;)(i=r[o])&&(t[o]=i.__data__);return t}var s=J([]),u=k([]),c=k([]);if("function"==typeof t)for(;++o<a;)n(r=this[o],t.call(r,r.parentNode.__data__,o));else for(;++o<a;)n(r=this[o],t);return u.enter=function(){return s},u.exit=function(){return c},u},Sa.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},Sa.filter=function(t){var e,n,r,i=[];"function"!=typeof t&&(t=q(t));for(var o=0,a=this.length;a>o;o++){i.push(e=[]),e.parentNode=(n=this[o]).parentNode;for(var s=0,u=n.length;u>s;s++)(r=n[s])&&t.call(r,r.__data__,s,o)&&e.push(r)}return k(i)},Sa.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,r=this[t],i=r.length-1,o=r[i];--i>=0;)(n=r[i])&&(o&&o!==n.nextSibling&&o.parentNode.insertBefore(n,o),o=n);return this},Sa.sort=function(t){t=W.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},Sa.each=function(t){return Y(this,function(e,n,r){t.call(e,e.__data__,n,r)})},Sa.call=function(t){var e=oa(arguments);return t.apply(e[0]=this,e),this},Sa.empty=function(){return!this.node()},Sa.node=function(){for(var t=0,e=this.length;e>t;t++)for(var n=this[t],r=0,i=n.length;i>r;r++){var o=n[r];if(o)return o}return null},Sa.size=function(){var t=0;return Y(this,function(){++t}),t};var Ca=[];ra.selection.enter=J,ra.selection.enter.prototype=Ca,Ca.append=Sa.append,Ca.empty=Sa.empty,Ca.node=Sa.node,Ca.call=Sa.call,Ca.size=Sa.size,Ca.select=function(t){for(var e,n,r,i,o,a=[],s=-1,u=this.length;++s<u;){r=(i=this[s]).update,a.push(e=[]),e.parentNode=i.parentNode;for(var c=-1,l=i.length;++c<l;)(o=i[c])?(e.push(r[c]=n=t.call(i.parentNode,o.__data__,c,s)),n.__data__=o.__data__):e.push(null)}return k(a)},Ca.insert=function(t,e){return arguments.length<2&&(e=H(this)),Sa.insert.call(this,t,e)},ra.select=function(e){var n;return"string"==typeof e?(n=[xa(e,aa)],n.parentNode=aa.documentElement):(n=[e],n.parentNode=t(e)),k([n])},ra.selectAll=function(t){var e;return"string"==typeof t?(e=oa(Ma(t,aa)),e.parentNode=aa.documentElement):(e=t,e.parentNode=null),k([e])},Sa.on=function(t,e,n){var r=arguments.length;if(3>r){if("string"!=typeof t){2>r&&(e=!1);for(n in t)this.each(G(n,t[n],e));return this}if(2>r)return(r=this.node()["__on"+t])&&r._;n=!1}return this.each(G(t,e,n))};var Aa=ra.map({mouseenter:"mouseover",mouseleave:"mouseout"});aa&&Aa.forEach(function(t){"on"+t in aa&&Aa.remove(t)});var ka,Ta=0;ra.mouse=function(t){return X(t,C())};var Oa=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;ra.touch=function(t,e,n){if(arguments.length<3&&(n=e,e=C().changedTouches),e)for(var r,i=0,o=e.length;o>i;++i)if((r=e[i]).identifier===n)return X(t,r)},ra.behavior.drag=function(){function t(){this.on("mousedown.drag",o).on("touchstart.drag",a)}function e(t,e,n,o,a){return function(){function s(){var t,n,r=e(h,g);r&&(t=r[0]-b[0],n=r[1]-b[1],p|=t|n,b=r,d({type:"drag",x:r[0]+c[0],y:r[1]+c[1],dx:t,dy:n}))}function u(){e(h,g)&&(y.on(o+m,null).on(a+m,null),v(p&&ra.event.target===f),d({type:"dragend"}))}var c,l=this,f=ra.event.target,h=l.parentNode,d=r.of(l,arguments),p=0,g=t(),m=".drag"+(null==g?"":"-"+g),y=ra.select(n(f)).on(o+m,s).on(a+m,u),v=K(f),b=e(h,g);i?(c=i.apply(l,arguments),c=[c.x-b[0],c.y-b[1]]):c=[0,0],d({type:"dragstart"})}}var r=A(t,"drag","dragstart","dragend"),i=null,o=e(M,ra.mouse,n,"mousemove","mouseup"),a=e(Z,ra.touch,b,"touchmove","touchend");return t.origin=function(e){return arguments.length?(i=e,t):i},ra.rebind(t,r,"on")},ra.touches=function(t,e){return arguments.length<2&&(e=C().touches),e?oa(e).map(function(e){var n=X(t,e);return n.identifier=e.identifier,n}):[]};var Ra=1e-6,Da=Ra*Ra,Ua=Math.PI,Na=2*Ua,La=Na-Ra,ja=Ua/2,Fa=Ua/180,Ia=180/Ua,Ba=Math.SQRT2,Pa=2,za=4;ra.interpolateZoom=function(t,e){function n(t){var e=t*v;if(y){var n=it(g),a=o/(Pa*h)*(n*ot(Ba*e+g)-rt(g));return[r+a*c,i+a*l,o*n/it(Ba*e+g)]}return[r+t*c,i+t*l,o*Math.exp(Ba*e)]}var r=t[0],i=t[1],o=t[2],a=e[0],s=e[1],u=e[2],c=a-r,l=s-i,f=c*c+l*l,h=Math.sqrt(f),d=(u*u-o*o+za*f)/(2*o*Pa*h),p=(u*u-o*o-za*f)/(2*u*Pa*h),g=Math.log(Math.sqrt(d*d+1)-d),m=Math.log(Math.sqrt(p*p+1)-p),y=m-g,v=(y||Math.log(u/o))/Ba;return n.duration=1e3*v,n},ra.behavior.zoom=function(){function t(t){t.on(R,f).on(Wa+".zoom",d).on("dblclick.zoom",p).on(N,h)}function e(t){return[(t[0]-S.x)/S.k,(t[1]-S.y)/S.k]}function r(t){return[t[0]*S.k+S.x,t[1]*S.k+S.y]}function i(t){S.k=Math.max(k[0],Math.min(k[1],t))}function o(t,e){e=r(e),S.x+=t[0]-e[0],S.y+=t[1]-e[1]}function a(e,n,r,a){e.__chart__={x:S.x,y:S.y,k:S.k},i(Math.pow(2,a)),o(m=n,r),e=ra.select(e),T>0&&(e=e.transition().duration(T)),e.call(t.event)}function s(){x&&x.domain(w.range().map(function(t){return(t-S.x)/S.k}).map(w.invert)),_&&_.domain(M.range().map(function(t){return(t-S.y)/S.k}).map(M.invert))}function u(t){O++||t({type:"zoomstart"})}function c(t){s(),t({type:"zoom",scale:S.k,translate:[S.x,S.y]})}function l(t){--O||(t({type:"zoomend"}),m=null)}function f(){function t(){f=1,o(ra.mouse(i),d),c(s)}function r(){h.on(D,null).on(U,null),p(f&&ra.event.target===a),l(s)}var i=this,a=ra.event.target,s=L.of(i,arguments),f=0,h=ra.select(n(i)).on(D,t).on(U,r),d=e(ra.mouse(i)),p=K(i);Fu.call(i),u(s)}function h(){function t(){var t=ra.touches(p);return d=S.k,t.forEach(function(t){t.identifier in m&&(m[t.identifier]=e(t))}),t}function n(){var e=ra.event.target;ra.select(e).on(w,r).on(x,s),M.push(e);for(var n=ra.event.changedTouches,i=0,o=n.length;o>i;++i)m[n[i].identifier]=null;var u=t(),c=Date.now();if(1===u.length){if(500>c-b){var l=u[0];a(p,l,m[l.identifier],Math.floor(Math.log(S.k)/Math.LN2)+1),E()}b=c}else if(u.length>1){var l=u[0],f=u[1],h=l[0]-f[0],d=l[1]-f[1];y=h*h+d*d}}function r(){var t,e,n,r,a=ra.touches(p);Fu.call(p);for(var s=0,u=a.length;u>s;++s,r=null)if(n=a[s],r=m[n.identifier]){if(e)break;t=n,e=r}if(r){var l=(l=n[0]-t[0])*l+(l=n[1]-t[1])*l,f=y&&Math.sqrt(l/y);t=[(t[0]+n[0])/2,(t[1]+n[1])/2],e=[(e[0]+r[0])/2,(e[1]+r[1])/2],i(f*d)}b=null,o(t,e),c(g)}function s(){if(ra.event.touches.length){for(var e=ra.event.changedTouches,n=0,r=e.length;r>n;++n)delete m[e[n].identifier];for(var i in m)return void t()}ra.selectAll(M).on(v,null),_.on(R,f).on(N,h),C(),l(g)}var d,p=this,g=L.of(p,arguments),m={},y=0,v=".zoom-"+ra.event.changedTouches[0].identifier,w="touchmove"+v,x="touchend"+v,M=[],_=ra.select(p),C=K(p);n(),u(g),_.on(R,null).on(N,n)}function d(){var t=L.of(this,arguments);v?clearTimeout(v):(Fu.call(this),g=e(m=y||ra.mouse(this)),u(t)),v=setTimeout(function(){v=null,l(t)},50),E(),i(Math.pow(2,.002*qa())*S.k),o(m,g),c(t)}function p(){var t=ra.mouse(this),n=Math.log(S.k)/Math.LN2;a(this,t,e(t),ra.event.shiftKey?Math.ceil(n)-1:Math.floor(n)+1)}var g,m,y,v,b,w,x,M,_,S={x:0,y:0,k:1},C=[960,500],k=Ya,T=250,O=0,R="mousedown.zoom",D="mousemove.zoom",U="mouseup.zoom",N="touchstart.zoom",L=A(t,"zoomstart","zoom","zoomend");return Wa||(Wa="onwheel"in aa?(qa=function(){return-ra.event.deltaY*(ra.event.deltaMode?120:1)},"wheel"):"onmousewheel"in aa?(qa=function(){return ra.event.wheelDelta},"mousewheel"):(qa=function(){return-ra.event.detail},"MozMousePixelScroll")),t.event=function(t){t.each(function(){var t=L.of(this,arguments),e=S;Lu?ra.select(this).transition().each("start.zoom",function(){S=this.__chart__||{x:0,y:0,k:1},u(t)}).tween("zoom:zoom",function(){var n=C[0],r=C[1],i=m?m[0]:n/2,o=m?m[1]:r/2,a=ra.interpolateZoom([(i-S.x)/S.k,(o-S.y)/S.k,n/S.k],[(i-e.x)/e.k,(o-e.y)/e.k,n/e.k]);return function(e){var r=a(e),s=n/r[2];this.__chart__=S={x:i-r[0]*s,y:o-r[1]*s,k:s},c(t)}}).each("interrupt.zoom",function(){l(t)}).each("end.zoom",function(){l(t)}):(this.__chart__=S,u(t),c(t),l(t))})},t.translate=function(e){return arguments.length?(S={x:+e[0],y:+e[1],k:S.k},s(),t):[S.x,S.y]},t.scale=function(e){return arguments.length?(S={x:S.x,y:S.y,k:+e},s(),t):S.k},t.scaleExtent=function(e){return arguments.length?(k=null==e?Ya:[+e[0],+e[1]],t):k},t.center=function(e){return arguments.length?(y=e&&[+e[0],+e[1]],t):y},t.size=function(e){return arguments.length?(C=e&&[+e[0],+e[1]],t):C},t.duration=function(e){return arguments.length?(T=+e,t):T},t.x=function(e){return arguments.length?(x=e,w=e.copy(),S={x:0,y:0,k:1},t):x},t.y=function(e){return arguments.length?(_=e,M=e.copy(),S={x:0,y:0,k:1},t):_},ra.rebind(t,L,"on")};var qa,Wa,Ya=[0,1/0];ra.color=st,st.prototype.toString=function(){return this.rgb()+""},ra.hsl=ut;var Ja=ut.prototype=new st;Ja.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new ut(this.h,this.s,this.l/t)},Ja.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new ut(this.h,this.s,t*this.l)},Ja.rgb=function(){return ct(this.h,this.s,this.l)},ra.hcl=lt;var Ha=lt.prototype=new st;Ha.brighter=function(t){return new lt(this.h,this.c,Math.min(100,this.l+Ga*(arguments.length?t:1)))},Ha.darker=function(t){return new lt(this.h,this.c,Math.max(0,this.l-Ga*(arguments.length?t:1)))},Ha.rgb=function(){return ft(this.h,this.c,this.l).rgb()},ra.lab=ht;var Ga=18,$a=.95047,Va=1,Ka=1.08883,Xa=ht.prototype=new st;Xa.brighter=function(t){return new ht(Math.min(100,this.l+Ga*(arguments.length?t:1)),this.a,this.b)},Xa.darker=function(t){return new ht(Math.max(0,this.l-Ga*(arguments.length?t:1)),this.a,this.b)},Xa.rgb=function(){return dt(this.l,this.a,this.b)},ra.rgb=vt;var Za=vt.prototype=new st;Za.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,r=this.b,i=30;return e||n||r?(e&&i>e&&(e=i),n&&i>n&&(n=i),r&&i>r&&(r=i),new vt(Math.min(255,e/t),Math.min(255,n/t),Math.min(255,r/t))):new vt(i,i,i)},Za.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new vt(t*this.r,t*this.g,t*this.b)},Za.hsl=function(){return _t(this.r,this.g,this.b)},Za.toString=function(){return"#"+xt(this.r)+xt(this.g)+xt(this.b)};var Qa=ra.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Qa.forEach(function(t,e){Qa.set(t,bt(e))}),ra.functor=At,ra.xhr=kt(b),ra.dsv=function(t,e){function n(t,n,o){arguments.length<3&&(o=n,n=null);var a=Tt(t,e,null==n?r:i(n),o);return a.row=function(t){return arguments.length?a.response(null==(n=t)?r:i(t)):n},a}function r(t){return n.parse(t.responseText)}function i(t){return function(e){return n.parse(e.responseText,t)}}function o(e){return e.map(a).join(t)}function a(t){return s.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var s=new RegExp('["'+t+"\n]"),u=t.charCodeAt(0);return n.parse=function(t,e){var r;return n.parseRows(t,function(t,n){if(r)return r(t,n-1);var i=new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}");r=e?function(t,n){return e(i(t),n)}:i})},n.parseRows=function(t,e){function n(){if(l>=c)return a;if(i)return i=!1,o;var e=l;if(34===t.charCodeAt(e)){for(var n=e;n++<c;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;++n}l=n+2;var r=t.charCodeAt(n+1);return 13===r?(i=!0,10===t.charCodeAt(n+2)&&++l):10===r&&(i=!0),t.slice(e+1,n).replace(/""/g,'"')}for(;c>l;){var r=t.charCodeAt(l++),s=1;if(10===r)i=!0;else if(13===r)i=!0,10===t.charCodeAt(l)&&(++l,++s);else if(r!==u)continue;return t.slice(e,l-s)}return t.slice(e)}for(var r,i,o={},a={},s=[],c=t.length,l=0,f=0;(r=n())!==a;){for(var h=[];r!==o&&r!==a;)h.push(r),r=n();e&&null==(h=e(h,f++))||s.push(h)}return s},n.format=function(e){if(Array.isArray(e[0]))return n.formatRows(e);var r=new v,i=[];return e.forEach(function(t){for(var e in t)r.has(e)||i.push(r.add(e))}),[i.map(a).join(t)].concat(e.map(function(e){return i.map(function(t){return a(e[t])}).join(t)})).join("\n")},n.formatRows=function(t){return t.map(o).join("\n")},n},ra.csv=ra.dsv(",","text/csv"),ra.tsv=ra.dsv("	","text/tab-separated-values");var ts,es,ns,rs,is,os=this[x(this,"requestAnimationFrame")]||function(t){setTimeout(t,17)};ra.timer=function(t,e,n){var r=arguments.length;2>r&&(e=0),3>r&&(n=Date.now());var i=n+e,o={c:t,t:i,f:!1,n:null};es?es.n=o:ts=o,es=o,ns||(rs=clearTimeout(rs),ns=1,os(Dt))},ra.timer.flush=function(){Ut(),Nt()},ra.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var as=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(jt);ra.formatPrefix=function(t,e){var n=0;return t&&(0>t&&(t*=-1),e&&(t=ra.round(t,Lt(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),as[8+n/3]};var ss=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,us=ra.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=ra.round(t,Lt(t,e))).toFixed(Math.max(0,Math.min(20,Lt(t*(1+1e-15),e))))}}),cs=ra.time={},ls=Date;Bt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){fs.setUTCDate.apply(this._,arguments)},setDay:function(){fs.setUTCDay.apply(this._,arguments)},setFullYear:function(){fs.setUTCFullYear.apply(this._,arguments)},setHours:function(){fs.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){fs.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){fs.setUTCMinutes.apply(this._,arguments)},setMonth:function(){fs.setUTCMonth.apply(this._,arguments)},setSeconds:function(){fs.setUTCSeconds.apply(this._,arguments)},setTime:function(){fs.setTime.apply(this._,arguments)}};var fs=Date.prototype;cs.year=Pt(function(t){return t=cs.day(t),t.setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),cs.years=cs.year.range,cs.years.utc=cs.year.utc.range,cs.day=Pt(function(t){var e=new ls(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),cs.days=cs.day.range,cs.days.utc=cs.day.utc.range,cs.dayOfYear=function(t){var e=cs.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,e){e=7-e;var n=cs[t]=Pt(function(t){return(t=cs.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=cs.year(t).getDay();return Math.floor((cs.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});cs[t+"s"]=n.range,cs[t+"s"].utc=n.utc.range,cs[t+"OfYear"]=function(t){var n=cs.year(t).getDay();return Math.floor((cs.dayOfYear(t)+(n+e)%7)/7)}}),cs.week=cs.sunday,cs.weeks=cs.sunday.range,cs.weeks.utc=cs.sunday.utc.range,cs.weekOfYear=cs.sundayOfYear;var hs={"-":"",_:" ",0:"0"},ds=/^\s*\d+/,ps=/^%/;ra.locale=function(t){return{numberFormat:Ft(t),timeFormat:qt(t)}};var gs=ra.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});ra.format=gs.numberFormat,ra.geo={},ce.prototype={s:0,t:0,add:function(t){le(t,this.t,ms),le(ms.s,this.s,this),this.s?this.t+=ms.t:this.s=ms.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var ms=new ce;ra.geo.stream=function(t,e){t&&ys.hasOwnProperty(t.type)?ys[t.type](t,e):fe(t,e)};var ys={Feature:function(t,e){fe(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)fe(n[r].geometry,e)}},vs={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){he(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)he(n[r],e,0)},Polygon:function(t,e){de(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)de(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)fe(n[r],e)}};ra.geo.area=function(t){return bs=0,ra.geo.stream(t,xs),bs};var bs,ws=new ce,xs={sphere:function(){bs+=4*Ua},point:M,lineStart:M,lineEnd:M,polygonStart:function(){ws.reset(),xs.lineStart=pe},polygonEnd:function(){var t=2*ws;bs+=0>t?4*Ua+t:t,xs.lineStart=xs.lineEnd=xs.point=M}};ra.geo.bounds=function(){function t(t,e){b.push(w=[l=t,h=t]),f>e&&(f=e),e>d&&(d=e)}function e(e,n){var r=ge([e*Fa,n*Fa]);if(y){var i=ye(y,r),o=[i[1],-i[0],0],a=ye(o,i);we(a),a=xe(a);var u=e-p,c=u>0?1:-1,g=a[0]*Ia*c,m=ga(u)>180;if(m^(g>c*p&&c*e>g)){var v=a[1]*Ia;v>d&&(d=v)}else if(g=(g+360)%360-180,m^(g>c*p&&c*e>g)){var v=-a[1]*Ia;f>v&&(f=v)}else f>n&&(f=n),n>d&&(d=n);m?p>e?s(l,e)>s(l,h)&&(h=e):s(e,h)>s(l,h)&&(l=e):h>=l?(l>e&&(l=e),e>h&&(h=e)):e>p?s(l,e)>s(l,h)&&(h=e):s(e,h)>s(l,h)&&(l=e)}else t(e,n);y=r,p=e}function n(){x.point=e}function r(){w[0]=l,w[1]=h,x.point=t,y=null}function i(t,n){if(y){var r=t-p;v+=ga(r)>180?r+(r>0?360:-360):r}else g=t,m=n;xs.point(t,n),e(t,n)}function o(){xs.lineStart()}function a(){i(g,m),xs.lineEnd(),ga(v)>Ra&&(l=-(h=180)),w[0]=l,w[1]=h,y=null}function s(t,e){return(e-=t)<0?e+360:e}function u(t,e){return t[0]-e[0]}function c(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var l,f,h,d,p,g,m,y,v,b,w,x={point:t,lineStart:n,lineEnd:r,polygonStart:function(){x.point=i,x.lineStart=o,x.lineEnd=a,v=0,xs.polygonStart()},polygonEnd:function(){xs.polygonEnd(),x.point=t,x.lineStart=n,x.lineEnd=r,0>ws?(l=-(h=180),f=-(d=90)):v>Ra?d=90:-Ra>v&&(f=-90),w[0]=l,w[1]=h}};return function(t){d=h=-(l=f=1/0),b=[],ra.geo.stream(t,x);var e=b.length;if(e){b.sort(u);for(var n,r=1,i=b[0],o=[i];e>r;++r)n=b[r],c(n[0],i)||c(n[1],i)?(s(i[0],n[1])>s(i[0],i[1])&&(i[1]=n[1]),s(n[0],i[1])>s(i[0],i[1])&&(i[0]=n[0])):o.push(i=n);for(var a,n,p=-(1/0),e=o.length-1,r=0,i=o[e];e>=r;i=n,++r)n=o[r],(a=s(i[1],n[0]))>p&&(p=a,l=n[0],h=i[1])}return b=w=null,l===1/0||f===1/0?[[0/0,0/0],[0/0,0/0]]:[[l,f],[h,d]]}}(),ra.geo.centroid=function(t){Ms=_s=Ss=Es=Cs=As=ks=Ts=Os=Rs=Ds=0,ra.geo.stream(t,Us);var e=Os,n=Rs,r=Ds,i=e*e+n*n+r*r;return Da>i&&(e=As,n=ks,r=Ts,Ra>_s&&(e=Ss,n=Es,r=Cs),i=e*e+n*n+r*r,Da>i)?[0/0,0/0]:[Math.atan2(n,e)*Ia,nt(r/Math.sqrt(i))*Ia]};var Ms,_s,Ss,Es,Cs,As,ks,Ts,Os,Rs,Ds,Us={sphere:M,point:_e,lineStart:Ee,lineEnd:Ce,polygonStart:function(){Us.lineStart=Ae},polygonEnd:function(){Us.lineStart=Ee}},Ns=Ue(Te,Fe,Be,[-Ua,-Ua/2]),Ls=1e9;ra.geo.clipExtent=function(){var t,e,n,r,i,o,a={stream:function(t){return i&&(i.valid=!1),i=o(t),i.valid=!0,i},extent:function(s){return arguments.length?(o=We(t=+s[0][0],e=+s[0][1],n=+s[1][0],r=+s[1][1]),i&&(i.valid=!1,i=null),a):[[t,e],[n,r]]}};return a.extent([[0,0],[960,500]])},(ra.geo.conicEqualArea=function(){return Ye(Je)}).raw=Je,ra.geo.albers=function(){return ra.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ra.geo.albersUsa=function(){function t(t){var o=t[0],a=t[1];return e=null,n(o,a),e||(r(o,a),e)||i(o,a),e}var e,n,r,i,o=ra.geo.albers(),a=ra.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=ra.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(t,n){e=[t,n]}};return t.invert=function(t){var e=o.scale(),n=o.translate(),r=(t[0]-n[0])/e,i=(t[1]-n[1])/e;return(i>=.12&&.234>i&&r>=-.425&&-.214>r?a:i>=.166&&.234>i&&r>=-.214&&-.115>r?s:o).invert(t)},t.stream=function(t){var e=o.stream(t),n=a.stream(t),r=s.stream(t);return{point:function(t,i){e.point(t,i),n.point(t,i),r.point(t,i)},sphere:function(){e.sphere(),n.sphere(),r.sphere()},lineStart:function(){e.lineStart(),n.lineStart(),r.lineStart()},lineEnd:function(){e.lineEnd(),n.lineEnd(),r.lineEnd()},polygonStart:function(){e.polygonStart(),n.polygonStart(),r.polygonStart()},polygonEnd:function(){e.polygonEnd(),n.polygonEnd(),r.polygonEnd()}}},t.precision=function(e){return arguments.length?(o.precision(e),a.precision(e),s.precision(e),t):o.precision()},t.scale=function(e){return arguments.length?(o.scale(e),a.scale(.35*e),s.scale(e),t.translate(o.translate())):o.scale()},t.translate=function(e){if(!arguments.length)return o.translate();var c=o.scale(),l=+e[0],f=+e[1];return n=o.translate(e).clipExtent([[l-.455*c,f-.238*c],[l+.455*c,f+.238*c]]).stream(u).point,r=a.translate([l-.307*c,f+.201*c]).clipExtent([[l-.425*c+Ra,f+.12*c+Ra],[l-.214*c-Ra,f+.234*c-Ra]]).stream(u).point,i=s.translate([l-.205*c,f+.212*c]).clipExtent([[l-.214*c+Ra,f+.166*c+Ra],[l-.115*c-Ra,f+.234*c-Ra]]).stream(u).point,t},t.scale(1070)};var js,Fs,Is,Bs,Ps,zs,qs={point:M,lineStart:M,lineEnd:M,polygonStart:function(){Fs=0,qs.lineStart=He},polygonEnd:function(){qs.lineStart=qs.lineEnd=qs.point=M,js+=ga(Fs/2)}},Ws={point:Ge,lineStart:M,lineEnd:M,polygonStart:M,polygonEnd:M},Ys={point:Ke,lineStart:Xe,lineEnd:Ze,polygonStart:function(){Ys.lineStart=Qe},polygonEnd:function(){Ys.point=Ke,Ys.lineStart=Xe,Ys.lineEnd=Ze}};ra.geo.path=function(){function t(t){return t&&("function"==typeof s&&o.pointRadius(+s.apply(this,arguments)),a&&a.valid||(a=i(o)),ra.geo.stream(t,a)),o.result()}function e(){return a=null,t}var n,r,i,o,a,s=4.5;return t.area=function(t){return js=0,ra.geo.stream(t,i(qs)),js},t.centroid=function(t){return Ss=Es=Cs=As=ks=Ts=Os=Rs=Ds=0,ra.geo.stream(t,i(Ys)),Ds?[Os/Ds,Rs/Ds]:Ts?[As/Ts,ks/Ts]:Cs?[Ss/Cs,Es/Cs]:[0/0,0/0]},t.bounds=function(t){return Ps=zs=-(Is=Bs=1/0),ra.geo.stream(t,i(Ws)),[[Is,Bs],[Ps,zs]]},t.projection=function(t){return arguments.length?(i=(n=t)?t.stream||nn(t):b,e()):n},t.context=function(t){return arguments.length?(o=null==(r=t)?new $e:new tn(t),"function"!=typeof s&&o.pointRadius(s),e()):r},t.pointRadius=function(e){return arguments.length?(s="function"==typeof e?e:(o.pointRadius(+e),+e),t):s},t.projection(ra.geo.albersUsa()).context(null)},ra.geo.transform=function(t){return{stream:function(e){var n=new rn(e);for(var r in t)n[r]=t[r];return n}}},rn.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ra.geo.projection=an,ra.geo.projectionMutator=sn,(ra.geo.equirectangular=function(){return an(cn)}).raw=cn.invert=cn,ra.geo.rotation=function(t){function e(e){return e=t(e[0]*Fa,e[1]*Fa),e[0]*=Ia,e[1]*=Ia,e}return t=fn(t[0]%360*Fa,t[1]*Fa,t.length>2?t[2]*Fa:0),e.invert=function(e){return e=t.invert(e[0]*Fa,e[1]*Fa),e[0]*=Ia,e[1]*=Ia,e},e},ln.invert=cn,ra.geo.circle=function(){function t(){var t="function"==typeof r?r.apply(this,arguments):r,e=fn(-t[0]*Fa,-t[1]*Fa,0).invert,i=[];return n(null,null,1,{point:function(t,n){i.push(t=e(t,n)),t[0]*=Ia,t[1]*=Ia}}),{type:"Polygon",coordinates:[i]}}var e,n,r=[0,0],i=6;return t.origin=function(e){return arguments.length?(r=e,t):r},t.angle=function(r){return arguments.length?(n=gn((e=+r)*Fa,i*Fa),t):e},t.precision=function(r){return arguments.length?(n=gn(e*Fa,(i=+r)*Fa),t):i},t.angle(90)},ra.geo.distance=function(t,e){var n,r=(e[0]-t[0])*Fa,i=t[1]*Fa,o=e[1]*Fa,a=Math.sin(r),s=Math.cos(r),u=Math.sin(i),c=Math.cos(i),l=Math.sin(o),f=Math.cos(o);return Math.atan2(Math.sqrt((n=f*a)*n+(n=c*l-u*f*s)*n),u*l+c*f*s)},ra.geo.graticule=function(){function t(){return{type:"MultiLineString",coordinates:e()}}function e(){return ra.range(Math.ceil(o/m)*m,i,m).map(h).concat(ra.range(Math.ceil(c/y)*y,u,y).map(d)).concat(ra.range(Math.ceil(r/p)*p,n,p).filter(function(t){return ga(t%m)>Ra}).map(l)).concat(ra.range(Math.ceil(s/g)*g,a,g).filter(function(t){return ga(t%y)>Ra}).map(f))}var n,r,i,o,a,s,u,c,l,f,h,d,p=10,g=p,m=90,y=360,v=2.5;return t.lines=function(){return e().map(function(t){return{type:"LineString",coordinates:t}})},t.outline=function(){return{type:"Polygon",coordinates:[h(o).concat(d(u).slice(1),h(i).reverse().slice(1),d(c).reverse().slice(1))]}},t.extent=function(e){return arguments.length?t.majorExtent(e).minorExtent(e):t.minorExtent()},t.majorExtent=function(e){return arguments.length?(o=+e[0][0],i=+e[1][0],c=+e[0][1],u=+e[1][1],o>i&&(e=o,o=i,i=e),c>u&&(e=c,c=u,u=e),t.precision(v)):[[o,c],[i,u]]},t.minorExtent=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],a=+e[1][1],r>n&&(e=r,r=n,n=e),s>a&&(e=s,s=a,a=e),t.precision(v)):[[r,s],[n,a]]},t.step=function(e){return arguments.length?t.majorStep(e).minorStep(e):t.minorStep()},t.majorStep=function(e){return arguments.length?(m=+e[0],y=+e[1],t):[m,y]},t.minorStep=function(e){return arguments.length?(p=+e[0],g=+e[1],t):[p,g]},t.precision=function(e){return arguments.length?(v=+e,l=yn(s,a,90),f=vn(r,n,v),h=yn(c,u,90),d=vn(o,i,v),t):v},t.majorExtent([[-180,-90+Ra],[180,90-Ra]]).minorExtent([[-180,-80-Ra],[180,80+Ra]])},ra.geo.greatArc=function(){function t(){return{type:"LineString",coordinates:[e||r.apply(this,arguments),n||i.apply(this,arguments)]}}var e,n,r=bn,i=wn;return t.distance=function(){return ra.geo.distance(e||r.apply(this,arguments),n||i.apply(this,arguments))},t.source=function(n){return arguments.length?(r=n,e="function"==typeof n?null:n,t):r},t.target=function(e){return arguments.length?(i=e,n="function"==typeof e?null:e,t):i},t.precision=function(){return arguments.length?t:0},t},ra.geo.interpolate=function(t,e){return xn(t[0]*Fa,t[1]*Fa,e[0]*Fa,e[1]*Fa)},ra.geo.length=function(t){return Js=0,ra.geo.stream(t,Hs),Js};var Js,Hs={sphere:M,point:M,lineStart:Mn,lineEnd:M,polygonStart:M,polygonEnd:M},Gs=_n(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});(ra.geo.azimuthalEqualArea=function(){return an(Gs)}).raw=Gs;var $s=_n(function(t){var e=Math.acos(t);return e&&e/Math.sin(e)},b);(ra.geo.azimuthalEquidistant=function(){return an($s)}).raw=$s,(ra.geo.conicConformal=function(){return Ye(Sn)}).raw=Sn,(ra.geo.conicEquidistant=function(){return Ye(En)}).raw=En;var Vs=_n(function(t){return 1/t},Math.atan);(ra.geo.gnomonic=function(){return an(Vs)}).raw=Vs,Cn.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-ja]},(ra.geo.mercator=function(){return An(Cn)}).raw=Cn;var Ks=_n(function(){return 1},Math.asin);(ra.geo.orthographic=function(){return an(Ks)}).raw=Ks;var Xs=_n(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});(ra.geo.stereographic=function(){return an(Xs)}).raw=Xs,kn.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-ja]},(ra.geo.transverseMercator=function(){var t=An(kn),e=t.center,n=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])},t.rotate=function(t){return t?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},n([0,0,90])}).raw=kn,ra.geom={},ra.geom.hull=function(t){function e(t){if(t.length<3)return[];var e,i=At(n),o=At(r),a=t.length,s=[],u=[];for(e=0;a>e;e++)s.push([+i.call(this,t[e],e),+o.call(this,t[e],e),e]);for(s.sort(Dn),e=0;a>e;e++)u.push([s[e][0],-s[e][1]]);var c=Rn(s),l=Rn(u),f=l[0]===c[0],h=l[l.length-1]===c[c.length-1],d=[];for(e=c.length-1;e>=0;--e)d.push(t[s[c[e]][2]]);for(e=+f;e<l.length-h;++e)d.push(t[s[l[e]][2]]);return d}var n=Tn,r=On;return arguments.length?e(t):(e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(r=t,e):r},e)},ra.geom.polygon=function(t){return wa(t,Zs),t};var Zs=ra.geom.polygon.prototype=[];Zs.area=function(){for(var t,e=-1,n=this.length,r=this[n-1],i=0;++e<n;)t=r,r=this[e],i+=t[1]*r[0]-t[0]*r[1];return.5*i},Zs.centroid=function(t){var e,n,r=-1,i=this.length,o=0,a=0,s=this[i-1];for(arguments.length||(t=-1/(6*this.area()));++r<i;)e=s,s=this[r],n=e[0]*s[1]-s[0]*e[1],o+=(e[0]+s[0])*n,
a+=(e[1]+s[1])*n;return[o*t,a*t]},Zs.clip=function(t){for(var e,n,r,i,o,a,s=Ln(t),u=-1,c=this.length-Ln(this),l=this[c-1];++u<c;){for(e=t.slice(),t.length=0,i=this[u],o=e[(r=e.length-s)-1],n=-1;++n<r;)a=e[n],Un(a,l,i)?(Un(o,l,i)||t.push(Nn(o,a,l,i)),t.push(a)):Un(o,l,i)&&t.push(Nn(o,a,l,i)),o=a;s&&t.push(t[0]),l=i}return t};var Qs,tu,eu,nu,ru,iu=[],ou=[];Wn.prototype.prepare=function(){for(var t,e=this.edges,n=e.length;n--;)t=e[n].edge,t.b&&t.a||e.splice(n,1);return e.sort(Jn),e.length},er.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},nr.prototype={insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=ar(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)r=n.U,n===r.L?(i=r.R,i&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(ir(this,n),t=n,n=t.U),n.C=!1,r.C=!0,or(this,r))):(i=r.L,i&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(or(this,n),t=n,n=t.U),n.C=!1,r.C=!0,ir(this,r))),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,a=t.R;if(n=o?a?ar(a):o:a,i?i.L===t?i.L=n:i.R=n:this._=n,o&&a?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==a?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=a,a.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===i.L){if(e=i.R,e.C&&(e.C=!1,i.C=!0,ir(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,or(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,ir(this,i),t=this._;break}}else if(e=i.L,e.C&&(e.C=!1,i.C=!0,or(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,ir(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,or(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}},ra.geom.voronoi=function(t){function e(t){var e=new Array(t.length),r=s[0][0],i=s[0][1],o=s[1][0],a=s[1][1];return sr(n(t),s).cells.forEach(function(n,s){var u=n.edges,c=n.site,l=e[s]=u.length?u.map(function(t){var e=t.start();return[e.x,e.y]}):c.x>=r&&c.x<=o&&c.y>=i&&c.y<=a?[[r,a],[o,a],[o,i],[r,i]]:[];l.point=t[s]}),e}function n(t){return t.map(function(t,e){return{x:Math.round(o(t,e)/Ra)*Ra,y:Math.round(a(t,e)/Ra)*Ra,i:e}})}var r=Tn,i=On,o=r,a=i,s=au;return t?e(t):(e.links=function(t){return sr(n(t)).edges.filter(function(t){return t.l&&t.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},e.triangles=function(t){var e=[];return sr(n(t)).cells.forEach(function(n,r){for(var i,o,a=n.site,s=n.edges.sort(Jn),u=-1,c=s.length,l=s[c-1].edge,f=l.l===a?l.r:l.l;++u<c;)i=l,o=f,l=s[u].edge,f=l.l===a?l.r:l.l,r<o.i&&r<f.i&&cr(a,o,f)<0&&e.push([t[r],t[o.i],t[f.i]])}),e},e.x=function(t){return arguments.length?(o=At(r=t),e):r},e.y=function(t){return arguments.length?(a=At(i=t),e):i},e.clipExtent=function(t){return arguments.length?(s=null==t?au:t,e):s===au?null:s},e.size=function(t){return arguments.length?e.clipExtent(t&&[[0,0],t]):s===au?null:s&&s[1]},e)};var au=[[-1e6,-1e6],[1e6,1e6]];ra.geom.delaunay=function(t){return ra.geom.voronoi().triangles(t)},ra.geom.quadtree=function(t,e,n,r,i){function o(t){function o(t,e,n,r,i,o,a,s){if(!isNaN(n)&&!isNaN(r))if(t.leaf){var u=t.x,l=t.y;if(null!=u)if(ga(u-n)+ga(l-r)<.01)c(t,e,n,r,i,o,a,s);else{var f=t.point;t.x=t.y=t.point=null,c(t,f,u,l,i,o,a,s),c(t,e,n,r,i,o,a,s)}else t.x=n,t.y=r,t.point=e}else c(t,e,n,r,i,o,a,s)}function c(t,e,n,r,i,a,s,u){var c=.5*(i+s),l=.5*(a+u),f=n>=c,h=r>=l,d=h<<1|f;t.leaf=!1,t=t.nodes[d]||(t.nodes[d]=hr()),f?i=c:s=c,h?a=l:u=l,o(t,e,n,r,i,a,s,u)}var l,f,h,d,p,g,m,y,v,b=At(s),w=At(u);if(null!=e)g=e,m=n,y=r,v=i;else if(y=v=-(g=m=1/0),f=[],h=[],p=t.length,a)for(d=0;p>d;++d)l=t[d],l.x<g&&(g=l.x),l.y<m&&(m=l.y),l.x>y&&(y=l.x),l.y>v&&(v=l.y),f.push(l.x),h.push(l.y);else for(d=0;p>d;++d){var x=+b(l=t[d],d),M=+w(l,d);g>x&&(g=x),m>M&&(m=M),x>y&&(y=x),M>v&&(v=M),f.push(x),h.push(M)}var _=y-g,S=v-m;_>S?v=m+_:y=g+S;var E=hr();if(E.add=function(t){o(E,t,+b(t,++d),+w(t,d),g,m,y,v)},E.visit=function(t){dr(t,E,g,m,y,v)},E.find=function(t){return pr(E,t[0],t[1],g,m,y,v)},d=-1,null==e){for(;++d<p;)o(E,t[d],f[d],h[d],g,m,y,v);--d}else t.forEach(E.add);return f=h=t=l=null,E}var a,s=Tn,u=On;return(a=arguments.length)?(s=lr,u=fr,3===a&&(i=n,r=e,n=e=0),o(t)):(o.x=function(t){return arguments.length?(s=t,o):s},o.y=function(t){return arguments.length?(u=t,o):u},o.extent=function(t){return arguments.length?(null==t?e=n=r=i=null:(e=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),o):null==e?null:[[e,n],[r,i]]},o.size=function(t){return arguments.length?(null==t?e=n=r=i=null:(e=n=0,r=+t[0],i=+t[1]),o):null==e?null:[r-e,i-n]},o)},ra.interpolateRgb=gr,ra.interpolateObject=mr,ra.interpolateNumber=yr,ra.interpolateString=vr;var su=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,uu=new RegExp(su.source,"g");ra.interpolate=br,ra.interpolators=[function(t,e){var n=typeof e;return("string"===n?Qa.has(e.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(e)?gr:vr:e instanceof st?gr:Array.isArray(e)?wr:"object"===n&&isNaN(e)?mr:yr)(t,e)}],ra.interpolateArray=wr;var cu=function(){return b},lu=ra.map({linear:cu,poly:Ar,quad:function(){return Sr},cubic:function(){return Er},sin:function(){return kr},exp:function(){return Tr},circle:function(){return Or},elastic:Rr,back:Dr,bounce:function(){return Ur}}),fu=ra.map({"in":b,out:Mr,"in-out":_r,"out-in":function(t){return _r(Mr(t))}});ra.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.slice(0,e):t,r=e>=0?t.slice(e+1):"in";return n=lu.get(n)||cu,r=fu.get(r)||b,xr(r(n.apply(null,ia.call(arguments,1))))},ra.interpolateHcl=Nr,ra.interpolateHsl=Lr,ra.interpolateLab=jr,ra.interpolateRound=Fr,ra.transform=function(t){var e=aa.createElementNS(ra.ns.prefix.svg,"g");return(ra.transform=function(t){if(null!=t){e.setAttribute("transform",t);var n=e.transform.baseVal.consolidate()}return new Ir(n?n.matrix:hu)})(t)},Ir.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var hu={a:1,b:0,c:0,d:1,e:0,f:0};ra.interpolateTransform=qr,ra.layout={},ra.layout.bundle=function(){return function(t){for(var e=[],n=-1,r=t.length;++n<r;)e.push(Jr(t[n]));return e}},ra.layout.chord=function(){function t(){var t,c,f,h,d,p={},g=[],m=ra.range(o),y=[];for(n=[],r=[],t=0,h=-1;++h<o;){for(c=0,d=-1;++d<o;)c+=i[h][d];g.push(c),y.push(ra.range(o)),t+=c}for(a&&m.sort(function(t,e){return a(g[t],g[e])}),s&&y.forEach(function(t,e){t.sort(function(t,n){return s(i[e][t],i[e][n])})}),t=(Na-l*o)/t,c=0,h=-1;++h<o;){for(f=c,d=-1;++d<o;){var v=m[h],b=y[v][d],w=i[v][b],x=c,M=c+=w*t;p[v+"-"+b]={index:v,subindex:b,startAngle:x,endAngle:M,value:w}}r[v]={index:v,startAngle:f,endAngle:c,value:(c-f)/t},c+=l}for(h=-1;++h<o;)for(d=h-1;++d<o;){var _=p[h+"-"+d],S=p[d+"-"+h];(_.value||S.value)&&n.push(_.value<S.value?{source:S,target:_}:{source:_,target:S})}u&&e()}function e(){n.sort(function(t,e){return u((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,r,i,o,a,s,u,c={},l=0;return c.matrix=function(t){return arguments.length?(o=(i=t)&&i.length,n=r=null,c):i},c.padding=function(t){return arguments.length?(l=t,n=r=null,c):l},c.sortGroups=function(t){return arguments.length?(a=t,n=r=null,c):a},c.sortSubgroups=function(t){return arguments.length?(s=t,n=null,c):s},c.sortChords=function(t){return arguments.length?(u=t,n&&e(),c):u},c.chords=function(){return n||t(),n},c.groups=function(){return r||t(),r},c},ra.layout.force=function(){function t(t){return function(e,n,r,i){if(e.point!==t){var o=e.cx-t.x,a=e.cy-t.y,s=i-n,u=o*o+a*a;if(u>s*s/m){if(p>u){var c=e.charge/u;t.px-=o*c,t.py-=a*c}return!0}if(e.point&&u&&p>u){var c=e.pointCharge/u;t.px-=o*c,t.py-=a*c}}return!e.charge}}function e(t){t.px=ra.event.x,t.py=ra.event.y,s.resume()}var n,r,i,o,a,s={},u=ra.dispatch("start","tick","end"),c=[1,1],l=.9,f=du,h=pu,d=-30,p=gu,g=.1,m=.64,y=[],v=[];return s.tick=function(){if((r*=.99)<.005)return u.end({type:"end",alpha:r=0}),!0;var e,n,s,f,h,p,m,b,w,x=y.length,M=v.length;for(n=0;M>n;++n)s=v[n],f=s.source,h=s.target,b=h.x-f.x,w=h.y-f.y,(p=b*b+w*w)&&(p=r*o[n]*((p=Math.sqrt(p))-i[n])/p,b*=p,w*=p,h.x-=b*(m=f.weight/(h.weight+f.weight)),h.y-=w*m,f.x+=b*(m=1-m),f.y+=w*m);if((m=r*g)&&(b=c[0]/2,w=c[1]/2,n=-1,m))for(;++n<x;)s=y[n],s.x+=(b-s.x)*m,s.y+=(w-s.y)*m;if(d)for(Zr(e=ra.geom.quadtree(y),r,a),n=-1;++n<x;)(s=y[n]).fixed||e.visit(t(s));for(n=-1;++n<x;)s=y[n],s.fixed?(s.x=s.px,s.y=s.py):(s.x-=(s.px-(s.px=s.x))*l,s.y-=(s.py-(s.py=s.y))*l);u.tick({type:"tick",alpha:r})},s.nodes=function(t){return arguments.length?(y=t,s):y},s.links=function(t){return arguments.length?(v=t,s):v},s.size=function(t){return arguments.length?(c=t,s):c},s.linkDistance=function(t){return arguments.length?(f="function"==typeof t?t:+t,s):f},s.distance=s.linkDistance,s.linkStrength=function(t){return arguments.length?(h="function"==typeof t?t:+t,s):h},s.friction=function(t){return arguments.length?(l=+t,s):l},s.charge=function(t){return arguments.length?(d="function"==typeof t?t:+t,s):d},s.chargeDistance=function(t){return arguments.length?(p=t*t,s):Math.sqrt(p)},s.gravity=function(t){return arguments.length?(g=+t,s):g},s.theta=function(t){return arguments.length?(m=t*t,s):Math.sqrt(m)},s.alpha=function(t){return arguments.length?(t=+t,r?r=t>0?t:0:t>0&&(u.start({type:"start",alpha:r=t}),ra.timer(s.tick)),s):r},s.start=function(){function t(t,r){if(!n){for(n=new Array(u),s=0;u>s;++s)n[s]=[];for(s=0;l>s;++s){var i=v[s];n[i.source.index].push(i.target),n[i.target.index].push(i.source)}}for(var o,a=n[e],s=-1,c=a.length;++s<c;)if(!isNaN(o=a[s][t]))return o;return Math.random()*r}var e,n,r,u=y.length,l=v.length,p=c[0],g=c[1];for(e=0;u>e;++e)(r=y[e]).index=e,r.weight=0;for(e=0;l>e;++e)r=v[e],"number"==typeof r.source&&(r.source=y[r.source]),"number"==typeof r.target&&(r.target=y[r.target]),++r.source.weight,++r.target.weight;for(e=0;u>e;++e)r=y[e],isNaN(r.x)&&(r.x=t("x",p)),isNaN(r.y)&&(r.y=t("y",g)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(i=[],"function"==typeof f)for(e=0;l>e;++e)i[e]=+f.call(this,v[e],e);else for(e=0;l>e;++e)i[e]=f;if(o=[],"function"==typeof h)for(e=0;l>e;++e)o[e]=+h.call(this,v[e],e);else for(e=0;l>e;++e)o[e]=h;if(a=[],"function"==typeof d)for(e=0;u>e;++e)a[e]=+d.call(this,y[e],e);else for(e=0;u>e;++e)a[e]=d;return s.resume()},s.resume=function(){return s.alpha(.1)},s.stop=function(){return s.alpha(0)},s.drag=function(){return n||(n=ra.behavior.drag().origin(b).on("dragstart.force",$r).on("drag.force",e).on("dragend.force",Vr)),arguments.length?void this.on("mouseover.force",Kr).on("mouseout.force",Xr).call(n):n},ra.rebind(s,u,"on")};var du=20,pu=1,gu=1/0;ra.layout.hierarchy=function(){function t(i){var o,a=[i],s=[];for(i.depth=0;null!=(o=a.pop());)if(s.push(o),(c=n.call(t,o,o.depth))&&(u=c.length)){for(var u,c,l;--u>=0;)a.push(l=c[u]),l.parent=o,l.depth=o.depth+1;r&&(o.value=0),o.children=c}else r&&(o.value=+r.call(t,o,o.depth)||0),delete o.children;return ei(i,function(t){var n,i;e&&(n=t.children)&&n.sort(e),r&&(i=t.parent)&&(i.value+=t.value)}),s}var e=ii,n=ni,r=ri;return t.sort=function(n){return arguments.length?(e=n,t):e},t.children=function(e){return arguments.length?(n=e,t):n},t.value=function(e){return arguments.length?(r=e,t):r},t.revalue=function(e){return r&&(ti(e,function(t){t.children&&(t.value=0)}),ei(e,function(e){var n;e.children||(e.value=+r.call(t,e,e.depth)||0),(n=e.parent)&&(n.value+=e.value)})),e},t},ra.layout.partition=function(){function t(e,n,r,i){var o=e.children;if(e.x=n,e.y=e.depth*i,e.dx=r,e.dy=i,o&&(a=o.length)){var a,s,u,c=-1;for(r=e.value?r/e.value:0;++c<a;)t(s=o[c],n,u=s.value*r,i),n+=u}}function e(t){var n=t.children,r=0;if(n&&(i=n.length))for(var i,o=-1;++o<i;)r=Math.max(r,e(n[o]));return 1+r}function n(n,o){var a=r.call(this,n,o);return t(a[0],0,i[0],i[1]/e(a[0])),a}var r=ra.layout.hierarchy(),i=[1,1];return n.size=function(t){return arguments.length?(i=t,n):i},Qr(n,r)},ra.layout.pie=function(){function t(a){var s,u=a.length,c=a.map(function(n,r){return+e.call(t,n,r)}),l=+("function"==typeof r?r.apply(this,arguments):r),f=("function"==typeof i?i.apply(this,arguments):i)-l,h=Math.min(Math.abs(f)/u,+("function"==typeof o?o.apply(this,arguments):o)),d=h*(0>f?-1:1),p=(f-u*d)/ra.sum(c),g=ra.range(u),m=[];return null!=n&&g.sort(n===mu?function(t,e){return c[e]-c[t]}:function(t,e){return n(a[t],a[e])}),g.forEach(function(t){m[t]={data:a[t],value:s=c[t],startAngle:l,endAngle:l+=s*p+d,padAngle:h}}),m}var e=Number,n=mu,r=0,i=Na,o=0;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(r=e,t):r},t.endAngle=function(e){return arguments.length?(i=e,t):i},t.padAngle=function(e){return arguments.length?(o=e,t):o},t};var mu={};ra.layout.stack=function(){function t(s,u){if(!(h=s.length))return s;var c=s.map(function(n,r){return e.call(t,n,r)}),l=c.map(function(e){return e.map(function(e,n){return[o.call(t,e,n),a.call(t,e,n)]})}),f=n.call(t,l,u);c=ra.permute(c,f),l=ra.permute(l,f);var h,d,p,g,m=r.call(t,l,u),y=c[0].length;for(p=0;y>p;++p)for(i.call(t,c[0][p],g=m[p],l[0][p][1]),d=1;h>d;++d)i.call(t,c[d][p],g+=l[d-1][p][1],l[d][p][1]);return s}var e=b,n=ci,r=li,i=ui,o=ai,a=si;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:yu.get(e)||ci,t):n},t.offset=function(e){return arguments.length?(r="function"==typeof e?e:vu.get(e)||li,t):r},t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(a=e,t):a},t.out=function(e){return arguments.length?(i=e,t):i},t};var yu=ra.map({"inside-out":function(t){var e,n,r=t.length,i=t.map(fi),o=t.map(hi),a=ra.range(r).sort(function(t,e){return i[t]-i[e]}),s=0,u=0,c=[],l=[];for(e=0;r>e;++e)n=a[e],u>s?(s+=o[n],c.push(n)):(u+=o[n],l.push(n));return l.reverse().concat(c)},reverse:function(t){return ra.range(t.length).reverse()},"default":ci}),vu=ra.map({silhouette:function(t){var e,n,r,i=t.length,o=t[0].length,a=[],s=0,u=[];for(n=0;o>n;++n){for(e=0,r=0;i>e;e++)r+=t[e][n][1];r>s&&(s=r),a.push(r)}for(n=0;o>n;++n)u[n]=(s-a[n])/2;return u},wiggle:function(t){var e,n,r,i,o,a,s,u,c,l=t.length,f=t[0],h=f.length,d=[];for(d[0]=u=c=0,n=1;h>n;++n){for(e=0,i=0;l>e;++e)i+=t[e][n][1];for(e=0,o=0,s=f[n][0]-f[n-1][0];l>e;++e){for(r=0,a=(t[e][n][1]-t[e][n-1][1])/(2*s);e>r;++r)a+=(t[r][n][1]-t[r][n-1][1])/s;o+=a*t[e][n][1]}d[n]=u-=i?o/i*s:0,c>u&&(c=u)}for(n=0;h>n;++n)d[n]-=c;return d},expand:function(t){var e,n,r,i=t.length,o=t[0].length,a=1/i,s=[];for(n=0;o>n;++n){for(e=0,r=0;i>e;e++)r+=t[e][n][1];if(r)for(e=0;i>e;e++)t[e][n][1]/=r;else for(e=0;i>e;e++)t[e][n][1]=a}for(n=0;o>n;++n)s[n]=0;return s},zero:li});ra.layout.histogram=function(){function t(t,o){for(var a,s,u=[],c=t.map(n,this),l=r.call(this,c,o),f=i.call(this,l,c,o),o=-1,h=c.length,d=f.length-1,p=e?1:1/h;++o<d;)a=u[o]=[],a.dx=f[o+1]-(a.x=f[o]),a.y=0;if(d>0)for(o=-1;++o<h;)s=c[o],s>=l[0]&&s<=l[1]&&(a=u[ra.bisect(f,s,1,d)-1],a.y+=p,a.push(t[o]));return u}var e=!0,n=Number,r=mi,i=pi;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(r=At(e),t):r},t.bins=function(e){return arguments.length?(i="number"==typeof e?function(t){return gi(t,e)}:At(e),t):i},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},ra.layout.pack=function(){function t(t,o){var a=n.call(this,t,o),s=a[0],u=i[0],c=i[1],l=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(s.x=s.y=0,ei(s,function(t){t.r=+l(t.value)}),ei(s,xi),r){var f=r*(e?1:Math.max(2*s.r/u,2*s.r/c))/2;ei(s,function(t){t.r+=f}),ei(s,xi),ei(s,function(t){t.r-=f})}return Si(s,u/2,c/2,e?1:1/Math.max(2*s.r/u,2*s.r/c)),a}var e,n=ra.layout.hierarchy().sort(yi),r=0,i=[1,1];return t.size=function(e){return arguments.length?(i=e,t):i},t.radius=function(n){return arguments.length?(e=null==n||"function"==typeof n?n:+n,t):e},t.padding=function(e){return arguments.length?(r=+e,t):r},Qr(t,n)},ra.layout.tree=function(){function t(t,i){var l=a.call(this,t,i),f=l[0],h=e(f);if(ei(h,n),h.parent.m=-h.z,ti(h,r),c)ti(f,o);else{var d=f,p=f,g=f;ti(f,function(t){t.x<d.x&&(d=t),t.x>p.x&&(p=t),t.depth>g.depth&&(g=t)});var m=s(d,p)/2-d.x,y=u[0]/(p.x+s(p,d)/2+m),v=u[1]/(g.depth||1);ti(f,function(t){t.x=(t.x+m)*y,t.y=t.depth*v})}return l}function e(t){for(var e,n={A:null,children:[t]},r=[n];null!=(e=r.pop());)for(var i,o=e.children,a=0,s=o.length;s>a;++a)r.push((o[a]=i={_:o[a],parent:e,children:(i=o[a].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:a}).a=i);return n.children[0]}function n(t){var e=t.children,n=t.parent.children,r=t.i?n[t.i-1]:null;if(e.length){Oi(t);var o=(e[0].z+e[e.length-1].z)/2;r?(t.z=r.z+s(t._,r._),t.m=t.z-o):t.z=o}else r&&(t.z=r.z+s(t._,r._));t.parent.A=i(t,r,t.parent.A||n[0])}function r(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function i(t,e,n){if(e){for(var r,i=t,o=t,a=e,u=i.parent.children[0],c=i.m,l=o.m,f=a.m,h=u.m;a=ki(a),i=Ai(i),a&&i;)u=Ai(u),o=ki(o),o.a=t,r=a.z+f-i.z-c+s(a._,i._),r>0&&(Ti(Ri(a,t,n),t,r),c+=r,l+=r),f+=a.m,c+=i.m,h+=u.m,l+=o.m;a&&!ki(o)&&(o.t=a,o.m+=f-l),i&&!Ai(u)&&(u.t=i,u.m+=c-h,n=t)}return n}function o(t){t.x*=u[0],t.y=t.depth*u[1]}var a=ra.layout.hierarchy().sort(null).value(null),s=Ci,u=[1,1],c=null;return t.separation=function(e){return arguments.length?(s=e,t):s},t.size=function(e){return arguments.length?(c=null==(u=e)?o:null,t):c?null:u},t.nodeSize=function(e){return arguments.length?(c=null==(u=e)?null:o,t):c?u:null},Qr(t,a)},ra.layout.cluster=function(){function t(t,o){var a,s=e.call(this,t,o),u=s[0],c=0;ei(u,function(t){var e=t.children;e&&e.length?(t.x=Ui(e),t.y=Di(e)):(t.x=a?c+=n(t,a):0,t.y=0,a=t)});var l=Ni(u),f=Li(u),h=l.x-n(l,f)/2,d=f.x+n(f,l)/2;return ei(u,i?function(t){t.x=(t.x-u.x)*r[0],t.y=(u.y-t.y)*r[1]}:function(t){t.x=(t.x-h)/(d-h)*r[0],t.y=(1-(u.y?t.y/u.y:1))*r[1]}),s}var e=ra.layout.hierarchy().sort(null).value(null),n=Ci,r=[1,1],i=!1;return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(i=null==(r=e),t):i?null:r},t.nodeSize=function(e){return arguments.length?(i=null!=(r=e),t):i?r:null},Qr(t,e)},ra.layout.treemap=function(){function t(t,e){for(var n,r,i=-1,o=t.length;++i<o;)r=(n=t[i]).value*(0>e?0:e),n.area=isNaN(r)||0>=r?0:r}function e(n){var o=n.children;if(o&&o.length){var a,s,u,c=f(n),l=[],h=o.slice(),p=1/0,g="slice"===d?c.dx:"dice"===d?c.dy:"slice-dice"===d?1&n.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(t(h,c.dx*c.dy/n.value),l.area=0;(u=h.length)>0;)l.push(a=h[u-1]),l.area+=a.area,"squarify"!==d||(s=r(l,g))<=p?(h.pop(),p=s):(l.area-=l.pop().area,i(l,g,c,!1),g=Math.min(c.dx,c.dy),l.length=l.area=0,p=1/0);l.length&&(i(l,g,c,!0),l.length=l.area=0),o.forEach(e)}}function n(e){var r=e.children;if(r&&r.length){var o,a=f(e),s=r.slice(),u=[];for(t(s,a.dx*a.dy/e.value),u.area=0;o=s.pop();)u.push(o),u.area+=o.area,null!=o.z&&(i(u,o.z?a.dx:a.dy,a,!s.length),u.length=u.area=0);r.forEach(n)}}function r(t,e){for(var n,r=t.area,i=0,o=1/0,a=-1,s=t.length;++a<s;)(n=t[a].area)&&(o>n&&(o=n),n>i&&(i=n));return r*=r,e*=e,r?Math.max(e*i*p/r,r/(e*o*p)):1/0}function i(t,e,n,r){var i,o=-1,a=t.length,s=n.x,c=n.y,l=e?u(t.area/e):0;if(e==n.dx){for((r||l>n.dy)&&(l=n.dy);++o<a;)i=t[o],i.x=s,i.y=c,i.dy=l,s+=i.dx=Math.min(n.x+n.dx-s,l?u(i.area/l):0);i.z=!0,i.dx+=n.x+n.dx-s,n.y+=l,n.dy-=l}else{for((r||l>n.dx)&&(l=n.dx);++o<a;)i=t[o],i.x=s,i.y=c,i.dx=l,c+=i.dy=Math.min(n.y+n.dy-c,l?u(i.area/l):0);i.z=!1,i.dy+=n.y+n.dy-c,n.x+=l,n.dx-=l}}function o(r){var i=a||s(r),o=i[0];return o.x=0,o.y=0,o.dx=c[0],o.dy=c[1],a&&s.revalue(o),t([o],o.dx*o.dy/o.value),(a?n:e)(o),h&&(a=i),i}var a,s=ra.layout.hierarchy(),u=Math.round,c=[1,1],l=null,f=ji,h=!1,d="squarify",p=.5*(1+Math.sqrt(5));return o.size=function(t){return arguments.length?(c=t,o):c},o.padding=function(t){function e(e){var n=t.call(o,e,e.depth);return null==n?ji(e):Fi(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return Fi(e,t)}if(!arguments.length)return l;var r;return f=null==(l=t)?ji:"function"==(r=typeof t)?e:"number"===r?(t=[t,t,t,t],n):n,o},o.round=function(t){return arguments.length?(u=t?Math.round:Number,o):u!=Number},o.sticky=function(t){return arguments.length?(h=t,a=null,o):h},o.ratio=function(t){return arguments.length?(p=t,o):p},o.mode=function(t){return arguments.length?(d=t+"",o):d},Qr(o,s)},ra.random={normal:function(t,e){var n=arguments.length;return 2>n&&(e=1),1>n&&(t=0),function(){var n,r,i;do n=2*Math.random()-1,r=2*Math.random()-1,i=n*n+r*r;while(!i||i>1);return t+e*n*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var t=ra.random.normal.apply(ra,arguments);return function(){return Math.exp(t())}},bates:function(t){var e=ra.random.irwinHall(t);return function(){return e()/t}},irwinHall:function(t){return function(){for(var e=0,n=0;t>n;n++)e+=Math.random();return e}}},ra.scale={};var bu={floor:b,ceil:b};ra.scale.linear=function(){return Yi([0,1],[0,1],br,!1)};var wu={s:1,g:1,p:1,r:1,e:1};ra.scale.log=function(){return Zi(ra.scale.linear().domain([0,1]),10,!0,[1,10])};var xu=ra.format(".0e"),Mu={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};ra.scale.pow=function(){return Qi(ra.scale.linear(),1,[0,1])},ra.scale.sqrt=function(){return ra.scale.pow().exponent(.5)},ra.scale.ordinal=function(){return eo([],{t:"range",a:[[]]})},ra.scale.category10=function(){return ra.scale.ordinal().range(_u)},ra.scale.category20=function(){return ra.scale.ordinal().range(Su)},ra.scale.category20b=function(){return ra.scale.ordinal().range(Eu)},ra.scale.category20c=function(){return ra.scale.ordinal().range(Cu)};var _u=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(wt),Su=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(wt),Eu=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(wt),Cu=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(wt);ra.scale.quantile=function(){return no([],[])},ra.scale.quantize=function(){return ro(0,1,[0,1])},ra.scale.threshold=function(){return io([.5],[0,1])},ra.scale.identity=function(){return oo([0,1])},ra.svg={},ra.svg.arc=function(){function t(){var t=Math.max(0,+n.apply(this,arguments)),c=Math.max(0,+r.apply(this,arguments)),l=a.apply(this,arguments)-ja,f=s.apply(this,arguments)-ja,h=Math.abs(f-l),d=l>f?0:1;if(t>c&&(p=c,c=t,t=p),h>=La)return e(c,d)+(t?e(t,1-d):"")+"Z";var p,g,m,y,v,b,w,x,M,_,S,E,C=0,A=0,k=[];if((y=(+u.apply(this,arguments)||0)/2)&&(m=o===Au?Math.sqrt(t*t+c*c):+o.apply(this,arguments),d||(A*=-1),c&&(A=nt(m/c*Math.sin(y))),t&&(C=nt(m/t*Math.sin(y)))),c){v=c*Math.cos(l+A),b=c*Math.sin(l+A),w=c*Math.cos(f-A),x=c*Math.sin(f-A);var T=Math.abs(f-l-2*A)<=Ua?0:1;if(A&&ho(v,b,w,x)===d^T){var O=(l+f)/2;v=c*Math.cos(O),b=c*Math.sin(O),w=x=null}}else v=b=0;if(t){M=t*Math.cos(f-C),_=t*Math.sin(f-C),S=t*Math.cos(l+C),E=t*Math.sin(l+C);var R=Math.abs(l-f+2*C)<=Ua?0:1;if(C&&ho(M,_,S,E)===1-d^R){var D=(l+f)/2;M=t*Math.cos(D),_=t*Math.sin(D),S=E=null}}else M=_=0;if((p=Math.min(Math.abs(c-t)/2,+i.apply(this,arguments)))>.001){g=c>t^d?0:1;var U=null==S?[M,_]:null==w?[v,b]:Nn([v,b],[S,E],[w,x],[M,_]),N=v-U[0],L=b-U[1],j=w-U[0],F=x-U[1],I=1/Math.sin(Math.acos((N*j+L*F)/(Math.sqrt(N*N+L*L)*Math.sqrt(j*j+F*F)))/2),B=Math.sqrt(U[0]*U[0]+U[1]*U[1]);if(null!=w){var P=Math.min(p,(c-B)/(I+1)),z=po(null==S?[M,_]:[S,E],[v,b],c,P,d),q=po([w,x],[M,_],c,P,d);p===P?k.push("M",z[0],"A",P,",",P," 0 0,",g," ",z[1],"A",c,",",c," 0 ",1-d^ho(z[1][0],z[1][1],q[1][0],q[1][1]),",",d," ",q[1],"A",P,",",P," 0 0,",g," ",q[0]):k.push("M",z[0],"A",P,",",P," 0 1,",g," ",q[0])}else k.push("M",v,",",b);if(null!=S){var W=Math.min(p,(t-B)/(I-1)),Y=po([v,b],[S,E],t,-W,d),J=po([M,_],null==w?[v,b]:[w,x],t,-W,d);p===W?k.push("L",J[0],"A",W,",",W," 0 0,",g," ",J[1],"A",t,",",t," 0 ",d^ho(J[1][0],J[1][1],Y[1][0],Y[1][1]),",",1-d," ",Y[1],"A",W,",",W," 0 0,",g," ",Y[0]):k.push("L",J[0],"A",W,",",W," 0 0,",g," ",Y[0])}else k.push("L",M,",",_)}else k.push("M",v,",",b),null!=w&&k.push("A",c,",",c," 0 ",T,",",d," ",w,",",x),k.push("L",M,",",_),null!=S&&k.push("A",t,",",t," 0 ",R,",",1-d," ",S,",",E);return k.push("Z"),k.join("")}function e(t,e){return"M0,"+t+"A"+t+","+t+" 0 1,"+e+" 0,"+-t+"A"+t+","+t+" 0 1,"+e+" 0,"+t}var n=so,r=uo,i=ao,o=Au,a=co,s=lo,u=fo;return t.innerRadius=function(e){return arguments.length?(n=At(e),t):n},t.outerRadius=function(e){return arguments.length?(r=At(e),t):r},t.cornerRadius=function(e){return arguments.length?(i=At(e),t):i},t.padRadius=function(e){return arguments.length?(o=e==Au?Au:At(e),t):o},t.startAngle=function(e){return arguments.length?(a=At(e),t):a},t.endAngle=function(e){return arguments.length?(s=At(e),t):s},t.padAngle=function(e){return arguments.length?(u=At(e),t):u},t.centroid=function(){var t=(+n.apply(this,arguments)+ +r.apply(this,arguments))/2,e=(+a.apply(this,arguments)+ +s.apply(this,arguments))/2-ja;return[Math.cos(e)*t,Math.sin(e)*t]},t};var Au="auto";ra.svg.line=function(){return go(b)};var ku=ra.map({linear:mo,"linear-closed":yo,step:vo,"step-before":bo,"step-after":wo,basis:Co,"basis-open":Ao,"basis-closed":ko,bundle:To,cardinal:_o,"cardinal-open":xo,"cardinal-closed":Mo,monotone:Lo});ku.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var Tu=[0,2/3,1/3,0],Ou=[0,1/3,2/3,0],Ru=[0,1/6,2/3,1/6];ra.svg.line.radial=function(){var t=go(jo);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},bo.reverse=wo,wo.reverse=bo,ra.svg.area=function(){return Fo(b)},ra.svg.area.radial=function(){var t=Fo(jo);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},ra.svg.chord=function(){function t(t,s){var u=e(this,o,t,s),c=e(this,a,t,s);return"M"+u.p0+r(u.r,u.p1,u.a1-u.a0)+(n(u,c)?i(u.r,u.p1,u.r,u.p0):i(u.r,u.p1,c.r,c.p0)+r(c.r,c.p1,c.a1-c.a0)+i(c.r,c.p1,u.r,u.p0))+"Z"}function e(t,e,n,r){var i=e.call(t,n,r),o=s.call(t,i,r),a=u.call(t,i,r)-ja,l=c.call(t,i,r)-ja;return{r:o,a0:a,a1:l,p0:[o*Math.cos(a),o*Math.sin(a)],p1:[o*Math.cos(l),o*Math.sin(l)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function r(t,e,n){return"A"+t+","+t+" 0 "+ +(n>Ua)+",1 "+e}function i(t,e,n,r){return"Q 0,0 "+r}var o=bn,a=wn,s=Io,u=co,c=lo;return t.radius=function(e){return arguments.length?(s=At(e),t):s},t.source=function(e){return arguments.length?(o=At(e),t):o},t.target=function(e){return arguments.length?(a=At(e),t):a},t.startAngle=function(e){return arguments.length?(u=At(e),t):u},t.endAngle=function(e){return arguments.length?(c=At(e),t):c},t},ra.svg.diagonal=function(){function t(t,i){var o=e.call(this,t,i),a=n.call(this,t,i),s=(o.y+a.y)/2,u=[o,{x:o.x,y:s},{x:a.x,y:s},a];return u=u.map(r),"M"+u[0]+"C"+u[1]+" "+u[2]+" "+u[3]}var e=bn,n=wn,r=Bo;return t.source=function(n){return arguments.length?(e=At(n),t):e},t.target=function(e){return arguments.length?(n=At(e),t):n},t.projection=function(e){return arguments.length?(r=e,t):r},t},ra.svg.diagonal.radial=function(){var t=ra.svg.diagonal(),e=Bo,n=t.projection;return t.projection=function(t){return arguments.length?n(Po(e=t)):e},t},ra.svg.symbol=function(){function t(t,r){return(Du.get(e.call(this,t,r))||Wo)(n.call(this,t,r))}var e=qo,n=zo;return t.type=function(n){return arguments.length?(e=At(n),t):e},t.size=function(e){return arguments.length?(n=At(e),t):n},t};var Du=ra.map({circle:Wo,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Nu)),n=e*Nu;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/Uu),n=e*Uu/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/Uu),n=e*Uu/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});ra.svg.symbolTypes=Du.keys();var Uu=Math.sqrt(3),Nu=Math.tan(30*Fa);Sa.transition=function(t){for(var e,n,r=Lu||++Bu,i=$o(t),o=[],a=ju||{time:Date.now(),ease:Cr,delay:0,duration:250},s=-1,u=this.length;++s<u;){o.push(e=[]);for(var c=this[s],l=-1,f=c.length;++l<f;)(n=c[l])&&Vo(n,l,i,r,a),e.push(n)}return Jo(o,i,r)},Sa.interrupt=function(t){return this.each(null==t?Fu:Yo($o(t)))};var Lu,ju,Fu=Yo($o()),Iu=[],Bu=0;Iu.call=Sa.call,Iu.empty=Sa.empty,Iu.node=Sa.node,Iu.size=Sa.size,ra.transition=function(t,e){return t&&t.transition?Lu?t.transition(e):t:ra.selection().transition(t)},ra.transition.prototype=Iu,Iu.select=function(t){var e,n,r,i=this.id,o=this.namespace,a=[];t=T(t);for(var s=-1,u=this.length;++s<u;){a.push(e=[]);for(var c=this[s],l=-1,f=c.length;++l<f;)(r=c[l])&&(n=t.call(r,r.__data__,l,s))?("__data__"in r&&(n.__data__=r.__data__),Vo(n,l,o,i,r[o][i]),e.push(n)):e.push(null)}return Jo(a,o,i)},Iu.selectAll=function(t){var e,n,r,i,o,a=this.id,s=this.namespace,u=[];t=O(t);for(var c=-1,l=this.length;++c<l;)for(var f=this[c],h=-1,d=f.length;++h<d;)if(r=f[h]){o=r[s][a],n=t.call(r,r.__data__,h,c),u.push(e=[]);for(var p=-1,g=n.length;++p<g;)(i=n[p])&&Vo(i,p,s,a,o),e.push(i)}return Jo(u,s,a)},Iu.filter=function(t){var e,n,r,i=[];"function"!=typeof t&&(t=q(t));for(var o=0,a=this.length;a>o;o++){i.push(e=[]);for(var n=this[o],s=0,u=n.length;u>s;s++)(r=n[s])&&t.call(r,r.__data__,s,o)&&e.push(r)}return Jo(i,this.namespace,this.id)},Iu.tween=function(t,e){var n=this.id,r=this.namespace;return arguments.length<2?this.node()[r][n].tween.get(t):Y(this,null==e?function(e){e[r][n].tween.remove(t)}:function(i){i[r][n].tween.set(t,e)})},Iu.attr=function(t,e){function n(){this.removeAttribute(s)}function r(){this.removeAttributeNS(s.space,s.local)}function i(t){return null==t?n:(t+="",function(){var e,n=this.getAttribute(s);return n!==t&&(e=a(n,t),function(t){this.setAttribute(s,e(t))})})}function o(t){return null==t?r:(t+="",function(){var e,n=this.getAttributeNS(s.space,s.local);return n!==t&&(e=a(n,t),function(t){this.setAttributeNS(s.space,s.local,e(t))})})}if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var a="transform"==t?qr:br,s=ra.ns.qualify(t);return Ho(this,"attr."+t,e,s.local?o:i)},Iu.attrTween=function(t,e){function n(t,n){var r=e.call(this,t,n,this.getAttribute(i));return r&&function(t){this.setAttribute(i,r(t))}}function r(t,n){var r=e.call(this,t,n,this.getAttributeNS(i.space,i.local));return r&&function(t){this.setAttributeNS(i.space,i.local,r(t))}}var i=ra.ns.qualify(t);return this.tween("attr."+t,i.local?r:n)},Iu.style=function(t,e,r){function i(){this.style.removeProperty(t)}function o(e){return null==e?i:(e+="",function(){var i,o=n(this).getComputedStyle(this,null).getPropertyValue(t);return o!==e&&(i=br(o,e),function(e){this.style.setProperty(t,i(e),r)})})}var a=arguments.length;if(3>a){if("string"!=typeof t){2>a&&(e="");for(r in t)this.style(r,t[r],e);return this}r=""}return Ho(this,"style."+t,e,o)},Iu.styleTween=function(t,e,r){function i(i,o){var a=e.call(this,i,o,n(this).getComputedStyle(this,null).getPropertyValue(t));return a&&function(e){this.style.setProperty(t,a(e),r)}}return arguments.length<3&&(r=""),this.tween("style."+t,i)},Iu.text=function(t){return Ho(this,"text",t,Go)},Iu.remove=function(){var t=this.namespace;return this.each("end.transition",function(){var e;this[t].count<2&&(e=this.parentNode)&&e.removeChild(this)})},Iu.ease=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].ease:("function"!=typeof t&&(t=ra.ease.apply(ra,arguments)),Y(this,function(r){r[n][e].ease=t}))},Iu.delay=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].delay:Y(this,"function"==typeof t?function(r,i,o){
r[n][e].delay=+t.call(r,r.__data__,i,o)}:(t=+t,function(r){r[n][e].delay=t}))},Iu.duration=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].duration:Y(this,"function"==typeof t?function(r,i,o){r[n][e].duration=Math.max(1,t.call(r,r.__data__,i,o))}:(t=Math.max(1,t),function(r){r[n][e].duration=t}))},Iu.each=function(t,e){var n=this.id,r=this.namespace;if(arguments.length<2){var i=ju,o=Lu;try{Lu=n,Y(this,function(e,i,o){ju=e[r][n],t.call(e,e.__data__,i,o)})}finally{ju=i,Lu=o}}else Y(this,function(i){var o=i[r][n];(o.event||(o.event=ra.dispatch("start","end","interrupt"))).on(t,e)});return this},Iu.transition=function(){for(var t,e,n,r,i=this.id,o=++Bu,a=this.namespace,s=[],u=0,c=this.length;c>u;u++){s.push(t=[]);for(var e=this[u],l=0,f=e.length;f>l;l++)(n=e[l])&&(r=n[a][i],Vo(n,l,a,o,{time:r.time,ease:r.ease,delay:r.delay+r.duration,duration:r.duration})),t.push(n)}return Jo(s,a,o)},ra.svg.axis=function(){function t(t){t.each(function(){var t,c=ra.select(this),l=this.__chart__||n,f=this.__chart__=n.copy(),h=null==u?f.ticks?f.ticks.apply(f,s):f.domain():u,d=null==e?f.tickFormat?f.tickFormat.apply(f,s):b:e,p=c.selectAll(".tick").data(h,f),g=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Ra),m=ra.transition(p.exit()).style("opacity",Ra).remove(),y=ra.transition(p.order()).style("opacity",1),v=Math.max(i,0)+a,w=Bi(f),x=c.selectAll(".domain").data([0]),M=(x.enter().append("path").attr("class","domain"),ra.transition(x));g.append("line"),g.append("text");var _,S,E,C,A=g.select("line"),k=y.select("line"),T=p.select("text").text(d),O=g.select("text"),R=y.select("text"),D="top"===r||"left"===r?-1:1;if("bottom"===r||"top"===r?(t=Ko,_="x",E="y",S="x2",C="y2",T.attr("dy",0>D?"0em":".71em").style("text-anchor","middle"),M.attr("d","M"+w[0]+","+D*o+"V0H"+w[1]+"V"+D*o)):(t=Xo,_="y",E="x",S="y2",C="x2",T.attr("dy",".32em").style("text-anchor",0>D?"end":"start"),M.attr("d","M"+D*o+","+w[0]+"H0V"+w[1]+"H"+D*o)),A.attr(C,D*i),O.attr(E,D*v),k.attr(S,0).attr(C,D*i),R.attr(_,0).attr(E,D*v),f.rangeBand){var U=f,N=U.rangeBand()/2;l=f=function(t){return U(t)+N}}else l.rangeBand?l=f:m.call(t,f,l);g.call(t,l,f),y.call(t,f,f)})}var e,n=ra.scale.linear(),r=Pu,i=6,o=6,a=3,s=[10],u=null;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(r=e in zu?e+"":Pu,t):r},t.ticks=function(){return arguments.length?(s=arguments,t):s},t.tickValues=function(e){return arguments.length?(u=e,t):u},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e){var n=arguments.length;return n?(i=+e,o=+arguments[n-1],t):i},t.innerTickSize=function(e){return arguments.length?(i=+e,t):i},t.outerTickSize=function(e){return arguments.length?(o=+e,t):o},t.tickPadding=function(e){return arguments.length?(a=+e,t):a},t.tickSubdivide=function(){return arguments.length&&t},t};var Pu="bottom",zu={top:1,right:1,bottom:1,left:1};ra.svg.brush=function(){function t(n){n.each(function(){var n=ra.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",o).on("touchstart.brush",o),a=n.selectAll(".background").data([0]);a.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),n.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=n.selectAll(".resize").data(g,b);s.exit().remove(),s.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return qu[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",t.empty()?"none":null);var u,f=ra.transition(n),h=ra.transition(a);c&&(u=Bi(c),h.attr("x",u[0]).attr("width",u[1]-u[0]),r(f)),l&&(u=Bi(l),h.attr("y",u[0]).attr("height",u[1]-u[0]),i(f)),e(f)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+f[+/e$/.test(t)]+","+h[+/^s/.test(t)]+")"})}function r(t){t.select(".extent").attr("x",f[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",f[1]-f[0])}function i(t){t.select(".extent").attr("y",h[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function o(){function o(){32==ra.event.keyCode&&(T||(b=null,R[0]-=f[1],R[1]-=h[1],T=2),E())}function g(){32==ra.event.keyCode&&2==T&&(R[0]+=f[1],R[1]+=h[1],T=0,E())}function m(){var t=ra.mouse(x),n=!1;w&&(t[0]+=w[0],t[1]+=w[1]),T||(ra.event.altKey?(b||(b=[(f[0]+f[1])/2,(h[0]+h[1])/2]),R[0]=f[+(t[0]<b[0])],R[1]=h[+(t[1]<b[1])]):b=null),A&&y(t,c,0)&&(r(S),n=!0),k&&y(t,l,1)&&(i(S),n=!0),n&&(e(S),_({type:"brush",mode:T?"move":"resize"}))}function y(t,e,n){var r,i,o=Bi(e),u=o[0],c=o[1],l=R[n],g=n?h:f,m=g[1]-g[0];return T&&(u-=l,c-=m+l),r=(n?p:d)?Math.max(u,Math.min(c,t[n])):t[n],T?i=(r+=l)+m:(b&&(l=Math.max(u,Math.min(c,2*b[n]-r))),r>l?(i=r,r=l):i=l),g[0]!=r||g[1]!=i?(n?s=null:a=null,g[0]=r,g[1]=i,!0):void 0}function v(){m(),S.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),ra.select("body").style("cursor",null),D.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),O(),_({type:"brushend"})}var b,w,x=this,M=ra.select(ra.event.target),_=u.of(x,arguments),S=ra.select(x),C=M.datum(),A=!/^(n|s)$/.test(C)&&c,k=!/^(e|w)$/.test(C)&&l,T=M.classed("extent"),O=K(x),R=ra.mouse(x),D=ra.select(n(x)).on("keydown.brush",o).on("keyup.brush",g);if(ra.event.changedTouches?D.on("touchmove.brush",m).on("touchend.brush",v):D.on("mousemove.brush",m).on("mouseup.brush",v),S.interrupt().selectAll("*").interrupt(),T)R[0]=f[0]-R[0],R[1]=h[0]-R[1];else if(C){var U=+/w$/.test(C),N=+/^n/.test(C);w=[f[1-U]-R[0],h[1-N]-R[1]],R[0]=f[U],R[1]=h[N]}else ra.event.altKey&&(b=R.slice());S.style("pointer-events","none").selectAll(".resize").style("display",null),ra.select("body").style("cursor",M.style("cursor")),_({type:"brushstart"}),m()}var a,s,u=A(t,"brushstart","brush","brushend"),c=null,l=null,f=[0,0],h=[0,0],d=!0,p=!0,g=Wu[0];return t.event=function(t){t.each(function(){var t=u.of(this,arguments),e={x:f,y:h,i:a,j:s},n=this.__chart__||e;this.__chart__=e,Lu?ra.select(this).transition().each("start.brush",function(){a=n.i,s=n.j,f=n.x,h=n.y,t({type:"brushstart"})}).tween("brush:brush",function(){var n=wr(f,e.x),r=wr(h,e.y);return a=s=null,function(i){f=e.x=n(i),h=e.y=r(i),t({type:"brush",mode:"resize"})}}).each("end.brush",function(){a=e.i,s=e.j,t({type:"brush",mode:"resize"}),t({type:"brushend"})}):(t({type:"brushstart"}),t({type:"brush",mode:"resize"}),t({type:"brushend"}))})},t.x=function(e){return arguments.length?(c=e,g=Wu[!c<<1|!l],t):c},t.y=function(e){return arguments.length?(l=e,g=Wu[!c<<1|!l],t):l},t.clamp=function(e){return arguments.length?(c&&l?(d=!!e[0],p=!!e[1]):c?d=!!e:l&&(p=!!e),t):c&&l?[d,p]:c?d:l?p:null},t.extent=function(e){var n,r,i,o,u;return arguments.length?(c&&(n=e[0],r=e[1],l&&(n=n[0],r=r[0]),a=[n,r],c.invert&&(n=c(n),r=c(r)),n>r&&(u=n,n=r,r=u),(n!=f[0]||r!=f[1])&&(f=[n,r])),l&&(i=e[0],o=e[1],c&&(i=i[1],o=o[1]),s=[i,o],l.invert&&(i=l(i),o=l(o)),i>o&&(u=i,i=o,o=u),(i!=h[0]||o!=h[1])&&(h=[i,o])),t):(c&&(a?(n=a[0],r=a[1]):(n=f[0],r=f[1],c.invert&&(n=c.invert(n),r=c.invert(r)),n>r&&(u=n,n=r,r=u))),l&&(s?(i=s[0],o=s[1]):(i=h[0],o=h[1],l.invert&&(i=l.invert(i),o=l.invert(o)),i>o&&(u=i,i=o,o=u))),c&&l?[[n,i],[r,o]]:c?[n,r]:l&&[i,o])},t.clear=function(){return t.empty()||(f=[0,0],h=[0,0],a=s=null),t},t.empty=function(){return!!c&&f[0]==f[1]||!!l&&h[0]==h[1]},ra.rebind(t,u,"on")};var qu={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Wu=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Yu=cs.format=gs.timeFormat,Ju=Yu.utc,Hu=Ju("%Y-%m-%dT%H:%M:%S.%LZ");Yu.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Zo:Hu,Zo.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},Zo.toString=Hu.toString,cs.second=Pt(function(t){return new ls(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),cs.seconds=cs.second.range,cs.seconds.utc=cs.second.utc.range,cs.minute=Pt(function(t){return new ls(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),cs.minutes=cs.minute.range,cs.minutes.utc=cs.minute.utc.range,cs.hour=Pt(function(t){var e=t.getTimezoneOffset()/60;return new ls(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),cs.hours=cs.hour.range,cs.hours.utc=cs.hour.utc.range,cs.month=Pt(function(t){return t=cs.day(t),t.setDate(1),t},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),cs.months=cs.month.range,cs.months.utc=cs.month.utc.range;var Gu=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],$u=[[cs.second,1],[cs.second,5],[cs.second,15],[cs.second,30],[cs.minute,1],[cs.minute,5],[cs.minute,15],[cs.minute,30],[cs.hour,1],[cs.hour,3],[cs.hour,6],[cs.hour,12],[cs.day,1],[cs.day,2],[cs.week,1],[cs.month,1],[cs.month,3],[cs.year,1]],Vu=Yu.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",Te]]),Ku={range:function(t,e,n){return ra.range(Math.ceil(t/n)*n,+e,n).map(ta)},floor:b,ceil:b};$u.year=cs.year,cs.scale=function(){return Qo(ra.scale.linear(),$u,Vu)};var Xu=$u.map(function(t){return[t[0].utc,t[1]]}),Zu=Ju.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",Te]]);Xu.year=cs.year.utc,cs.scale.utc=function(){return Qo(ra.scale.linear(),Xu,Zu)},ra.text=kt(function(t){return t.responseText}),ra.json=function(t,e){return Tt(t,"application/json",ea,e)},ra.html=function(t,e){return Tt(t,"text/html",na,e)},ra.xml=kt(function(t){return t.responseXML}),"function"==typeof define&&define.amd?define(ra):"object"==typeof e&&e.exports&&(e.exports=ra),this.d3=ra}()},{}],25:[function(t,e,n){(function(e){e.iLanguageCloud=t("./ilanguage-cloud").iLanguageCloud,e.iLanguageClouds=t("./ilanguage-clouds").iLanguageClouds,e.NonContentWords=t("./ilanguage-cloud").NonContentWords}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ilanguage-cloud":26,"./ilanguage-clouds":27}],26:[function(t,e,n){(function(e){!function(n){"use strict";var r;try{r=n.d3?n.d3:t("d3"),e.d3=e.d3||r}catch(i){console.log("There was a problem setting d3",r)}try{document.createElement("canvas").getContext("2d")}catch(o){try{var a=n.Canvas?n.Canvas:t("canvas-browserify");e.Canvas=e.Canvas||a}catch(s){e.Canvas=e.Canvas||function(){this.getContext=function(){return{}}},console.log("Mocking Canvas. If you have a Mac or Linux computer you should install canvas-browserify, canvas and Cairo. See https://www.npmjs.com/package/canvas#installation for instructions. ")}}var u=n.d3?n.d3:t("d3.layout.cloud/src/d3.layout.cloud");console.log("Loaded d3-cloud",!!u);var c=n.FieldDB?n.FieldDB.FieldDBObject:t("fielddb/api/FieldDBObject").FieldDBObject,l=n.iLanguage?n.iLanguage.Lexicon.MorphemeSegmenter:t("ilanguage/js/lexicon/MorphemeSegmenter").MorphemeSegmenter,f=n.iLanguage?n.iLanguage.Lexicon.LexemeFrequency:t("ilanguage/js/lexicon/LexemeFrequency").LexemeFrequency,h=n.iLanguage?n.iLanguage.Lexicon.NonContentWords:t("ilanguage/js/lexicon/NonContentWords").NonContentWords,d={element:"cloud",orthography:"A cloud is a visible mass of condensed droplets or frozen crystals suspended in the atmosphere. Cloud(s) may also refer to: Contents  [hide]  1 Information Technology 2 Science 3 Fiction 4 Literature 5 Music 6 Other uses 7 See also Information Technology  Cloud computing, Internet-based development and use of computer technology stored on servers rather than the client computers Cloud (operating system), a browser-based operating system that will instantly be usable after turning on the PC, by the makers of gOS Tag cloud, a visual depiction of user-generated self.wordFrequencies used typically to describe the content of web sites Cloud storage, a model of networked online storage Cloud.com, a company that develops open source cloud orchestration software CloudStack, an open source cloud computing software Science  Magellanic Clouds, irregular dwarf galaxies near our galaxy, the Milky Way Interstellar cloud, dense region between stars Molecular cloud, interstellar cloud containing molecules Electron cloud, analogy used to describe an electron that orbits around a nucleus Point cloud, in mathematics, a set of vertices in a three-dimensional coordinate system CLOUD, an experimental facility used to investigate the microphysics between galactic cosmic rays and clouds Cloud chamber, an experimental device used in early studies of particle physics Fiction  Cloud Strife, a character in Final Fantasy VII media Bou Keng Wan ('Cloud'), a Kung Fu character from the Hong Kong comic, Fung Wan Cloud (comics), a Marvel comic book character Cloudbase, the fictional skyborne headquarters of Spectrum, from the science fiction television series Captain Scarlet and the Mysterons Clouds (film), a 2000 film written and directed by Don Thompson and produced by Will Arntz Literature  The Clouds, a comedy by Aristophanes Clouds, a 1977 philosophical comedic play by British playwright Michael Frayn The Clouds, a 1797 play by the British writer Richard Cumberland The Cloud of Unknowing, a medieval mystical text Music  Clouds (60s rock band), a Scottish music group that operated in the late 1960s Clouds (Australian band), an indie rock group based in Sydney, Australia in the 1990s The Clouds (UK band), a British indie pop band from the 1980s Cloud (music), sound mass consisting of statistical clouds of microsounds 'Clouds', a song by Chaka Khan from Naughty 'Clouds', a song by Level 42 on the album Retroglide 'Clouds', a song by Spires That in the Sunset Rise on the album This Is Fire 'Clouds' (Zach Sobiech song) a song by Zach Sobiech Clouds (Joni Mitchell album), 1969 Clouds (Lee Ranaldo album), 1997 Clouds (Tiamat album), 1992 Clouds (EP), an EP by Nosound 'Cloudy', by Average White Band from the album Cut the Cake Other uses  Cloud (dancer), a b-boy, writer, and director from Florida Cloud (surname) Cloud, California, a former settlement in Kings County Clodoald (522560), better known as Cloud or Saint Cloud, son of King Chlodomer of Orleans Saint-Cloud, a commune in the western suburbs of Paris, France Cloud (video game), a 2005 third-person computer puzzle game See also  The Cloud (disambiguation) Cloud Nine (disambiguation) Red Cloud (disambiguation) St. Cloud (disambiguation) White Cloud (disambiguation) McCloud (disambiguation)",font:"FreeSans",isAndroid:!1,maxVocabSize:500,clearPreviousSVG:!0,morphemeSegmentationOptions:{algorithm:"MorphoParser",maxIterations:2}},p=function(t){t=t||{},t.originalText||(t.originalText=t.orthography),this.saving=!1,this.runningSegmenter=!1,this.runningRender=!1,this.runningStemmer=!1,this.runningWordFrequencyGenerator=!1,c.apply(this,arguments)};p.d3=r,p.prototype=Object.create(c.prototype,{constructor:{value:p},runSegmenter:{value:function(t){if(this.debug("Running runSegmenter ",t),this.runningSegmenter)return this;this.runningSegmenter=!0,this.morphemes=this.morphemes||this.orthography;for(var e in this.userDefinedMorphemeSegmentationReWriteRules)this.userDefinedMorphemeSegmentationReWriteRules.hasOwnProperty(e)&&(this.morphemes=this.morphemes.replace(new RegExp(this.userDefinedMorphemeSegmentationReWriteRules[e].source,"g"),this.userDefinedMorphemeSegmentationReWriteRules[e].target));return h.filterText(this),l.runSegmenter(this),this.runningSegmenter=!1,this}},runWordFrequencyGenerator:{value:function(t){if(this.debug("Running runWordFrequencyGenerator ",t),this.runningWordFrequencyGenerator)return this;this.runningWordFrequencyGenerator=!0,this.wordFrequencies=null,this.cloudType="banana",f.calculateNonContentWords(this);var e=this.wordFrequencies.length;return 15>e&&100>e&&(this.cloudType="word cloud"),15>e&&(this.cloudType="tag cloud"),e>100&&(this.cloudType="ilanguage cloud"),this.runningWordFrequencyGenerator=!1,this}},runStemmer:{value:function(t){if(this.debug("Running runStemmer ",t),this.runningStemmer)return this;this.runningStemmer=!0;var e=!0,n=this.nonContentWordsArray;for(this.itterations=0;e;)if(h.processNonContentWords(this),h.filterText(this),this.itterations++,this.orthography.length<100&&(e=!1),this.userSpecifiedNonContentWords||n&&n.toString()===this.nonContentWordsArray.toString())e=!1;else{n=this.nonContentWordsArray;var r=this.filteredText?this.filteredText.length:0/this.orthography.length;.98>r?this.filteredText&&this.filteredText.length>100:e=!1}return this.orthography=this.originalText,this.runningStemmer=!1,this}},render:{value:function(t){if(this.runningRender||this.runningStemmer||this.runningWordFrequencyGenerator)return this;var e,n=this;try{n.runningRender=!0,t=t||{};var r,i=t.element||this.element,o=t.font||this.font,a=t.isAndroid||this.isAndroid,s=t.maxVocabSize||this.maxVocabSize||d.maxVocabSize,u=t.clearPreviousSVG||this.clearPreviousSVG||d.clearPreviousSVG;r=t.document?t.document:document,i&&void 0===i.ownerDocument&&(i=r.getElementById(i)),i&&i.length&&(i=i[0]),i||(console.warn("Appending an element since none was specified",i),i=r.createElement("div"),r.body.appendChild(i)),u&&(i.innerHTML=""),this.wordFrequencies&&this.wordFrequencies.length||this.runWordFrequencyGenerator();var c,l,f,h=p.d3.scale.category20(),g=t.width||this.width||800,m=t.height||this.height||400,y=[],v=1;console.log("d3  cloud loaded: ",!!p.d3.layout.cloud);var b=p.d3.layout.cloud().timeInterval(10).size([g,m]).fontSize(function(t){var e=f(+t.count);if(t.categories){var n=t.categories.join(" ");(n.indexOf("functionalWord")>-1||n.indexOf("userRemovedWord")>-1)&&(e=0)}return Math.min(e,70)}).text(function(t){return t.orthography}).on("end",e),w=p.d3.select(i).append("svg").attr("width",g).attr("height",m).attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg"),x=w.append("g"),M=w.append("g").attr("transform","translate("+[g>>1,m>>1]+")");this.debug(" the background is set to ",x);var _=function(){try{b.font(o).spiral("archimedean")}catch(t){}f=p.d3.scale.linear().domain([0,l]).range([10,.25*m]),y=[];try{b.stop().words(n.wordFrequencies.slice(0,c=Math.min(n.wordFrequencies.length,+s))).start()}catch(t){n.wordFrequencies=n.wordFrequencies.map(function(t){return{categories:t.categories||[],alternates:t.alternates||[],count:t.count,hasText:!0,height:0,orthography:t.orthography,padding:1,rotate:0,size:0,style:"normal",text:t.text,weight:"normal",width:32,x:-242,x0:-16,x1:16,xoff:544,y:15,y0:0,y1:-1,yoff:438}})}n.runningRender=!1},S=function(t){n.debug("Running parseWordFrequencies ",t),l=0,n.wordFrequencies&&n.wordFrequencies[0]&&n.wordFrequencies[0].count&&(l=n.wordFrequencies[0].count),_()},E=function(){S(n)};e=function(t,e){v=e?Math.min(g/Math.abs(e[1].x-g/2),g/Math.abs(e[0].x-g/2),m/Math.abs(e[1].y-m/2),m/Math.abs(e[0].y-m/2))/2:1,y=t;var r=M.selectAll("text").data(y,function(t){return t.orthography});r.transition().duration(1e3).attr("transform",function(t){return"translate("+[t.x,t.y]+")rotate("+t.rotate+")"}).style("font-size",function(t){return t.size+"px"}),a?r.enter().append("text").attr("text-anchor","middle").attr("transform",function(t){return"translate("+[t.x,t.y]+")rotate("+t.rotate+")"}).on("click",function(t){"function"==typeof n.onWordClick&&n.onWordClick(t)}).on("mousedown",function(t){"function"==typeof n.onWordMousedown&&n.onWordMousedown(t)}).on("mouseup",function(t){"function"==typeof n.onWordMouseup&&n.onWordMouseup(t)}).on("mouseover",function(t){"function"==typeof n.onWordMouseover&&n.onWordMouseover(t)}).on("mousemove",function(t){"function"==typeof n.onWordMousemove&&n.onWordMouseover(t)}).on("mouseout",function(t){"function"==typeof n.onWordMouseout&&n.onWordMouseover(t)}).on("focusin",function(t){"function"==typeof n.onFocusin&&n.onWordFocusin(t)}).on("focusout",function(t){"function"==typeof n.onFocusout&&n.onWordFocusout(t)}).style("opacity",1).style("font-size",function(t){return t.size+"px"}):r.enter().append("text").attr("text-anchor","middle").attr("transform",function(t){return"translate("+[t.x,t.y]+")rotate("+t.rotate+")"}).style("font-size",function(t){return t.size+"px"}).on("click",function(t){return"function"==typeof n.onWordClick?n.onWordClick(t):void 0}).on("mousedown",function(t){return"function"==typeof n.onWordMousedown?n.onWordMousedown(t):void 0}).on("mouseup",function(t){return"function"==typeof n.onWordMouseup?n.onWordMouseup(t):void 0}).on("mouseover",function(t){return"function"==typeof n.onWordMouseover?n.onWordMouseover(t):void 0}).on("mousemove",function(t){return"function"==typeof n.onWordMousemove?n.onWordMouseover(t):void 0}).on("mouseout",function(t){return"function"==typeof n.onWordMouseout?n.onWordMouseover(t):void 0}).on("focusin",function(t){return"function"==typeof n.onFocusin?n.onWordFocusin(t):void 0}).on("focusout",function(t){return"function"==typeof n.onFocusout?n.onWordFocusout(t):void 0}).style("opacity",1e-6).transition().duration(500).style("opacity",1),r.style("font-family",function(t){return t.font}).style("fill",function(t){return h(t.orthography)}).text(function(t){return t.orthography}),a?M.transition().duration(3e3):M.transition().duration(1e3).attr("transform","translate("+[g>>1,m>>1]+")scale("+v+")")};var C=40.5,A=35,k=20,T=p.d3.select("#angles").append("svg").attr("width",2*(C+A)).attr("height",C+1.5*k).append("g").attr("transform","translate("+[C+A,C+k]+")");T.append("path").style("fill","none").attr("d",["M",-C,0,"A",C,C,0,0,1,C,0].join(" ")),T.append("line").attr("x1",-C-7).attr("x2",C+7),T.append("line").attr("y2",-C-7),T.selectAll("text").data([-90,0,90]).enter().append("text").attr("dy",function(t,e){return 1===e?null:".3em"}).attr("text-anchor",function(t,e){return["end","middle","start"][e]}).attr("transform",function(t){return t+=90,"rotate("+t+")translate("+-(C+10)+")rotate("+-t+")translate(2)"}).text(function(t){return t+""});var O,R,D,U=Math.PI/180,N=p.d3.svg.arc().innerRadius(0).outerRadius(C);v=p.d3.scale.linear();var L=function(t,e){return t[0]*e[1]-t[1]*e[0]},j=function(t,e){return t[0]*e[0]+t[1]*e[1]},F=function(){v.domain([0,D-1]).range([O,R]);var t=T.selectAll("path.angle").data([{startAngle:O*U,endAngle:R*U}]);t.enter().insert("path","circle").attr("class","angle").style("fill","#fc0"),t.attr("d",N);var e=T.selectAll("line.angle").data(p.d3.range(D).map(v));e.enter().append("line").attr("class","angle"),e.exit().remove(),e.attr("transform",function(t){return"rotate("+(90+t)+")"}).attr("x2",function(t,e){return e&&e!==D-1?-C:-C-5});var n=T.selectAll("path.drag").data([O,R]);n.enter().append("path").attr("class","drag").attr("d","M-9.5,0L-3,3.5L-3,-3.5Z").call(p.d3.behavior.drag().on("drag",function(t,e){t=(e?R:O)+90;var n=[-C*Math.cos(t*U),-C*Math.sin(t*U)],r=[p.d3.event.x,p.d3.event.y],i=~~(Math.atan2(L(n,r),j(n,r))/U);t=Math.max(-90,Math.min(90,t+i-90)),i=R-O,e?(R=t,i>360?O+=i-360:0>i&&(O=R)):(O=t,i>360?R+=360-i:0>i&&(R=O)),F()}).on("dragend",_)),n.attr("transform",function(t){return"rotate("+(t+90)+")translate(-"+C+")"}),b.rotate(function(){var t=v(~~(Math.random()*D));return t})},I=function(){D=2,O=Math.max(-90,Math.min(90,0)),R=Math.max(-90,Math.min(90,90)),F()};I(),E()}catch(B){console.warn("There was a problem rendering this cloud ",this.orthography,B,B.stack)}return this}},toJSONLimited:{value:function(){var t,e,n={};for(t in this)this.hasOwnProperty(t)&&"function"!=typeof this[t]&&(e=t.replace(/^_/,""),n[e]=this[t]);for(t in this.defaults)n[t]||(n[t]=this.defaults[t]);return n}},toJSON:{value:function(){var t,e,n={};for(t in this)this.hasOwnProperty(t)&&"function"!=typeof this[t]&&-1===t.indexOf("running")&&(e=t.replace(/^_/,""),("id"===e||"rev"===e)&&(e="_"+e),n[e]=this[t]);for(t in this.defaults)n[t]||(n[t]=this.defaults[t]);return n._id||delete n._id,n._rev||delete n._rev,delete n.references,delete n.root,delete n.precedenceRelations,delete n.element,delete n.saving,n.wordFrequencies&&(n.wordFrequencies=n.wordFrequencies.map(function(t){return{categories:t.categories||[],alternates:t.alternates||[],orthography:t.orthography,count:t.count}})),n}}}),p.Doc=c,n.iLanguageCloud=p,n.NonContentWords=h}("undefined"==typeof n?this:n)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"canvas-browserify":23,d3:24,"d3.layout.cloud/src/d3.layout.cloud":12,"fielddb/api/FieldDBObject":2,"ilanguage/js/lexicon/LexemeFrequency":14,"ilanguage/js/lexicon/MorphemeSegmenter":15,"ilanguage/js/lexicon/NonContentWords":16}],27:[function(t,e,n){!function(e){var n=e.FieldDB?e.FieldDB.Database:t("fielddb/api/corpus/Database").Database,r=function(t){this.debug("In iLanguageClouds ",t),n.apply(this,arguments)};r.prototype=Object.create(n.prototype,{constructor:{value:r}}),e.iLanguageClouds=r}("undefined"==typeof n?this:n)},{"fielddb/api/corpus/Database":6}]},{},[25]);